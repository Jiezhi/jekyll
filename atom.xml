<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä»‹ä¹‹çš„åšå®¢</title>
  
  <subtitle>å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://jiezhi.github.io/"/>
  <updated>2021-01-24T05:37:42.079Z</updated>
  <id>http://jiezhi.github.io/</id>
  
  <author>
    <name>Jiezhi.G</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2020å¹´åº¦ Python åº“ Top10åº“ä¹‹1-Typer</title>
    <link href="http://jiezhi.github.io/2021/01/24/py-2020-top10lib-01-typer/"/>
    <id>http://jiezhi.github.io/2021/01/24/py-2020-top10lib-01-typer/</id>
    <published>2021-01-24T04:58:31.000Z</published>
    <updated>2021-01-24T05:37:42.079Z</updated>
    
    <content type="html"><![CDATA[<p>Typer æ˜¯ä¸€ä¸ªäººè§äººçˆ±ï¼ŒèŠ±è§èŠ±å¼€çš„ç”¨äºæ„å»º CLI ç¨‹åºçš„åº“ï¼ŒåŸºäº Python 3.6+çš„ç±»å‹æç¤ºï¼ˆtype hintsï¼‰ã€‚</p><a id="more"></a><p>Typer å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://typer.tiangolo.com/" target="_blank" rel="noopener">https://typer.tiangolo.com/</a><br>æºç åœ°å€ï¼š <a href="https://github.com/tiangolo/typer" target="_blank" rel="noopener">https://github.com/tiangolo/typer</a></p><h1 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h1><ul><li><p>äº¤äº’å¼ç¼–å†™ï¼šæ˜“äºä½¿ç”¨å’Œå­¦ä¹ ï¼Œå‡å°‘ debug å’Œé˜…è¯»æ–‡æ¡£æ—¶é—´ã€‚</p></li><li><p>å®¹æ˜“ä½¿ç”¨ï¼šæ”¯æŒæ‰€æœ‰çš„ shell è‡ªåŠ¨æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨ã€‚</p></li><li><p>ç®€çŸ­ï¼š é¿å…é‡å¤ï¼Œä»å‚æ•°å£°æ˜ä¸­è·å–ä¿¡æ¯</p></li><li><p>å¼€ç®±å³ç”¨ï¼š 2è¡Œä»£ç å³å¯ä½¿ç”¨ï¼Œä¸€è¡Œ importï¼Œä¸€è¡Œå‡½æ•°è°ƒç”¨</p></li><li><p>æ— æƒ§å¤æ‚é¡¹ç›®ï¼š é¡¹ç›®å†å¤æ‚ï¼ŒTyperç…§æ ·æŸ¥</p></li></ul><h1 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h1><p>Python 3.6+</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p><code>pip install typer</code></p><h1 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h1><h2 id="æœ€ç®€å•çš„å®ç°-main-py"><a href="#æœ€ç®€å•çš„å®ç°-main-py" class="headerlink" title="æœ€ç®€å•çš„å®ç°, main.py:"></a>æœ€ç®€å•çš„å®ç°, <strong>main.py</strong>:</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> typer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(name: str)</span>:</span></span><br><span class="line">    typer.echo(<span class="string">f"Hello <span class="subst">&#123;name&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    typer.run(main)</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ğŸ’¬ è¿è¡Œç¨‹åº</span><br><span class="line">python main.py</span><br><span class="line"></span><br><span class="line">ğŸ’¬ å‹å¥½åœ°æç¤ºä½ ç¼ºå°‘ NAME å‚æ•°</span><br><span class="line">Usage: main.py [OPTIONS] NAME</span><br><span class="line">Try <span class="string">"main.py --help"</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">Error: Missing argument <span class="string">'NAME'</span>.</span><br><span class="line"></span><br><span class="line">ğŸ’¬  è‡ªå¸¦ --<span class="built_in">help</span></span><br><span class="line">python main.py --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage: main.py [OPTIONS] NAME</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  NAME  [required]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --install-completion  Install completion <span class="keyword">for</span> the current shell.</span><br><span class="line">  --show-completion     Show completion <span class="keyword">for</span> the current shell, to copy it or customize the installation.</span><br><span class="line">  --<span class="built_in">help</span>                Show this message and <span class="built_in">exit</span>.</span><br><span class="line"></span><br><span class="line">ğŸ’¬ å½“ä½ åˆ›å»ºä¸€ä¸ªpythonåŒ…ï¼Œå®‰è£…æ—¶å¸¦ä¸Š--install-completionå‚æ•°ï¼Œåˆ™è·å¾—äº†è‡ªåŠ¨è¡¥å…¨çš„åŠŸèƒ½</span><br><span class="line">ğŸ’¬ ç°åœ¨ä¼ å…¥ NAME å‚æ•°è¿è¡Œ</span><br><span class="line">python main.py Camila</span><br><span class="line"></span><br><span class="line">Hello Camila</span><br><span class="line"></span><br><span class="line">ğŸ’¬ æˆåŠŸè¿è¡Œï¼ ğŸ‰</span><br></pre></td></tr></table></figure><h1 id="ä»£ç å‡çº§"><a href="#ä»£ç å‡çº§" class="headerlink" title="ä»£ç å‡çº§"></a>ä»£ç å‡çº§</h1><p>ä¿®æ”¹ <code>main.py</code> ä»£ç ï¼Œæ–°å¢ <code>typer.Typer()</code> app å®ä¾‹å¹¶åˆ›å»ºä¸¤ä¸ªå¸¦å‚æ•°çš„å­å‘½ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> typer</span><br><span class="line"></span><br><span class="line">app = typer.Typer()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name: str)</span>:</span></span><br><span class="line">    typer.echo(<span class="string">f"Hello <span class="subst">&#123;name&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">goodbye</span><span class="params">(name: str, formal: bool = False)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> formal:</span><br><span class="line">        typer.echo(<span class="string">f"Goodbye Ms. <span class="subst">&#123;name&#125;</span>. Have a good day."</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        typer.echo(<span class="string">f"Bye <span class="subst">&#123;name&#125;</span>!"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app()</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­ï¼š</p><ul><li>æ˜¾ç¤ºåˆ›å»ºä¸€ä¸ª<code>typer.Typer</code>å®ä¾‹<ul><li>ä¹‹å‰ä»£ç ä¸­<code>typer.run</code>å…¶å®éšå¼åœ°åˆ›å»ºäº†æ”¹å®ä¾‹</li></ul></li><li>é€šè¿‡ <a href="mailto:`@app.command" target="_blank" rel="noopener">`@app.command</a>()` åˆ›å»ºäº†ä¸¤ä¸ªå­å‘½ä»¤</li><li>è°ƒç”¨ <code>app()</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">ğŸ’¬ æŸ¥çœ‹ --<span class="built_in">help</span> å†…å®¹</span><br><span class="line">python main.py --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage: main.py [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --install-completion  Install completion <span class="keyword">for</span> the current shell.</span><br><span class="line">  --show-completion     Show completion <span class="keyword">for</span> the current shell, to copy it or customize the installation.</span><br><span class="line">  --<span class="built_in">help</span>                Show this message and <span class="built_in">exit</span>.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  goodbye</span><br><span class="line">  hello</span><br><span class="line"></span><br><span class="line">ğŸ’¬  åŒ…å«ä¸¤ä¸ªå­å‘½ä»¤ï¼ˆå³ä¸¤ä¸ªå‡½æ•°ï¼‰: goodbye and hello</span><br><span class="line"></span><br><span class="line">ğŸ’¬ æŸ¥çœ‹å­å‘½ä»¤ hello çš„å¸®åŠ©</span><br><span class="line"></span><br><span class="line">python main.py hello --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage: main.py hello [OPTIONS] NAME</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  NAME  [required]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --<span class="built_in">help</span>  Show this message and <span class="built_in">exit</span>.</span><br><span class="line"></span><br><span class="line">ğŸ’¬ ç„¶åå†çœ‹ä¸‹ goodbye çš„</span><br><span class="line"></span><br><span class="line">python main.py goodbye --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage: main.py goodbye [OPTIONS] NAME</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  NAME  [required]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --formal / --no-formal  [default: False]</span><br><span class="line">  --<span class="built_in">help</span>                  Show this message and <span class="built_in">exit</span>.</span><br><span class="line"></span><br><span class="line">ğŸ’¬ ä¸º bool ç±»å‹çš„å‚æ•°åˆ›å»ºäº† --formal and --no-formal é€‰é¡¹ ğŸ‰</span><br><span class="line"></span><br><span class="line">ğŸ’¬ æ‰§è¡Œä¸‹ hello å‘½ä»¤</span><br><span class="line"></span><br><span class="line">python main.py hello Camila</span><br><span class="line"></span><br><span class="line">Hello Camila</span><br><span class="line"></span><br><span class="line">ğŸ’¬ å†æ‰§è¡Œä¸‹ goodbye å‘½ä»¤</span><br><span class="line"></span><br><span class="line">python main.py goodbye Camila</span><br><span class="line"></span><br><span class="line">Bye Camila!</span><br><span class="line"></span><br><span class="line">ğŸ’¬ å†åŠ ä¸Š --formal</span><br><span class="line"></span><br><span class="line">python main.py goodbye --formal Camila</span><br><span class="line"></span><br><span class="line">Goodbye Ms. Camila. Have a good day.</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åªéœ€å£°æ˜ä¸€æ¬¡å‡½æ•°å…¥å‚ç±»å‹ï¼Œå³å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦è‡ªåŠ¨è¡¥é½å‘½ä»¤åŠŸèƒ½çš„ç¨‹åºã€‚</p><p>æ›´å¤šå†…å®¹ï¼Œè¯¦è§å®˜ç½‘æ•™ç¨‹ï¼š<a href="https://typer.tiangolo.com/tutorial/" target="_blank" rel="noopener">https://typer.tiangolo.com/tutorial/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Typer æ˜¯ä¸€ä¸ªäººè§äººçˆ±ï¼ŒèŠ±è§èŠ±å¼€çš„ç”¨äºæ„å»º CLI ç¨‹åºçš„åº“ï¼ŒåŸºäº Python 3.6+çš„ç±»å‹æç¤ºï¼ˆtype hintsï¼‰ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="default" scheme="http://jiezhi.github.io/categories/default/"/>
    
    
  </entry>
  
  <entry>
    <title>mongo-on-hive</title>
    <link href="http://jiezhi.github.io/2020/08/28/mongo-on-hive/"/>
    <id>http://jiezhi.github.io/2020/08/28/mongo-on-hive/</id>
    <published>2020-08-28T09:00:18.000Z</published>
    <updated>2020-08-28T09:12:53.764Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">59</span>:<span class="number">20</span>,<span class="number">376</span> ERROR [main] org.apache.hadoop.mapred.YarnChild: Error running child : java.lang.NoSuchMethodError: org.apache.hadoop.hive.ql.exec.Utilities.deserializeExpression(Ljava/lang/String;)Lorg/apache/hadoop/hive/ql/plan/ExprNodeGenericFuncDesc;</span><br><span class="line">at com.mongodb.hadoop.hive.input.HiveMongoInputFormat.getFilter(HiveMongoInputFormat.java:<span class="number">134</span>)</span><br><span class="line">at com.mongodb.hadoop.hive.input.HiveMongoInputFormat.getRecordReader(HiveMongoInputFormat.java:<span class="number">103</span>)</span><br><span class="line">at org.apache.hadoop.hive.ql.io.HiveInputFormat.getRecordReader(HiveInputFormat.java:<span class="number">295</span>)</span><br><span class="line">at org.apache.hadoop.hive.ql.io.CombineHiveInputFormat.getRecordReader(CombineHiveInputFormat.java:<span class="number">685</span>)</span><br><span class="line">at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.&lt;init&gt;(MapTask.java:<span class="number">175</span>)</span><br><span class="line">at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:<span class="number">444</span>)</span><br><span class="line">at org.apache.hadoop.mapred.MapTask.run(MapTask.java:<span class="number">349</span>)</span><br><span class="line">at org.apache.hadoop.mapred.YarnChild$<span class="number">2</span>.run(YarnChild.java:<span class="number">174</span>)</span><br><span class="line">at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">at javax.security.auth.Subject.doAs(Subject.java:<span class="number">422</span>)</span><br><span class="line">at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:<span class="number">1875</span>)</span><br><span class="line">at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:<span class="number">168</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">18</span>:<span class="number">59</span>:<span class="number">20</span>,<span class="number">478</span> INFO [main] org.apache.hadoop.metrics2.impl.MetricsSystemImpl: Stopping MapTask metrics system...</span><br><span class="line"><span class="number">18</span>:<span class="number">59</span>:<span class="number">20</span>,<span class="number">478</span> INFO [main] org.apache.hadoop.metrics2.impl.MetricsSystemImpl: MapTask metrics system stopped.</span><br><span class="line"><span class="number">18</span>:<span class="number">59</span>:<span class="number">20</span>,<span class="number">478</span> INFO [main] org.apache.hadoop.metrics2.impl.MetricsSystemImpl: MapTask metrics system shutdown complete.</span><br></pre></td></tr></table></figure><p><a href="https://github.com/mongodb/mongo-hadoop/pull/147/files" target="_blank" rel="noopener">https://github.com/mongodb/mongo-hadoop/pull/147/files</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/spa
      
    
    </summary>
    
      <category term="default" scheme="http://jiezhi.github.io/categories/default/"/>
    
    
  </entry>
  
  <entry>
    <title>Atlaså‡çº§2.1.0å‡ºé”™ä¿®å¤ï¼ˆCDH 6.3.1ï¼‰</title>
    <link href="http://jiezhi.github.io/2020/08/18/atlas2-hive-hook-error/"/>
    <id>http://jiezhi.github.io/2020/08/18/atlas2-hive-hook-error/</id>
    <published>2020-08-18T03:40:40.000Z</published>
    <updated>2020-08-18T08:37:48.384Z</updated>
    
    <content type="html"><![CDATA[<p>ã€æ—§å±±æ¾ç«¹è€ï¼Œé˜»å½’ç¨‹ã€‚ã€â€”â€” å²³é£ ã€Šå°é‡å±±ã€‹<br><a id="more"></a></p><p>å‡çº§åå‘ç° Hive è°ƒç”¨ Atlas Hook æŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[HiveServer2-Background-Pool: Thread-<span class="number">52</span>]: HiveHook.run(): failed to process operation CREATETABLE</span><br><span class="line">java.lang.NoSuchMethodError: org.apache.hadoop.hive.metastore.api.Database.getCatalogName()Ljava/lang/String;</span><br><span class="line">at org.apache.atlas.hive.bridge.HiveMetaStoreBridge.getDatabaseName(HiveMetaStoreBridge.java:<span class="number">577</span>) ~[hive-bridge-<span class="number">2.1</span>.0.jar:<span class="number">2.1</span>.0]</span><br><span class="line">at org.apache.atlas.hive.hook.AtlasHiveHookContext.getQualifiedName(AtlasHiveHookContext.java:<span class="number">201</span>) ~[hive-bridge-<span class="number">2.1</span>.0.jar:<span class="number">2.1</span>.0]</span><br><span class="line">at org.apache.atlas.hive.hook.AtlasHiveHookContext.init(AtlasHiveHookContext.java:<span class="number">293</span>) ~[hive-bridge-<span class="number">2.1</span>.0.jar:<span class="number">2.1</span>.0]</span><br><span class="line">at org.apache.atlas.hive.hook.AtlasHiveHookContext.&lt;init&gt;(AtlasHiveHookContext.java:<span class="number">83</span>) ~[hive-bridge-<span class="number">2.1</span>.0.jar:<span class="number">2.1</span>.0]</span><br><span class="line">at org.apache.atlas.hive.hook.AtlasHiveHookContext.&lt;init&gt;(AtlasHiveHookContext.java:<span class="number">64</span>) ~[hive-bridge-<span class="number">2.1</span>.0.jar:<span class="number">2.1</span>.0]</span><br><span class="line">at org.apache.atlas.hive.hook.HiveHook.run(HiveHook.java:<span class="number">175</span>) [hive-bridge-<span class="number">2.1</span>.0.jar:<span class="number">2.1</span>.0]</span><br><span class="line">at org.apache.atlas.hive.hook.HiveHook.run(HiveHook.java:<span class="number">52</span>) [hive-bridge-shim-<span class="number">2.1</span>.0.jar:<span class="number">2.1</span>.0]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.execute(Driver.java:<span class="number">1960</span>) [hive-exec-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:<span class="number">1563</span>) [hive-exec-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.run(Driver.java:<span class="number">1339</span>) [hive-exec-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.run(Driver.java:<span class="number">1334</span>) [hive-exec-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at org.apache.hive.service.cli.operation.SQLOperation.runQuery(SQLOperation.java:<span class="number">256</span>) [hive-service-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at org.apache.hive.service.cli.operation.SQLOperation.access$<span class="number">600</span>(SQLOperation.java:<span class="number">92</span>) [hive-service-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at org.apache.hive.service.cli.operation.SQLOperation$BackgroundWork$<span class="number">1</span>.run(SQLOperation.java:<span class="number">345</span>) [hive-service-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at java.security.AccessController.doPrivileged(Native Method) ~[?:<span class="number">1.8</span>.0_181]</span><br><span class="line">at javax.security.auth.Subject.doAs(Subject.java:<span class="number">422</span>) [?:<span class="number">1.8</span>.0_181]</span><br><span class="line">at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:<span class="number">1875</span>) [hadoop-common-<span class="number">3.0</span>.0-cdh6.3.1.jar:?]</span><br><span class="line">at org.apache.hive.service.cli.operation.SQLOperation$BackgroundWork.run(SQLOperation.java:<span class="number">357</span>) [hive-service-<span class="number">2.1</span>.1-cdh6.3.1.jar:<span class="number">2.1</span>.1-cdh6.3.1]</span><br><span class="line">at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:<span class="number">511</span>) [?:<span class="number">1.8</span>.0_181]</span><br><span class="line">at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">266</span>) [?:<span class="number">1.8</span>.0_181]</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>) [?:<span class="number">1.8</span>.0_181]</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>) [?:<span class="number">1.8</span>.0_181]</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>) [?:<span class="number">1.8</span>.0_181]</span><br></pre></td></tr></table></figure></p><p>æ’æŸ¥åå‘ç° Atlas ä»£ç ä¸­ç”¨çš„ Hive ç‰ˆæœ¬ä¸º3.1.0ï¼Œè€Œç›®å‰ CDH 6.3.1çš„ Hive æ˜¯ 2.1.1ã€‚hive-bridge æ¨¡å—ä¸­è°ƒç”¨äº†2.1.1ç‰ˆæœ¬ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•æŠ¥é”™å¯¼è‡´ã€‚</p><p>æ‰€ä»¥ä¿®æ”¹<code>addons/hive-bridge/src/main/java/org/apache/atlas/hive/bridge/HiveMetaStoreBridge.java</code>ä¸­çš„<code>getDatabaseName()</code>æ–¹æ³•å³å¯ã€‚</p><p>ä¿®æ”¹å‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDatabaseName</span><span class="params">(Database hiveDB)</span> </span>&#123;</span><br><span class="line">    String dbName      = hiveDB.getName().toLowerCase();</span><br><span class="line">    String catalogName = hiveDB.getCatalogName() != <span class="keyword">null</span> ? hiveDB.getCatalogName().toLowerCase() : <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotEmpty(catalogName) &amp;&amp; !StringUtils.equals(catalogName, DEFAULT_METASTORE_CATALOG)) &#123;</span><br><span class="line">        dbName = catalogName + SEP + dbName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dbName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹åï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDatabaseName</span><span class="params">(Database hiveDB)</span> </span>&#123;</span><br><span class="line">    String dbName      = hiveDB.getName().toLowerCase();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    String catalogName = hiveDB.getCatalogName() != null ? hiveDB.getCatalogName().toLowerCase() : null;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    if (StringUtils.isNotEmpty(catalogName) &amp;&amp; !StringUtils.equals(catalogName, DEFAULT_METASTORE_CATALOG)) &#123;</span></span><br><span class="line"><span class="comment">        dbName = catalogName + SEP + dbName;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dbName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶åé‡æ–°è¿›<code>addons/hive-bridge</code>ç›®å½•ä¸‹æ‰“åŒ…å‡º hive-bridge-2.1.0.jarã€‚</p><p>æœ€åç”¨è¿™ä¸ªæ–°çš„åŒ…æ›¿æ¢<code>atlas-hive-plugin-impl</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œé‡å¯ HiveServer2 å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ã€æ—§å±±æ¾ç«¹è€ï¼Œé˜»å½’ç¨‹ã€‚ã€â€”â€” å²³é£ ã€Šå°é‡å±±ã€‹&lt;br&gt;
    
    </summary>
    
      <category term="BigData" scheme="http://jiezhi.github.io/categories/BigData/"/>
    
    
      <category term="Atlas" scheme="http://jiezhi.github.io/tags/Atlas/"/>
    
      <category term="CDH" scheme="http://jiezhi.github.io/tags/CDH/"/>
    
      <category term="BigData" scheme="http://jiezhi.github.io/tags/BigData/"/>
    
  </entry>
  
  <entry>
    <title>CDH ä¸­ Flume é…ç½®åŠæ‹¦æˆªå™¨çš„å®ç°</title>
    <link href="http://jiezhi.github.io/2020/06/03/cdh-flume-custom-interceptor/"/>
    <id>http://jiezhi.github.io/2020/06/03/cdh-flume-custom-interceptor/</id>
    <published>2020-06-03T09:05:34.000Z</published>
    <updated>2020-08-18T08:29:17.758Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•é…ç½® Flume ä»¥åŠè‡ªå®šä¹‰ Flume æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰çš„è¿‡ç¨‹ã€‚<br><a id="more"></a></p><h1 id="Flume-é…ç½®"><a href="#Flume-é…ç½®" class="headerlink" title="Flume é…ç½®"></a>Flume é…ç½®</h1><h2 id="å †å†…å­˜è®¾ç½®"><a href="#å †å†…å­˜è®¾ç½®" class="headerlink" title="å †å†…å­˜è®¾ç½®"></a>å †å†…å­˜è®¾ç½®</h2><p> CDH ä¸­æ·»åŠ  flume åå¥½åƒé»˜è®¤ç»™äº†50M å †å†…å­˜ï¼Œæµ‹è¯•ç”¨ç”¨å¯ä»¥ï¼Œå®é™…ä½¿ç”¨è¿˜æ˜¯æ”¹æˆ1G æˆ–ä»¥ä¸Šå§ã€‚</p><img src="/2020/06/03/cdh-flume-custom-interceptor/flume-heap.png"><h2 id="Hive-ç›¸å…³é…ç½®"><a href="#Hive-ç›¸å…³é…ç½®" class="headerlink" title="Hive ç›¸å…³é…ç½®"></a>Hive ç›¸å…³é…ç½®</h2><p>å¦‚æœéœ€è¦æŠŠæ•°æ® sink åˆ° hive çš„è¯ï¼Œflume å¯èƒ½ä¼šå› ä¸ºæ‰¾ä¸åˆ° Hive ç›¸å…³ä¾èµ–æŠ¥é”™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Failed to start agent because dependencies were not found in classpath. Error follows.</span><br><span class="line">java.lang.NoClassDefFoundError: org/apache/hive/hcatalog/streaming/RecordWriter</span><br><span class="line">at org.apache.flume.sink.hive.HiveSink.createSerializer(HiveSink.java:<span class="number">223</span>)</span><br><span class="line">at org.apache.flume.sink.hive.HiveSink.configure(HiveSink.java:<span class="number">203</span>)</span><br><span class="line">at org.apache.flume.conf.Configurables.configure(Configurables.java:<span class="number">41</span>)</span><br><span class="line">at org.apache.flume.node.AbstractConfigurationProvider.loadSinks(AbstractConfigurationProvider.java:<span class="number">453</span>)</span><br><span class="line">at org.apache.flume.node.AbstractConfigurationProvider.getConfiguration(AbstractConfigurationProvider.java:<span class="number">106</span>)</span><br><span class="line">at org.apache.flume.node.PollingPropertiesFileConfigurationProvider$FileWatcherRunnable.run(PollingPropertiesFileConfigurationProvider.java:<span class="number">145</span>)</span><br><span class="line">at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:<span class="number">511</span>)</span><br><span class="line">at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:<span class="number">308</span>)</span><br><span class="line">at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$<span class="number">301</span>(ScheduledThreadPoolExecutor.java:<span class="number">180</span>)</span><br><span class="line">at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:<span class="number">294</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: org.apache.hive.hcatalog.streaming.RecordWriter</span><br><span class="line">at java.net.URLClassLoader.findClass(URLClassLoader.java:<span class="number">381</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">424</span>)</span><br><span class="line">at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:<span class="number">349</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">357</span>)</span><br><span class="line">... <span class="number">13</span> more</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆéœ€è¦é…ç½®ä¸‹ Flume env çš„é…ç½®ï¼ŒHIVE_HOME å’Œ HCAT_HOME å…·ä½“ä½ç½®æ ¹æ®æƒ…å†µå¡«å†™<br><img src="/2020/06/03/cdh-flume-custom-interceptor/flume-env.png"></p><hr><h1 id="Flume-ä»-Kafka-è¯»å–æ•°æ®è§£æè‡³-Hive-ä¸­"><a href="#Flume-ä»-Kafka-è¯»å–æ•°æ®è§£æè‡³-Hive-ä¸­" class="headerlink" title="Flume ä» Kafka è¯»å–æ•°æ®è§£æè‡³ Hive ä¸­"></a>Flume ä» Kafka è¯»å–æ•°æ®è§£æè‡³ Hive ä¸­</h1><h2 id="Flume-é…ç½®æ–‡ä»¶"><a href="#Flume-é…ç½®æ–‡ä»¶" class="headerlink" title="Flume é…ç½®æ–‡ä»¶"></a>Flume é…ç½®æ–‡ä»¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># For Data Flow</span><br><span class="line">tier1.sources=source1</span><br><span class="line">tier1.channels=channel1</span><br><span class="line">tier1.sinks=sink1</span><br><span class="line"></span><br><span class="line"># Source</span><br><span class="line">tier1.sources.source1.interceptors=i1</span><br><span class="line">tier1.sources.source1.interceptors.i1.type=io.jiezhi.dw.flume.interceptor.EventsInterceptor$Builder</span><br><span class="line"></span><br><span class="line">tier1.sources.source1.type=org.apache.flume.source.kafka.KafkaSource</span><br><span class="line">tier1.sources.source1.channels = channel1</span><br><span class="line">tier1.sources.source1.batchSize = <span class="number">15000</span></span><br><span class="line">tier1.sources.source1.batchDurationMillis = <span class="number">2000</span></span><br><span class="line">tier1.sources.source1.kafka.bootstrap.servers = node1:<span class="number">9092</span>,node2:<span class="number">9092</span>,node3:<span class="number">9092</span></span><br><span class="line">tier1.sources.source1.kafka.topics = test_topic</span><br><span class="line">tier1.sources.source1.kafka.consumer.group.id = dw</span><br><span class="line"></span><br><span class="line"># Channel</span><br><span class="line">tier1.channels.channel1.type=memory</span><br><span class="line">tier1.channels.channel1.capacity=<span class="number">15000</span></span><br><span class="line">tier1.channels.channel1.transactionCapacity=<span class="number">15000</span></span><br><span class="line"></span><br><span class="line"># Sink</span><br><span class="line">tier1.sinks.sink1.channel=channel1</span><br><span class="line">tier1.sinks.sink1.type=hive</span><br><span class="line">tier1.sinks.sink1.hive.metastore=thrift:<span class="comment">//node1:9083</span></span><br><span class="line">tier1.sinks.sink1.hive.batchSize=<span class="number">15000</span></span><br><span class="line">tier1.sinks.sink1.hive.database=test</span><br><span class="line">tier1.sinks.sink1.hive.table=test_tbl</span><br><span class="line">tier1.sinks.sink1.serializer=JSON</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢ç”¨äº†è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰å› ä¸ºä» Kafka ä¸­è·å–çš„æ•°æ®ä¸èƒ½ç›´æ¥æ’å…¥åˆ° Hive è¡¨ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä»ä¸­è½¬æ¢ä¸‹æ ¼å¼ã€‚</p><h2 id="Hive-å»ºè¡¨"><a href="#Hive-å»ºè¡¨" class="headerlink" title="Hive å»ºè¡¨"></a>Hive å»ºè¡¨</h2><p>å¿…é¡»æ˜¯<code>äº‹åŠ¡è¡¨</code>ä¸”éœ€è¦<code>åˆ†æ¡¶</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.test_tbl (</span><br><span class="line">    <span class="string">`id`</span>           <span class="built_in">BIGINT</span>,</span><br><span class="line">    <span class="string">`time`</span>                <span class="built_in">BIGINT</span>,</span><br><span class="line">    <span class="string">`event`</span>               <span class="keyword">STRING</span>,</span><br><span class="line">    <span class="string">`type`</span>                <span class="keyword">STRING</span>,</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">`platform`</span>            <span class="keyword">STRING</span>,</span><br><span class="line">    <span class="string">`params`</span>              <span class="keyword">STRING</span></span><br><span class="line">)</span><br><span class="line">    CLUSTERED <span class="keyword">BY</span> (<span class="string">`id`</span>) <span class="keyword">INTO</span> <span class="number">11</span> BUCKETS </span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> ORC TBLPROPERTIES (<span class="string">'transactional'</span> = <span class="string">'true'</span>);</span><br></pre></td></tr></table></figure><h2 id="è¯»å–Hiveæ•°æ®"><a href="#è¯»å–Hiveæ•°æ®" class="headerlink" title="è¯»å–Hiveæ•°æ®"></a>è¯»å–Hiveæ•°æ®</h2><p>æŠ¥é”™ï¼š</p><p><code>This command is not allowed on an ACID table test.test_tbl with a non-ACID transaction manager.Failed command: SELECT * from test.test_tbl LIMIT 10.</code></p><p>è¦è®¾ç½®ä¸€ä¸‹åæŸ¥è¯¢ï¼š</p><p><code>SET hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;</code></p><p>å¯å‚è§<a href="https://stackoverflow.com/questions/42669171/semanticexception-error-10265-while-running-simple-hive-select-query-on-a-tran" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><h2 id="å®ç°Flumeæ‹¦æˆªå™¨"><a href="#å®ç°Flumeæ‹¦æˆªå™¨" class="headerlink" title="å®ç°Flumeæ‹¦æˆªå™¨"></a>å®ç°Flumeæ‹¦æˆªå™¨</h2><p>å¦‚æœä» Source è·å¾—çš„æ•°æ®ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œé‚£ä¹ˆä¸€ç§æ–¹å¼æ˜¯å…ˆè½åˆ° HDFSï¼Œç„¶åç”¨ Spark ç­‰ç¨‹åºå¤„ç†åå†è½åˆ° Hive ä¸­ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯å®ç° Flume æ‹¦æˆªå™¨ã€‚è¿™è¾¹é‡‡ç”¨åä¸€ç§æ–¹å¼ã€‚</p><p>å…¶å®å¾ˆç®€å•ï¼š</p><h3 id="é…ç½®ä¾èµ–ï¼š"><a href="#é…ç½®ä¾èµ–ï¼š" class="headerlink" title="é…ç½®ä¾èµ–ï¼š"></a>é…ç½®ä¾èµ–ï¼š</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-ng-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å®ç°Interceptorçš„æ¥å£"><a href="#å®ç°Interceptorçš„æ¥å£" class="headerlink" title="å®ç°Interceptorçš„æ¥å£"></a>å®ç°Interceptorçš„æ¥å£</h3><p>é‡ç‚¹æ˜¯åœ¨intercept()æ–¹æ³•ä¸­å®ç°å¯¹åº”çš„é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventsInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">implements</span> <span class="title">Interceptor</span>.<span class="title">Builder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Interceptor <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UserEventsInterceptor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] convertUserEvent(<span class="keyword">byte</span>[] body) &#123;</span><br><span class="line">        <span class="comment">// Do something</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Event <span class="title">intercept</span><span class="params">(Event event)</span> </span>&#123;</span><br><span class="line">        event.setBody(convertJson(event.getBody()));</span><br><span class="line">        <span class="keyword">return</span> event;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Event&gt; <span class="title">intercept</span><span class="params">(List&lt;Event&gt; events)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Event event : events) &#123;</span><br><span class="line">            intercept(event);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> events;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å <code>mvn clean package</code> åæŠŠjar åŒ…æ”¾åˆ° flume agent çš„èŠ‚ç‚¹ä¸Šï¼Œå½“ç„¶æ”¾çš„ä½ç½®æ ¹æ®<code>ps aux | grep flume-ng</code>æ¥å†³å®šï¼Œæ¯”å¦‚æˆ‘è¿™è¾¹å°±æ˜¯<code>/data/opt/cloudera/parcels/CDH-6.3.1-1.cdh6.3.1.p0.1470567/lib/flume-ng/lib/</code></p><p>ç„¶åé‡å¯ Flume å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½•é…ç½® Flume ä»¥åŠè‡ªå®šä¹‰ Flume æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰çš„è¿‡ç¨‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="BigData" scheme="http://jiezhi.github.io/categories/BigData/"/>
    
    
      <category term="BigData" scheme="http://jiezhi.github.io/tags/BigData/"/>
    
      <category term="Flume" scheme="http://jiezhi.github.io/tags/Flume/"/>
    
  </entry>
  
  <entry>
    <title>CDH6é…ç½® Atlasï¼ŒåŠ Hive Hook</title>
    <link href="http://jiezhi.github.io/2020/03/31/atlas2-cdh6-hive-hook/"/>
    <id>http://jiezhi.github.io/2020/03/31/atlas2-cdh6-hive-hook/</id>
    <published>2020-03-31T07:03:57.000Z</published>
    <updated>2020-08-18T08:28:38.207Z</updated>
    
    <content type="html"><![CDATA[<p>å› ä¸º CDH ç¤¾åŒºç‰ˆä¸èƒ½ä½¿ç”¨ <a href="https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/datamgmt_intro.html#intro_to_cloudera_navigator_data_mgmt" target="_blank" rel="noopener">Navigator</a>ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±é›†æˆä¸€ä¸ª<a href="https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/datamgmt_intro.html#intro_to_cloudera_navigator_data_mgmt" target="_blank" rel="noopener">Apache Atlas</a>ã€‚</p><a id="more"></a><h1 id="ç‰ˆæœ¬è¯´æ˜"><a href="#ç‰ˆæœ¬è¯´æ˜" class="headerlink" title="ç‰ˆæœ¬è¯´æ˜"></a>ç‰ˆæœ¬è¯´æ˜</h1><p>20200818 Updated: ç›®å‰æœ€æ–°ç‰ˆæ˜¯2.1.0ï¼Œå¦‚æœ Hive ç‰ˆæœ¬æ˜¯3.1ä¸€ä¸‹çš„ï¼Œå¯èƒ½å­˜åœ¨ä¸å…¼å®¹é—®é¢˜ã€‚<br>åœ¨ç¼–è¯‘å‰ä¿®æ”¹ä¸‹æºç ï¼Œå‚è€ƒ<a href="/2020/08/18/atlas2-hive-hook-error/">è¿™ç¯‡</a>ã€‚</p><p>Atlas: 2.0 <a href="https://atlas.apache.org/#/Downloads" target="_blank" rel="noopener">Download</a></p><p>CDH: 6.3.1 (Parcels)</p><h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><p>Atlas ä¾èµ– Solrï¼ˆæˆ– ESï¼‰ã€HBaseå’Œ Kafka æ¥å·¥ä½œï¼Œå…ˆç¡®ä¿ CDH è¿™3ä¸ªå·²ç»å¼€å¯ï¼Œæˆ–è€…ç¼–è¯‘ Atlasä»£ç æ—¶é›†æˆè¿›å»ï¼ˆç”Ÿäº§ä¸å»ºè®®ï¼‰ã€‚</p><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><p>ä»å®˜ç½‘ä¸‹è½½Atlas 2.0çš„ä»£ç ï¼Œç„¶åè¿›è¡Œç¼–è¯‘ï¼Œè¯¦è§å®˜ç½‘ï¼ˆåŸºæœ¬æ²¡å•¥å‘ï¼Œé™¤é maven ç‰ˆæœ¬å¤ªä½ï¼Œå»ä¸‹ä¸€ä¸ªæœ€æ–°çš„å³å¯ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar xvfz apache-atlas-2.0.0-sources.tar.gz</span><br><span class="line"><span class="built_in">cd</span> apache-atlas-sources-2.0.0/</span><br><span class="line"><span class="built_in">export</span> MAVEN_OPTS=<span class="string">"-Xms2g -Xmx2g"</span></span><br><span class="line">mvn clean -DskipTests install</span><br><span class="line">mvn clean -DskipTests package -Pdist</span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘å¥½çš„ä½ç½®åœ¨<code>distro/target/</code>ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 target]<span class="comment"># ll distro/target</span></span><br><span class="line">total 738M</span><br><span class="line">drwxr-xr-x. 3 root root   32 Mar 31 10:08 apache-atlas-2.0.0-bin</span><br><span class="line">-rw-r--r--. 1 root root 360M Mar 31 10:08 apache-atlas-2.0.0-bin.tar.gz</span><br><span class="line">drwxr-xr-x. 3 root root   44 Mar 31 10:08 apache-atlas-2.0.0-falcon-hook</span><br><span class="line">-rw-r--r--. 1 root root 8.8M Mar 31 10:08 apache-atlas-2.0.0-falcon-hook.tar.gz</span><br><span class="line">drwxr-xr-x. 3 root root   43 Mar 31 10:08 apache-atlas-2.0.0-hbase-hook</span><br><span class="line">-rw-r--r--. 1 root root  11M Mar 31 10:08 apache-atlas-2.0.0-hbase-hook.tar.gz</span><br><span class="line">drwxr-xr-x. 3 root root   42 Mar 31 10:08 apache-atlas-2.0.0-hive-hook</span><br><span class="line">-rw-r--r--. 1 root root  16M Mar 31 10:08 apache-atlas-2.0.0-hive-hook.tar.gz</span><br><span class="line">drwxr-xr-x. 3 root root   43 Mar 31 10:08 apache-atlas-2.0.0-kafka-hook</span><br><span class="line">-rw-r--r--. 1 root root 8.8M Mar 31 10:08 apache-atlas-2.0.0-kafka-hook.tar.gz</span><br><span class="line">drwxr-xr-x. 3 root root   32 Mar 31 10:08 apache-atlas-2.0.0-server</span><br><span class="line">-rw-r--r--. 1 root root 260M Mar 31 10:08 apache-atlas-2.0.0-server.tar.gz</span><br><span class="line">-rw-r--r--. 1 root root  11M Mar 31 10:08 apache-atlas-2.0.0-sources.tar.gz</span><br><span class="line">drwxr-xr-x. 3 root root   43 Mar 31 10:08 apache-atlas-2.0.0-sqoop-hook</span><br><span class="line">-rw-r--r--. 1 root root 8.8M Mar 31 10:08 apache-atlas-2.0.0-sqoop-hook.tar.gz</span><br><span class="line">drwxr-xr-x. 3 root root   43 Mar 31 10:08 apache-atlas-2.0.0-storm-hook</span><br><span class="line">-rw-r--r--. 1 root root  57M Mar 31 10:08 apache-atlas-2.0.0-storm-hook.tar.gz</span><br><span class="line">drwxr-xr-x. 2 root root    6 Mar 31 10:08 archive-tmp</span><br><span class="line">-rw-r--r--. 1 root root  94K Mar 31 10:08 atlas-distro-2.0.0.jar</span><br><span class="line">drwxr-xr-x. 2 root root 4.0K Mar 31 10:08 bin</span><br><span class="line">drwxr-xr-x. 5 root root  231 Mar 31 10:08 conf</span><br><span class="line">drwxr-xr-x. 2 root root   28 Mar 31 10:08 maven-archiver</span><br><span class="line">drwxr-xr-x. 3 root root   22 Mar 31 10:08 maven-shared-archive-resources</span><br><span class="line">drwxr-xr-x. 2 root root   55 Mar 31 10:08 META-INF</span><br><span class="line">-rw-r--r--. 1 root root 3.9K Mar 31 10:08 rat.txt</span><br><span class="line">drwxr-xr-x. 3 root root   22 Mar 31 10:08 <span class="built_in">test</span>-classes</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>apache-atlas-2.0.0-bin.tar.gz</code>å’Œéœ€è¦ hook çš„ç»„ä»¶å¦‚ï¼š<code>apache-atlas-2.0.0-hive-hook.tar.gz</code> ã€<code>apache-atlas-2.0.0-sqoop-hook.tar.gz</code></p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>å°†éœ€è¦çš„ tar.gzæ–‡ä»¶è§£å‹åˆ°æŒ‡å®šç›®å½•å¦‚<code>/opt/atlas</code></p><p>æ”¹å‡ ä¸ªå…³é”®çš„é…ç½®<code>vim conf/atlas-application.properties</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">atlas.graph.storage.hostname=node1:2181,node2:2181,node3:2181</span><br><span class="line"></span><br><span class="line"><span class="comment">#Solr</span></span><br><span class="line"><span class="comment">#Solr cloud mode properties</span></span><br><span class="line">atlas.graph.index.search.solr.mode=cloud</span><br><span class="line">atlas.graph.index.search.solr.zookeeper-url=node1:2181/solr,node2:2181/solr,node3:2181/solr</span><br><span class="line">atlas.graph.index.search.solr.zookeeper-connect-timeout=60000</span><br><span class="line">atlas.graph.index.search.solr.zookeeper-session-timeout=60000</span><br><span class="line">atlas.graph.index.search.solr.wait-searcher=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#########  Notification Configs  #########</span></span><br><span class="line">atlas.notification.embedded=<span class="literal">false</span></span><br><span class="line">atlas.kafka.data=<span class="variable">$&#123;sys:atlas.home&#125;</span>/data/kafka</span><br><span class="line">atlas.kafka.zookeeper.connect=node1:2181,node2:2181,node3:2181</span><br><span class="line">atlas.kafka.bootstrap.servers=node1:9092,node2:9092,node3:9092</span><br><span class="line">atlas.kafka.zookeeper.session.timeout.ms=4000</span><br><span class="line">atlas.kafka.zookeeper.connection.timeout.ms=2000</span><br><span class="line">atlas.kafka.zookeeper.sync.time.ms=20</span><br><span class="line">atlas.kafka.auto.commit.interval.ms=1000</span><br><span class="line">atlas.kafka.hook.group.id=atlas</span><br><span class="line"></span><br><span class="line"><span class="comment">#########  Server Properties  #########</span></span><br><span class="line">atlas.rest.address=http://0.0.0.0:21001</span><br><span class="line"></span><br><span class="line"><span class="comment">#########  Entity Audit Configs  #########</span></span><br><span class="line">atlas.audit.hbase.tablename=apache_atlas_entity_audit</span><br><span class="line">atlas.audit.zookeeper.session.timeout.ms=1000</span><br><span class="line">atlas.audit.hbase.zookeeper.quorum=node1:2181,node2:2181,node3:2181</span><br><span class="line"></span><br><span class="line"><span class="comment">## Server port configuration ï¼ˆè¿™è¾¹ä½¿ç”¨210001ï¼Œé¿å…ç«¯å£å’Œ Impala çš„å†²çªï¼‰</span></span><br><span class="line">atlas.server.http.port=21001</span><br><span class="line"><span class="comment">#atlas.server.https.port=21443</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### ä»¥ä¸‹ä¸ºæ–°å¢é…ç½®ï¼ŒæŒ‰éœ€æ·»åŠ </span></span><br><span class="line"><span class="comment">######### Hive Hook Configs #######</span></span><br><span class="line"></span><br><span class="line">atlas.hook.hive.synchronous=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">atlas.hook.hive.numRetries=3</span><br><span class="line"></span><br><span class="line">atlas.hook.hive.queueSize=10000</span><br><span class="line"></span><br><span class="line">atlas.cluster.name=primary</span><br><span class="line"></span><br><span class="line"><span class="comment">######### Sqoop Hook Configs #######</span></span><br><span class="line">atlas.hook.sqoop.synchronous=<span class="literal">false</span> <span class="comment"># whether to run the hook synchronously. false recommended to avoid delays in Sqoop operation completion. Default: false</span></span><br><span class="line">atlas.hook.sqoop.numRetries=3      <span class="comment"># number of retries for notification failure. Default: 3</span></span><br><span class="line">atlas.hook.sqoop.queueSize=10000   <span class="comment"># queue size for the threadpool. Default: 10000</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å¯ä»¥å°è¯•å¯åŠ¨ä¸‹<code>./bin/atlas_start.py</code>å¹¶çœ‹ä¸€ä¸‹ log <code>tail -f logs/application.log</code>ï¼Œæˆ‘è¿™è¾¹é‡åˆ°äº†é—®é¢˜ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2020-03-31 11:42:57,437 INFO  - [main:] ~ Creating indexes <span class="keyword">for</span> graph. (GraphBackedS</span><br><span class="line">earchIndexer:248)</span><br><span class="line">2020-03-31 11:42:58,605 INFO  - [main:] ~ Created index : vertex_index (GraphBacked</span><br><span class="line">SearchIndexer:253)</span><br><span class="line">2020-03-31 11:42:58,692 INFO  - [main:] ~ Created index : edge_index (GraphBackedSe</span><br><span class="line">archIndexer:259)</span><br><span class="line">2020-03-31 11:42:58,700 INFO  - [main:] ~ Created index : fulltext_index (GraphBackedSearchIndexer:265)</span><br><span class="line">2020-03-31 11:42:58,824 ERROR - [main:] ~ GraphBackedSearchIndexer.initialize() failed (GraphBackedSearchIndexer:307)</span><br><span class="line">org.apache.solr.client.solrj.impl.HttpSolrClient<span class="variable">$RemoteSolrException</span>: Error from server at http://BD-Cal-Pro-02:8983/solr: Can not find the specified config <span class="built_in">set</span>: vertex_index</span><br><span class="line">        at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:627)</span><br><span class="line">        at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:253)</span><br></pre></td></tr></table></figure></p><p>ä¸çŸ¥é“ä¸ºä½• atlas æ²¡èƒ½åœ¨ solr åˆ›å»ºéœ€è¦çš„æ•°æ®ï¼Œåªèƒ½æ‰‹åŠ¨åˆ›å»ºäº†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">solrctl instancedir --create atlas conf/solr/</span><br><span class="line"></span><br><span class="line">solrctl collection --create vertex_index -s 1 -c atlas -r 1</span><br><span class="line"></span><br><span class="line">solrctl collection --create edge_index -s 1 -c atlas -r 1</span><br><span class="line"></span><br><span class="line">solrctl collection --create fulltext_index -s 1 -c atlas -r 1</span><br></pre></td></tr></table></figure></p><p>è‡³æ­¤ atlas å°±å¯ä»¥æ­£å¸¸å¯åŠ¨äº†ã€‚</p><h2 id="Jar-åŒ…é…ç½®"><a href="#Jar-åŒ…é…ç½®" class="headerlink" title="Jar åŒ…é…ç½®"></a>Jar åŒ…é…ç½®</h2><p>æŠŠé…ç½®å¤åˆ¶åˆ° hook/hive ä¸‹ï¼Œç„¶åæ‰“åŒ…è¿›atlas-plugin-classloader-2.0.0.jar</p><p><code>zip -u atlas-plugin-classloader-2.0.0.jar atlas-application.properties</code></p><p>æœ‰çš„æ•™ç¨‹æ˜¯ç›´æ¥è·¨ç›®å½•å‹ç¼©è¿›å»äº†ï¼Œä½†å®é™…æ‰§è¡Œä¼šå‡ºé”™ã€‚</p><h1 id="Hive-Hook"><a href="#Hive-Hook" class="headerlink" title="Hive Hook"></a>Hive Hook</h1><p>è¿™è¾¹éœ€è¦å»CM ä¸­ Hive é…ç½®é¡µé¢ä¿®æ”¹ï¼š</p><h3 id="Hive-Auxiliary-JARs-Directory"><a href="#Hive-Auxiliary-JARs-Directory" class="headerlink" title="Hive Auxiliary JARs Directory"></a>Hive Auxiliary JARs Directory</h3><blockquote><p>${ATLAS_HOME}/hook/hive</p></blockquote><h3 id="Gateway-Client-Environment-Advanced-Configuration-Snippet-Safety-Valve-for-hive-env-sh"><a href="#Gateway-Client-Environment-Advanced-Configuration-Snippet-Safety-Valve-for-hive-env-sh" class="headerlink" title="Gateway Client Environment Advanced Configuration Snippet (Safety Valve) for hive-env.sh"></a>Gateway Client Environment Advanced Configuration Snippet (Safety Valve) for <a href="http://hive-env.sh/" target="_blank" rel="noopener">hive-env.sh</a></h3><blockquote><p>HIVE_AUX_JARS_PATH=${ATLAS_HOME}/hook/hive</p></blockquote><h3 id="HiveServer2-Advanced-Configuration-Snippet-Safety-Valve-for-hive-site-xml"><a href="#HiveServer2-Advanced-Configuration-Snippet-Safety-Valve-for-hive-site-xml" class="headerlink" title="HiveServer2 Advanced Configuration Snippet (Safety Valve) for hive-site.xml"></a>HiveServer2 Advanced Configuration Snippet (Safety Valve) for hive-site.xml</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hive.exec.post.hooks&lt;/name&gt;</span><br><span class="line">&lt;value&gt;org.apache.atlas.hive.hook.HiveHook&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hive.reloadable.aux.jars.path&lt;/name&gt;</span><br><span class="line">&lt;value&gt;<span class="variable">$&#123;ATLAS_HOME&#125;</span>/hook/hive/&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;atlas.cluster.name&lt;/name&gt;</span><br><span class="line">&lt;value&gt;primary&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½åé‡å¯ Hiveï¼Œåˆ›å»ºä¸€å¼ æµ‹è¯•è¡¨å¯ä»¥çœ‹åˆ°Atlas ä¸­ä¼šå‡ºç°è¯¥è¡¨çš„è®°å½•ã€‚</p><h2 id="å¯¼å…¥å†å²æ•°æ®"><a href="#å¯¼å…¥å†å²æ•°æ®" class="headerlink" title="å¯¼å…¥å†å²æ•°æ®"></a>å¯¼å…¥å†å²æ•°æ®</h2><p>å¦‚æœéœ€è¦å†å²æ•°æ®ï¼Œåˆ™å¯ä»¥é€šè¿‡ hook-binä¸‹é¢çš„ import_hive.sh å¯¼å…¥å³å¯ï¼Œä¸»è¦è¦æŠŠ atlas-application.properties å¤åˆ¶åˆ° HIVE_CONF_HOME ä¸‹é¢ï¼ˆ/etc/hive/confï¼‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å› ä¸º CDH ç¤¾åŒºç‰ˆä¸èƒ½ä½¿ç”¨ &lt;a href=&quot;https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/datamgmt_intro.html#intro_to_cloudera_navigator_data_mgmt&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Navigator&lt;/a&gt;ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±é›†æˆä¸€ä¸ª&lt;a href=&quot;https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/datamgmt_intro.html#intro_to_cloudera_navigator_data_mgmt&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Apache Atlas&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="BigData" scheme="http://jiezhi.github.io/categories/BigData/"/>
    
    
      <category term="Atlas" scheme="http://jiezhi.github.io/tags/Atlas/"/>
    
      <category term="CDH" scheme="http://jiezhi.github.io/tags/CDH/"/>
    
      <category term="Hive" scheme="http://jiezhi.github.io/tags/Hive/"/>
    
  </entry>
  
  <entry>
    <title>CDHä¸­sqoopæ— æ³•åœ¨ hue ä¸­æ­£ç¡®æ‰§è¡Œçš„é—®é¢˜</title>
    <link href="http://jiezhi.github.io/2020/01/17/run-sqoop-with-oozie-in-hue/"/>
    <id>http://jiezhi.github.io/2020/01/17/run-sqoop-with-oozie-in-hue/</id>
    <published>2020-01-17T09:38:36.000Z</published>
    <updated>2020-01-17T10:24:19.694Z</updated>
    
    <content type="html"><![CDATA[<p>JDBCçš„é…ç½®ç»™ä½ å¸¦æ¥å¤šå°‘çš„éº»çƒ¦ï¼Ÿ</p><a id="more"></a><p>å®‰è£…å¥½ CDH åï¼Œæ·»åŠ å®Œ sqoop 1æœåŠ¡åï¼Œå» hue ä¸­æ‰§è¡Œç›´æ¥æŠ¥é”™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">No child hadoop job is executed.</span><br><span class="line">java.lang.reflect.InvocationTargetException</span><br><span class="line">  ...</span><br><span class="line">at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:<span class="number">1875</span>)</span><br><span class="line">at org.apache.oozie.action.hadoop.LauncherAM.main(LauncherAM.java:<span class="number">141</span>)</span><br><span class="line">Caused by: java.lang.SecurityException: Intercepted System.exit(<span class="number">1</span>)</span><br><span class="line">at org.apache.oozie.action.hadoop.security.LauncherSecurityManager.checkExit(LauncherSecurityManager.java:<span class="number">57</span>)</span><br><span class="line">at java.lang.Runtime.exit(Runtime.java:<span class="number">107</span>)</span><br><span class="line">at java.lang.System.exit(System.java:<span class="number">971</span>)</span><br><span class="line">at org.apache.sqoop.Sqoop.main(Sqoop.java:<span class="number">252</span>)</span><br><span class="line">at org.apache.oozie.action.hadoop.SqoopMain.runSqoopJob(SqoopMain.java:<span class="number">214</span>)</span><br><span class="line">at org.apache.oozie.action.hadoop.SqoopMain.run(SqoopMain.java:<span class="number">199</span>)</span><br><span class="line">at org.apache.oozie.action.hadoop.LauncherMain.run(LauncherMain.java:<span class="number">104</span>)</span><br><span class="line">at org.apache.oozie.action.hadoop.SqoopMain.main(SqoopMain.java:<span class="number">51</span>)</span><br><span class="line">... <span class="number">16</span> more</span><br><span class="line">Intercepting System.exit(<span class="number">1</span>)</span><br><span class="line">Failing Oozie Launcher, Main Class [org.apache.oozie.action.hadoop.SqoopMain], exit code [<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>å›´ç»•è¿™ä¸ªé—®é¢˜æ‰¾äº†å¾ˆä¹…çš„éƒ½æ— æ³•æ‰¾åˆ°å¯¹åº”çš„é—®é¢˜ï¼Œä¹‹å‰éƒ½æ˜¯ç›´æ¥å» YARN é‡Œçœ‹çš„ Logã€‚è¿™ä¸¤å¤©å»çœ‹äº† stderr é‡Œçš„é”™è¯¯æ‰å‘ç°æ˜¯ JDBC é©±åŠ¨é€ æˆçš„é—®é¢˜ï¼ˆåæ§½ä¸‹æŸéª¨æ–‡å…¬å¸ï¼‰å¾ˆå¤šç¨‹åºæœ¬å¯ä»¥å¼€ç®±å³ç”¨æˆ–è€…ä¸€é”®å®‰è£…çš„ï¼Œç»“æœè€æ˜¯å› ä¸º JDBC é©±åŠ¨è¦å»æ‰‹åŠ¨ä¸‹è½½è€Œæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚<br>å†çœ‹ä¸‹çœŸæ­£çš„é”™è¯¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: Could not load db driver class: com.mysql.jdbc.Driver</span><br><span class="line">at org.apache.sqoop.manager.SqlManager.makeConnection(SqlManager.java:<span class="number">874</span>)</span><br><span class="line">at org.apache.sqoop.manager.GenericJdbcManager.getConnection(GenericJdbcManager.java:<span class="number">59</span>)</span><br><span class="line">at org.apache.sqoop.manager.CatalogQueryManager.listTables(CatalogQueryManager.java:<span class="number">102</span>)</span><br><span class="line">at org.apache.sqoop.tool.ListTablesTool.run(ListTablesTool.java:<span class="number">49</span>)</span><br><span class="line">at org.apache.sqoop.Sqoop.run(Sqoop.java:<span class="number">146</span>)</span><br></pre></td></tr></table></figure></p><p>ç„¶åä»¥ä¸ºæ˜¯ sqoop JDBC é©±åŠ¨æ²¡å®‰è£…å¥½ï¼Œä¸è¿‡åœ¨èŠ‚ç‚¹ä¸Šå´å¯ä»¥ç›´æ¥ç”¨ sqoop å‘½ä»¤æ¥å¯¼å…¥å¯¼å‡ºæ•°æ®ã€‚é‚£è¯´æ˜ sqoop çš„é©±åŠ¨æ²¡é—®é¢˜å‘€ï¼Œæˆ‘ä»¬çŸ¥é“ sqoop æœ€ç»ˆæ˜¯è½åœ¨ oozie ä¸Šæ‰§è¡Œçš„ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æœ‰å¯èƒ½ oozie æ‰¾ä¸åˆ°å¯¹åº”çš„é©±åŠ¨é€ æˆçš„å‘¢ã€‚</p><p>æˆ‘ä»¬å» oozie æ‰€åœ¨çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> oozie admin -shareliblist</span></span><br><span class="line">[Available ShareLib]</span><br><span class="line">hive</span><br><span class="line">distcp</span><br><span class="line">git</span><br><span class="line">mapreduce-streaming</span><br><span class="line">spark</span><br><span class="line">oozie</span><br><span class="line">hcatalog</span><br><span class="line">hive2</span><br><span class="line">sqoop</span><br><span class="line">pig</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ sqoop ç›¸å…³çš„ jar åŒ…ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> oozie admin -shareliblist sqoop</span></span><br><span class="line">[Available ShareLib]</span><br><span class="line">sqoop</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/HikariCP-2.6.1.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/HikariCP-java7-2.4.12.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/ST4-4.0.4.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/aggdesigner-algorithm-6.0.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/ant-1.9.1.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/ant-launcher-1.9.1.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/antlr-2.7.7.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/antlr-runtime-3.4.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/aopalliance-1.0.jar</span><br><span class="line">hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149/sqoop/aopalliance-repackaged-2.5.0-b32.jar</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></p><p> grep ä¸€ä¸‹ï¼Œå‘ç°å¹¶æ²¡æœ‰ JDBC é©±åŠ¨ï¼Œé‚£ä¹ˆéœ€è¦å°† sqoop ç›®å½•ä¸‹ï¼ˆä¸€èˆ¬ä¸º/var/lib/sqoop/ï¼‰çš„ jdbc é©±åŠ¨æ”¾åˆ° oozie ç›®å½•ä¸‹ï¼ˆå…·ä½“åœ¨ HDFS ä¸Šçš„ç›®å½•çœ‹ä¸Šé¢çš„è¾“å‡ºç»“æœå°±çŸ¥é“äº†ï¼‰ã€‚å¦‚æœ sqoop çš„ jdbc è¿˜æ²¡é…å¥½ï¼Œç›´æ¥æŒ‰ç…§<a href="https://docs.cloudera.com/documentation/enterprise/latest/topics/cm_mc_sqoop1_client.html#topic_13_7" target="_blank" rel="noopener">CDH æ–‡æ¡£</a>å®‰è£…å³å¯ã€‚</p><p>æœ€åæ‰§è¡Œä¸‹æ›´æ–°å³å¯ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> oozie admin -sharelibupdate</span></span><br><span class="line">[ShareLib update status]</span><br><span class="line">sharelibDirOld = hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149</span><br><span class="line">host = http://yournodename:11000/oozie</span><br><span class="line">sharelibDirNew = hdfs://yournodename:8020/user/oozie/share/lib/lib_20200108192149</span><br><span class="line">status = Successful</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JDBCçš„é…ç½®ç»™ä½ å¸¦æ¥å¤šå°‘çš„éº»çƒ¦ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="BigData" scheme="http://jiezhi.github.io/categories/BigData/"/>
    
    
      <category term="CDH" scheme="http://jiezhi.github.io/tags/CDH/"/>
    
      <category term="Sqoop" scheme="http://jiezhi.github.io/tags/Sqoop/"/>
    
      <category term="Hue" scheme="http://jiezhi.github.io/tags/Hue/"/>
    
      <category term="Ooozie" scheme="http://jiezhi.github.io/tags/Ooozie/"/>
    
  </entry>
  
  <entry>
    <title>Supervisordä»‹ç»ä¸ä½¿ç”¨</title>
    <link href="http://jiezhi.github.io/2020/01/16/supervisord/"/>
    <id>http://jiezhi.github.io/2020/01/16/supervisord/</id>
    <published>2020-01-16T07:19:46.000Z</published>
    <updated>2020-01-16T08:51:00.872Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æœ‰äº›è¿›ç¨‹èƒ½æ—¶åˆ»è¿è¡Œï¼Œå¹¶èƒ½åœ¨å‡ºé”™åè‡ªåŠ¨é‡å¯ã€‚é™¤äº†ç”¨ç³»ç»Ÿå¸¦çš„ systemd ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ç”¨supervisordã€‚<br>è¿™é‡Œç®€å•ä»‹ç» supervisord çš„å®‰è£…å’Œä½¿ç”¨ã€‚<br><a id="more"></a><br><a href="http://supervisord.org/index.html" target="_blank" rel="noopener">é¡¹ç›®åœ°å€</a></p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>å®‰è£…æ¯”è¾ƒç®€å•ï¼š<br><code>pip install supervisor</code></p><h1 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h1><p>ä½¿ç”¨<code>echo_supervisord_conf</code>å‘½ä»¤å¯ä»¥åˆ›å»ºä¸€ä»½é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼Œæ¯”å¦‚è¦æŠŠé…ç½®æ–‡ä»¶æ”¾åœ¨<code>/etc/supervisord.conf</code>ï¼Œåˆ™æ‰§è¡Œï¼š<br><code>echo_supervisord_conf &gt; /etc/supervisord.conf</code><br>å¦å¤–å¦‚æœä½ æƒ³æŠŠé…ç½®æ–‡ä»¶æ”¾åœ¨å…¶ä»–åœ°æ–¹ï¼Œåˆ™å¯ä»¥è‡ªå·±æŒ‡å®šåœ°å€ï¼Œåªæ˜¯åœ¨å¯åŠ¨ supervisord æ—¶åŠ <code>-c</code>æ˜¾å¼æŒ‡å®šé…ç½®æ–‡ä»¶åœ°å€<code>supervisord -c supervisord.conf</code> </p><h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><h2 id="é…ç½®ä»»åŠ¡"><a href="#é…ç½®ä»»åŠ¡" class="headerlink" title="é…ç½®ä»»åŠ¡"></a>é…ç½®ä»»åŠ¡</h2><p>ä¿®æ”¹<code>supervisord.conf</code>æ–‡ä»¶ï¼Œåœ¨84è¡Œå·¦å³ä½ç½®åŠ å…¥ä½ æƒ³è¦æ‰§è¡Œçš„è¿›ç¨‹ï¼ŒæŒ‰å¦‚ä¸‹æ ¼å¼ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[program:theprogramname]</span><br><span class="line"><span class="built_in">command</span>=/bin/cat              ; the program (relative uses PATH, can take args)</span><br></pre></td></tr></table></figure></p><p>æ¯”å¦‚æˆ‘æƒ³ç”¨å‘½ä»¤é€šè¿‡ ssh æ¥ä»£ç†è¿œç¨‹çš„ä¸€ä¸ª web é¡µé¢ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[program:cm]</span><br><span class="line"><span class="built_in">command</span>=ssh -N -L *:7180:localhost:7180 214</span><br></pre></td></tr></table></figure></p><h2 id="é…ç½®-http-æœåŠ¡"><a href="#é…ç½®-http-æœåŠ¡" class="headerlink" title="é…ç½® http æœåŠ¡"></a>é…ç½® http æœåŠ¡</h2><p>supervisord å¯ä»¥å¼€å¯ http æœåŠ¡ï¼Œé€šè¿‡ web é¡µé¢æ¥æŸ¥çœ‹å’Œç®¡ç†ä»»åŠ¡ã€‚<br>å¦‚æœéœ€è¦å¼€å¯ï¼Œå¯ä»¥æ‰“å¼€<code>inet_http_server</code>é…ç½®ï¼Œå¤§æ¦‚åœ¨39è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">port=0.0.0.0:9001          ; ip_address:port specifier, *:port <span class="keyword">for</span> all iface</span><br><span class="line">username=admin             ; default is no username (open server)</span><br><span class="line">password=thepassword       ; default is no password (open server)</span><br></pre></td></tr></table></figure></p><h1 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h1><p>ç›´æ¥æ‰§è¡Œ<code>supervisord</code>å³å¯å¯åŠ¨ï¼Œå¦‚æœéœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®åˆ™ä½¿ç”¨<code>-c</code>å‚æ•°ã€‚</p><h1 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h1><h2 id="Web-é¡µé¢ç®¡ç†"><a href="#Web-é¡µé¢ç®¡ç†" class="headerlink" title="Web é¡µé¢ç®¡ç†"></a>Web é¡µé¢ç®¡ç†</h2><p>å¦‚æœåœ¨é…ç½®ä¸­å¼€å¯äº† http æœåŠ¡ï¼Œåˆ™å¯ä»¥ç›´æ¥è®¿é—® http åœ°å€ï¼Œè¾“å…¥è´¦æˆ·å¯†ç åå³å¯ã€‚<br><img src="https://i.loli.net/2020/01/16/c9oIUnOE4KTMJFf.png" alt></p><h2 id="é€šè¿‡-supervisorctl-ç®¡ç†"><a href="#é€šè¿‡-supervisorctl-ç®¡ç†" class="headerlink" title="é€šè¿‡ supervisorctl ç®¡ç†"></a>é€šè¿‡ supervisorctl ç®¡ç†</h2><p>æ¯”å¦‚è¦æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡çŠ¶æ€ï¼š<br><code>supervisorctl status all</code><br>æˆ–è€…é‡å¯æ‰€æœ‰æœåŠ¡ï¼š<br><code>supervisorctl restart all</code></p><p>æ›´å¤šå‘½ä»¤å¯å‚è§ï¼š<br><a href="http://supervisord.org/running.html#supervisorctl-command-line-options" target="_blank" rel="noopener">supervisorctl-command-line-options</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æœ‰äº›è¿›ç¨‹èƒ½æ—¶åˆ»è¿è¡Œï¼Œå¹¶èƒ½åœ¨å‡ºé”™åè‡ªåŠ¨é‡å¯ã€‚é™¤äº†ç”¨ç³»ç»Ÿå¸¦çš„ systemd ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ç”¨supervisordã€‚&lt;br&gt;è¿™é‡Œç®€å•ä»‹ç» supervisord çš„å®‰è£…å’Œä½¿ç”¨ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://jiezhi.github.io/categories/Linux/"/>
    
    
      <category term="tools" scheme="http://jiezhi.github.io/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>sqoop å¸¸è§é—®é¢˜</title>
    <link href="http://jiezhi.github.io/2019/12/12/sqoop-issues/"/>
    <id>http://jiezhi.github.io/2019/12/12/sqoop-issues/</id>
    <published>2019-12-12T02:48:05.000Z</published>
    <updated>2019-12-16T07:33:48.903Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½• Sqoop ä½¿ç”¨è¿‡ç¨‹ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚<br><a id="more"></a></p><h2 id="1-è¡¨åä¸ºæ•°æ®åº“çš„ä¿ç•™å­—æ®µ"><a href="#1-è¡¨åä¸ºæ•°æ®åº“çš„ä¿ç•™å­—æ®µ" class="headerlink" title="1.è¡¨åä¸ºæ•°æ®åº“çš„ä¿ç•™å­—æ®µ"></a>1.è¡¨åä¸ºæ•°æ®åº“çš„ä¿ç•™å­—æ®µ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INFO manager.SqlManager: Executing SQL statement: SELECT t.* FROM order AS t WHERE 1=0</span><br><span class="line">ERROR manager.SqlManager: Error executing statement: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">'order AS t WHERE 1=0'</span> at line 1</span><br><span class="line">com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">'order AS t WHERE 1=0'</span> at line 1</span><br></pre></td></tr></table></figure><p>Sqoop åœ¨æ‰§è¡Œä»»åŠ¡å‰ï¼Œä¼šæ‰§è¡Œç±»ä¼¼çš„è¯­å¥æ¥åˆ¤æ–­æºè¡¨æ˜¯å¦æœ‰é—®é¢˜ï¼š<br><code>SELECT t.* FROM TABLE_NAME AS t WHERE 1=0</code><br>ç„¶è€Œè¿™é‡ŒæŠ¥çš„é”™è¡¨ç¤ºè¿™å¥è¯­å¥æœ‰é”™è¯¯ï¼Œæ— æ³•æ‰§è¡Œã€‚ä»”ç»†ä¸€çœ‹åŸæ¥ä¸šåŠ¡åº“é‚£è¾¹çš„è¡¨åä¸º <strong>order</strong>ï¼Œæ˜¾ç„¶è¿™ä¸ªè®¢å•è¡¨åä½¿ç”¨äº† MySQL ä¸­çš„ä¿ç•™å…³é”®å­—äº†ã€‚åœ¨ MySQL ä¸­ï¼Œä½¿ç”¨ <em><code></code></em> å°†å«å…³é”®å­—çš„åç§°å¼•èµ·æ¥å³å¯æ­£å¸¸æ‰§è¡Œï¼Œå¦‚ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.* <span class="keyword">FROM</span> <span class="string">`order`</span> <span class="keyword">AS</span> t <span class="keyword">WHERE</span> <span class="number">1</span>=<span class="number">0</span>ã€‚</span><br></pre></td></tr></table></figure></p><p>å¦‚æœåœ¨ Sqoop å‘½ä»¤ä¸­ç›´æ¥ä½¿ç”¨ <em><code>order</code></em> å´æ— æ³•æ­£å¸¸æ‰§è¡Œï¼Œ<strong>order</strong> ä¼šè¢« shell å½“æˆç‹¬ç«‹çš„å‘½ä»¤æ¥æ‰§è¡Œï¼Œä¹Ÿä¼šç›´æ¥æŠ¥é”™ã€‚ï¼ˆç»è¿‡æµ‹è¯•ä½¿ç”¨å•å¼•å·<code>&#39;&#39;</code>ã€åŒå¼•å·<code>&quot;&quot;</code>åŠè½¬ä¹‰å­—ç¬¦éƒ½æ— æ³•æ‰§è¡Œ Sqoop ä»»åŠ¡ã€‚)</p><p>Updated: å¯ä»¥è¯•ä¸‹æ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--table \`order\`</span><br></pre></td></tr></table></figure></p><p>ä½† sqoop åœ¨æ‰¾ä¸»é”®æ—¶ä¼¼ä¹ä¼šå‡ºé”™ï¼Œæ‰€ä»¥æœ€å¥½é€šè¿‡<code>--split-by</code>æŒ‡å®šä¸»é”®ï¼‰</p><p>é‚£å¯ä»¥è€ƒè™‘<br>1.ç”¨ <code>--query</code>  æ¥è§£å†³</p><p>å¯å‚è€ƒ<a href="http://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html#_free_form_query_imports" target="_blank" rel="noopener">Free-form Query Imports</a></p><p>2.å°† sqoop è¯­å¥æ”¾åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨<code>sqoop --options-file</code>æ¥æ‰§è¡Œå¯¹åº”çš„æ–‡ä»¶<br>å¯å‚è€ƒ<a href="http://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html#_using_options_files_to_pass_arguments" target="_blank" rel="noopener">Using Options Files to Pass Arguments</a></p><h2 id="2-MySQL-ä¸­-Time-ç±»å‹é”™è¯¯"><a href="#2-MySQL-ä¸­-Time-ç±»å‹é”™è¯¯" class="headerlink" title="2.MySQL ä¸­ Time ç±»å‹é”™è¯¯"></a>2.MySQL ä¸­ Time ç±»å‹é”™è¯¯</h2><p>åœ¨æ•°æ®åº“ä¸­ï¼Œæ¯”å¦‚é—¨åº—è¥ä¸šæ—¶é—´æœ‰çš„ä¼šå¡«å†™<code>24:00:00</code>ï¼Œä½†æ˜¯åœ¨ sqoop å¯¼å…¥è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Error: java.io.IOException: SQLException <span class="keyword">in</span> nextKeyValue</span><br><span class="line">        at org.apache.sqoop.mapreduce.db.DBRecordReader.nextKeyValue(DBRecordReader.java:275)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask<span class="variable">$NewTrackingRecordReader</span>.nextKeyValue(MapTask.java:568)</span><br><span class="line">        at org.apache.hadoop.mapreduce.task.MapContextImpl.nextKeyValue(MapContextImpl.java:80)</span><br><span class="line">        at org.apache.hadoop.mapreduce.lib.map.WrappedMapper<span class="variable">$Context</span>.nextKeyValue(WrappedMapper.java:91)</span><br><span class="line">        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)</span><br><span class="line">        at org.apache.sqoop.mapreduce.AutoProgressMapper.run(AutoProgressMapper.java:64)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:799)</span><br><span class="line">        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:347)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild<span class="variable">$2</span>.run(YarnChild.java:174)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at javax.security.auth.Subject.doAs(Subject.java:422)</span><br><span class="line">        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1875)</span><br><span class="line">        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:168)</span><br><span class="line">Caused by: java.sql.SQLException: java.sql.SQLException: Illegal hour value <span class="string">'24'</span> <span class="keyword">for</span> java.sql.Time <span class="built_in">type</span> <span class="keyword">in</span> value <span class="string">'24:00:00.</span></span><br><span class="line"><span class="string">        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1056)</span></span><br><span class="line"><span class="string">        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:957)</span></span><br><span class="line"><span class="string">        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:927)</span></span><br><span class="line"><span class="string">        at com.mysql.jdbc.ResultSet.getTimeFromString(ResultSet.java:6096)</span></span><br><span class="line"><span class="string">        at com.mysql.jdbc.ResultSet.getStringInternal(ResultSet.java:5819)</span></span><br><span class="line"><span class="string">        at com.mysql.jdbc.ResultSet.getString(ResultSet.java:5645)</span></span><br><span class="line"><span class="string">        at org.apache.sqoop.lib.JdbcWritableBridge.readString(JdbcWritableBridge.java:68)</span></span><br><span class="line"><span class="string">        at partner_stores.readFields(partner_stores.java:505)</span></span><br><span class="line"><span class="string">        at org.apache.sqoop.mapreduce.db.DBRecordReader.nextKeyValue(DBRecordReader.java:242)</span></span><br><span class="line"><span class="string">        ... 12 more</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º sqoop å¯¼å…¥ MySQL ç”¨çš„æ˜¯ JDBCï¼Œç„¶è€Œ JDBC çš„é©±åŠ¨ä¸­å¯¹ Time ç±»å‹æœ€å¤§æ”¯æŒåˆ°â€23:59:59â€ï¼Œæ‰€ä»¥å½“ Time ç±»å‹æ•°æ®å‡ºç°è¶…è¿‡â€23:59:59â€æ•°æ®å°±ä¼šæŠ¥è¿™ä¸ªé”™ã€‚</p><p>å°è¯•è¿‡ä½¿ç”¨<code>--map-column-java</code>ï¼Œä½†ä¾ç„¶ä¼šæŠ¥é”™<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--map-column-java</span><br><span class="line">endTime=String</span><br></pre></td></tr></table></figure></p><p>è§£å†³åŠæ³•ï¼š<br>1.è®©ä¸šåŠ¡äººå‘˜ä¿®æ”¹æ•°æ®åº“ï¼Œè¦ä¹ˆæŠŠç±»å‹æ”¹æˆ Varchar ç±»å‹ï¼Œè¦ä¹ˆæŠŠæ•°æ®åˆ·æˆæœ€å¤§â€23:59:59â€<br>2.è‡ªå·±åŠ¨æ‰‹, ä½¿ç”¨<code>--query</code>ï¼Œåœ¨ select æ“ä½œä¸­è¿›è¡Œç±»å‹è½¬æ¢ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">CAST</span>(startTime <span class="keyword">AS</span> <span class="built_in">CHAR</span>) startTime, <span class="keyword">CAST</span>(endTime <span class="keyword">AS</span> <span class="built_in">CHAR</span>) endTime</span><br><span class="line"><span class="keyword">FROM</span> shop.stores</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½• Sqoop ä½¿ç”¨è¿‡ç¨‹ä¸­å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚&lt;br&gt;
    
    </summary>
    
      <category term="BigData" scheme="http://jiezhi.github.io/categories/BigData/"/>
    
    
      <category term="Sqoop" scheme="http://jiezhi.github.io/tags/Sqoop/"/>
    
      <category term="HDFS" scheme="http://jiezhi.github.io/tags/HDFS/"/>
    
      <category term="Hive" scheme="http://jiezhi.github.io/tags/Hive/"/>
    
      <category term="MySQ" scheme="http://jiezhi.github.io/tags/MySQ/"/>
    
  </entry>
  
  <entry>
    <title>Sqoop å¢é‡æ›´æ–°</title>
    <link href="http://jiezhi.github.io/2019/09/05/sqoop-incremental/"/>
    <id>http://jiezhi.github.io/2019/09/05/sqoop-incremental/</id>
    <published>2019-09-05T02:18:58.000Z</published>
    <updated>2019-09-05T02:25:11.819Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>Sqoop å¢é‡æ›´æ–°æ•°æ®ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><h2 id="append-æ¨¡å¼"><a href="#append-æ¨¡å¼" class="headerlink" title="append æ¨¡å¼"></a>append æ¨¡å¼</h2><p>è¯¥æ¨¡å¼é€‚ç”¨äºè¡¨ä¸­åªæœ‰æ–°æ•°æ®æ·»åŠ çš„æƒ…å†µ</p><h2 id="lastmodified-æ¨¡å¼"><a href="#lastmodified-æ¨¡å¼" class="headerlink" title="lastmodified æ¨¡å¼"></a>lastmodified æ¨¡å¼</h2><p>è¯¥æ¨¡å¼é€‚ç”¨äºç°æœ‰æ•°æ®å¯èƒ½è¢«ä¿®æ”¹çš„æƒ…å†µ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;Sqoop å¢é‡æ›´æ–°æ•°æ®ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;h2 id=&quot;append-æ¨¡å¼&quot;&gt;&lt;a href=&quot;#append-æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;append æ¨¡å¼&quot;&gt;&lt;/a&gt;append æ¨¡å¼&lt;/h2
      
    
    </summary>
    
      <category term="BigData" scheme="http://jiezhi.github.io/categories/BigData/"/>
    
    
      <category term="MySQL" scheme="http://jiezhi.github.io/tags/MySQL/"/>
    
      <category term="Sqoop" scheme="http://jiezhi.github.io/tags/Sqoop/"/>
    
      <category term="HDFS" scheme="http://jiezhi.github.io/tags/HDFS/"/>
    
      <category term="Hive" scheme="http://jiezhi.github.io/tags/Hive/"/>
    
  </entry>
  
  <entry>
    <title>è®¾ç½® idea ä¸­çš„ Vimï¼ˆåŒæ ·é€‚ç”¨äºjetbrains å®¶å…¶ä»–äº§å“ï¼‰</title>
    <link href="http://jiezhi.github.io/2019/08/30/set-vim-in-idea/"/>
    <id>http://jiezhi.github.io/2019/08/30/set-vim-in-idea/</id>
    <published>2019-08-30T01:33:38.000Z</published>
    <updated>2019-08-30T01:55:46.470Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æ¯æ¬¡å¯åŠ¨ idea æˆ– pycharm åéƒ½è¦å•ç‹¬è®¾ç½®ä¸‹æ‰å¼€å§‹å·¥ä½œï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½åƒè®¾ç½® vimrc ä¸€æ ·è®¾ç½® idea ä¸­çš„ vim å‘¢ï¼Ÿ<br><a id="more"></a></p><p>å¯èƒ½å¾ˆå¤šäºº.vimrc æ–‡ä»¶ä¸­éƒ½æœ‰è¿™ä¸ªè®¾ç½®ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set relativenumber</span><br><span class="line">set number</span><br></pre></td></tr></table></figure></p><img src="/2019/08/30/set-vim-in-idea/vim-rnu.png"><p>è¿™ä¸ªè®¾ç½®ä½¿å¾—ä¸Šä¸‹è·³è½¬ï¼ˆj/kï¼‰å†ä¹Ÿä¸ç”¨å»è®¡ç®—è¡Œæ•°äº†.</p><p>idea ä¸­çš„ vim è®¾ç½®ä¹Ÿåƒ.vimrcä¸€æ ·ï¼Œåªä¸è¿‡è®¾ç½®åœ¨<code>.ideavimrc</code>æ–‡ä»¶ä¸­ã€‚</p><p>æ‰€ä»¥åªè¦åœ¨åœ¨~/.ideavimrc æ–‡ä»¶ä¸­åŠ ä¸Šä»¥ä¸‹é…ç½®å³å¯ï¼ˆæœ‰å…¶ä»–vimè®¾ç½®ä¹Ÿå¯ä»¥åŠ å…¥åˆ°è¿™é‡Œï¼‰:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set relativenumber</span><br><span class="line">set number</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰æ¯æ¬¡å¯åŠ¨ idea æˆ– pycharm åéƒ½è¦å•ç‹¬è®¾ç½®ä¸‹æ‰å¼€å§‹å·¥ä½œï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½åƒè®¾ç½® vimrc ä¸€æ ·è®¾ç½® idea ä¸­çš„ vim å‘¢ï¼Ÿ&lt;br&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://jiezhi.github.io/categories/Tools/"/>
    
    
  </entry>
  
  <entry>
    <title>é€šè¿‡ ssh è¿œç¨‹ä»£ç†ï¼Œè®¿é—®è¿œç¨‹èµ„æº</title>
    <link href="http://jiezhi.github.io/2019/03/29/tunnel-server-socket-over-ssh/"/>
    <id>http://jiezhi.github.io/2019/03/29/tunnel-server-socket-over-ssh/</id>
    <published>2019-03-29T02:10:26.000Z</published>
    <updated>2019-03-29T02:49:25.530Z</updated>
    
    <content type="html"><![CDATA[<p>å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨SSHå¤§å¤šç”¨æ¥ï¼Œç™»å½•è¿œç¨‹æœåŠ¡å™¨æ¥è¿›è¡Œè¿œç¨‹æ“ä½œã€‚</p><p>ä½†æ˜¯ SSH å¼ºå¤§çš„åŠŸèƒ½è¿œè¿œä¸æ­¢ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œæ¯”å¦‚è¯´æˆ‘åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªæœåŠ¡ï¼Œä½†æ˜¯ç«¯å£å·å¹¶æ²¡æœ‰å¯¹å¤–å¼€æ”¾æ€ä¹ˆåŠï¼Ÿåˆæˆ–è€…ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“æœ¬åœ°æ— æ³•è¿æ¥ï¼Œè€Œåªèƒ½é€šè¿‡çº¿ä¸Šç¯å¢ƒè¿æ¥æ€ä¹ˆåŠï¼Ÿ<br><a id="more"></a></p><h1 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h1><h2 id="SSH-è®¿é—®è¿œç¨‹é¡µé¢"><a href="#SSH-è®¿é—®è¿œç¨‹é¡µé¢" class="headerlink" title="SSH è®¿é—®è¿œç¨‹é¡µé¢"></a>SSH è®¿é—®è¿œç¨‹é¡µé¢</h2><p><em>åœ¨ Shadowsocks ä¹‹å‰ï¼Œå¾ˆå¤šäººæ˜¯ä½¿ç”¨ SSH æ¥è·¨è¿‡é•¿åŸçš„ã€‚</em><br>ç°åœ¨é‡åˆ°çš„é—®é¢˜ï¼Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²äº† Flinkï¼Œè™½è¯´ Flink æä¾›äº† REST Api æ¥æŸ¥çœ‹ä¿¡æ¯çš„ï¼Œä½†æ˜¯æŸ¥çœ‹é¡µé¢è¿˜æ˜¯æ›´æ–¹ä¾¿ç‚¹ã€‚ä½†æ˜¯åˆæ²¡åŠæ³•è¿æ¥ç”Ÿäº§ç¯å¢ƒæ€ä¹ˆåŠï¼Ÿ<br>å…¶å®å¯ä»¥é€šè¿‡ SSH å»ºç«‹æœ¬åœ°å’ŒæœåŠ¡å™¨çš„é€šé“ï¼Œè¿›è€Œå¯ä»¥è®¿é—®è¿œç¨‹æœåŠ¡å™¨çš„èµ„æºã€‚<br>æ¯”å¦‚ï¼Œflink é¡µé¢é»˜è®¤ç«¯å£å·ä¸º8081ï¼Œåœ¨ç»ˆç«¯é‡Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œå³å¯é€šè¿‡è®¿é—®æœ¬åœ°çš„ localhost:8081 è®¿é—®æœåŠ¡å™¨ä¸Šçš„ flink é¡µé¢ã€‚<br><code>ssh -L 8081:localhost:8081 user@flinkserver</code></p><h2 id="SSH-ä»£ç†è®¿é—®æ•°æ®åº“"><a href="#SSH-ä»£ç†è®¿é—®æ•°æ®åº“" class="headerlink" title="SSH ä»£ç†è®¿é—®æ•°æ®åº“"></a>SSH ä»£ç†è®¿é—®æ•°æ®åº“</h2><p>å…¶å®é“ç†å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“æˆ‘ä»¬æ˜¯æ²¡æ³•ç›´æ¥è¿æ¥çš„ã€‚ä¸è¿‡åªè¦æœ‰å¯ä»¥è®¿é—®è¯¥æ•°æ®åº“çš„å…¶ä»–æœåŠ¡å™¨ SSH é…ç½®å°±è¡Œäº†ï¼ŒåŒä¸€ä¸ªåŸç†ï¼Œä½†å®ç°æ–¹å¼å°±å¾ˆå¤šäº†ã€‚</p><ol><li><p>ç›´æ¥ç™»å½•æœåŠ¡å™¨ï¼Œé€šè¿‡ mysql å‘½ä»¤æ¥è®¿é—®ã€‚ç®€å•ç²—æš´ï¼Œä½†æ¯”è¾ƒç¹çã€‚</p></li><li><p>ä½¿ç”¨æ”¯æŒ SSH tunnel çš„å®¢æˆ·ç«¯æ¥è¿æ¥æ•°æ®åº“ï¼Œæ¯”å¦‚ <a href="https://www.jetbrains.com/datagrip/" target="_blank" rel="noopener">DataGrip</a></p><img src="/2019/03/29/tunnel-server-socket-over-ssh/datagrip_ssh.png"></li><li><p>åŒæ ·ï¼Œä½¿ç”¨ ssh å‘½ä»¤æ¥å»ºç«‹é€šé“ï¼Œæœ¬åœ°å°±å¯ä»¥è®¿é—®äº†ã€‚<br>æ¯”å¦‚æ•°æ®åº“åœ°å€ä¸ºï¼š192.168.100.100:3306ï¼Œè¿œç¨‹æœåŠ¡å™¨ä¸ºï¼š<a href="mailto:root@192.168.10.200" target="_blank" rel="noopener">root@192.168.10.200</a>ï¼Œä½¿ç”¨æœ¬åœ°3307ç«¯å£æ¥æ˜ å°„ï¼ˆå…¶ä»–ç«¯å£ä¹Ÿè¡Œï¼Œæˆ‘å› ä¸ºæœ¬åœ°3306è¢«ç”¨äº†ï¼Œæ‰€ä»¥ç”¨3307äº†ï¼‰<br><code>ssh -L 3307:192.168.100.100:3306 root@192.168.10.200</code></p></li></ol><p>æ‰§è¡Œè¿‡åï¼Œåªéœ€è¦è¿æ¥ <code>localhost:3307</code> å°±å¯ä»¥è®¿é—®æ•°æ®åº“äº†ã€‚</p><hr><p>SSH è¿˜æœ‰å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸‹æ¬¡æœ‰ç©ºå†å†™ä¸€ä¸‹é…ç½®çš„ä¼˜åŒ–ã€‚</p><hr><p>Reference:<br><a href="https://askubuntu.com/questions/112177/how-do-i-tunnel-and-browse-the-server-webpage-on-my-laptop" target="_blank" rel="noopener">https://askubuntu.com/questions/112177/how-do-i-tunnel-and-browse-the-server-webpage-on-my-laptop</a></p><p><a href="https://unix.stackexchange.com/questions/14160/ssh-tunneling-error-channel-1-open-failed-administratively-prohibited-open" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/14160/ssh-tunneling-error-channel-1-open-failed-administratively-prohibited-open</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨SSHå¤§å¤šç”¨æ¥ï¼Œç™»å½•è¿œç¨‹æœåŠ¡å™¨æ¥è¿›è¡Œè¿œç¨‹æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ SSH å¼ºå¤§çš„åŠŸèƒ½è¿œè¿œä¸æ­¢ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œæ¯”å¦‚è¯´æˆ‘åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªæœåŠ¡ï¼Œä½†æ˜¯ç«¯å£å·å¹¶æ²¡æœ‰å¯¹å¤–å¼€æ”¾æ€ä¹ˆåŠï¼Ÿåˆæˆ–è€…ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“æœ¬åœ°æ— æ³•è¿æ¥ï¼Œè€Œåªèƒ½é€šè¿‡çº¿ä¸Šç¯å¢ƒè¿æ¥æ€ä¹ˆåŠï¼Ÿ&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://jiezhi.github.io/categories/Linux/"/>
    
    
      <category term="ssh" scheme="http://jiezhi.github.io/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>Flink åˆ†å¸ƒå¼è¿è¡Œæ—¶ç¯å¢ƒï¼ˆDistributed Runtime Environmentï¼‰</title>
    <link href="http://jiezhi.github.io/2019/03/08/flink-distributed-runtime-environment/"/>
    <id>http://jiezhi.github.io/2019/03/08/flink-distributed-runtime-environment/</id>
    <published>2019-03-08T06:26:26.000Z</published>
    <updated>2019-03-08T09:41:05.222Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡æ–‡ç« ä»‹ç» Flink çš„åˆ†å¸ƒå¼è¿è¡Œæ—¶ç¯å¢ƒç›¸å…³çš„æ¦‚å¿µã€‚<br><a id="more"></a></p><p>æœ¬æ–‡è¯‘è‡ª<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/concepts/runtime.html" target="_blank" rel="noopener">Flinkå®˜ç½‘</a></p><h2 id="ä»»åŠ¡å’Œæ“ä½œé“¾"><a href="#ä»»åŠ¡å’Œæ“ä½œé“¾" class="headerlink" title="ä»»åŠ¡å’Œæ“ä½œé“¾"></a>ä»»åŠ¡å’Œæ“ä½œé“¾</h2><p>å¯¹äºåˆ†å¸ƒå¼çš„æ‰§è¡Œï¼ŒFlinkå°†æ“ä½œå­ä»»åŠ¡<em>é“¾æ¥(chain)</em>åˆ°<em>ä»»åŠ¡(task)</em>ä¸­ã€‚æ¯ä¸ªä»»åŠ¡ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å°†æ“ä½œé“¾æ¥åˆ°ä»»åŠ¡æ˜¯ä¸€é¡¹æœ‰ç”¨çš„ä¼˜åŒ–ï¼šå®ƒå¯ä»¥å‡å°‘çº¿ç¨‹åˆ°çº¿ç¨‹åˆ‡æ¢å’Œç¼“å†²çš„å¼€é”€ï¼Œå¹¶åœ¨é™ä½å»¶è¿Ÿçš„åŒæ—¶æé«˜æ•´ä½“ååé‡ã€‚é“¾æ¥è¡Œä¸ºå¯ä»¥é…ç½®;æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/stream/operators/#task-chaining-and-resource-groups" target="_blank" rel="noopener">é“¾æ¥æ–‡æ¡£</a>ã€‚</p><p>ä¸‹å›¾ä¸­çš„ç¤ºä¾‹æ•°æ®æµç”±äº”ä¸ªå­ä»»åŠ¡æ‰§è¡Œï¼Œå› æ­¤å…·æœ‰äº”ä¸ªå¹¶è¡Œçº¿ç¨‹ã€‚</p><img src="/2019/03/08/flink-distributed-runtime-environment/tasks_chains.svg"><p>æ“ä½œé“¾æ¥å¯¼ä»»åŠ¡</p><h2 id="ä½œä¸šç®¡ç†å™¨ï¼Œä»»åŠ¡ç®¡ç†å™¨å’Œå®¢æˆ·ç«¯"><a href="#ä½œä¸šç®¡ç†å™¨ï¼Œä»»åŠ¡ç®¡ç†å™¨å’Œå®¢æˆ·ç«¯" class="headerlink" title="ä½œä¸šç®¡ç†å™¨ï¼Œä»»åŠ¡ç®¡ç†å™¨å’Œå®¢æˆ·ç«¯"></a>ä½œä¸šç®¡ç†å™¨ï¼Œä»»åŠ¡ç®¡ç†å™¨å’Œå®¢æˆ·ç«¯</h2><p>Flinkè¿è¡Œæ—¶åŒ…å«ä¸¤ç§ç±»å‹çš„è¿›ç¨‹ï¼š</p><ul><li><p>ä½œä¸šç®¡ç†å™¨ï¼ˆ<strong>JobManagersï¼Œ</strong>ä¹Ÿç§°ä¸º<em>master</em>ï¼‰åè°ƒåˆ†å¸ƒå¼æ‰§è¡Œã€‚ä»–ä»¬å®‰æ’ä»»åŠ¡ï¼Œåè°ƒæ£€æŸ¥ç‚¹ï¼Œåè°ƒæ•…éšœæ¢å¤ç­‰ã€‚</p><p>  è‡³å°‘æœ‰ä¸€ä¸ªJob Managerã€‚è®¾ç½®é«˜å¯ç”¨ï¼ˆHA, High-Availabilityï¼‰çš„è¯å°†å…·æœ‰å¤šä¸ªJobManagersï¼Œå…¶ä¸­ä¸€ä¸ªå§‹ç»ˆæ˜¯<em>é¢†å¯¼è€…(leader)</em>ï¼Œå…¶å®ƒçš„å¤„äº<em>å¾…æœºçŠ¶æ€(standby)</em>ã€‚</p></li><li><p>ä»»åŠ¡ç®¡ç†å™¨ï¼ˆ<strong>TaskManagersï¼Œ</strong>ä¹Ÿç§°ä¸º<em>worker</em>ï¼‰æ‰§è¡Œæ•°æ®æµçš„ä»»åŠ¡ï¼ˆæˆ–æ›´å…·ä½“åœ°è¯´ï¼Œå­ä»»åŠ¡ï¼‰ï¼Œå¹¶ç¼“å†²å’Œäº¤æ¢æ•°æ®æµã€‚</p><p>  å¿…é¡»å§‹ç»ˆè‡³å°‘æœ‰ä¸€ä¸ªTaskManagerã€‚</p></li></ul><p>JobManagerså’ŒTaskManagerså¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¯åŠ¨ï¼š<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/ops/deployment/cluster_setup.html" target="_blank" rel="noopener">ç‹¬ç«‹é›†ç¾¤</a>ç›´æ¥åœ¨æœºå™¨é‡Œå¯åŠ¨ï¼Œæˆ–åœ¨å®¹å™¨ä¸­ï¼Œæˆ–ç”±<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/ops/deployment/yarn_setup.html" target="_blank" rel="noopener">YARN</a>æˆ–<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/ops/deployment/mesos.html" target="_blank" rel="noopener">Mesos</a>ç­‰èµ„æºæ¡†æ¶æ¥ç®¡ç†ã€‚ TaskManagersè¿æ¥åˆ°JobManagersï¼Œé€šçŸ¥è‡ªå·±å¯ç”¨ï¼Œç„¶åè¢«åˆ†é…ä»»åŠ¡ã€‚</p><p><strong>å®¢æˆ·ç«¯</strong>ä¸æ˜¯è¿è¡Œæ—¶å’Œç¨‹åºæ‰§è¡Œçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯è¢«ç”¨äºå‡†å¤‡æ•°æ®æµå¹¶å°†æ•°æ®æµå‘é€åˆ°JobManagerã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥æ–­å¼€è¿æ¥æˆ–ä¿æŒè¿æ¥ä»¥æ¥æ”¶è¿›åº¦æŠ¥å‘Šã€‚å®¢æˆ·ç«¯è¦ä¹ˆä½œä¸ºè§¦å‘æ‰§è¡Œçš„Java / Scalaç¨‹åºçš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œè¦ä¹ˆæ˜¯åœ¨å‘½ä»¤è¡Œè¿›ç¨‹ä¸­è¿è¡Œ ./bin/flink run â€¦.</p><img src="/2019/03/08/flink-distributed-runtime-environment/processes.svg"><p>æ‰§è¡ŒFlinkæ•°æ®æµæ‰€æ¶‰åŠçš„è¿‡ç¨‹</p><h2 id="ä»»åŠ¡æ§½å’Œèµ„æº"><a href="#ä»»åŠ¡æ§½å’Œèµ„æº" class="headerlink" title="ä»»åŠ¡æ§½å’Œèµ„æº"></a>ä»»åŠ¡æ§½å’Œèµ„æº</h2><p>æ¯ä¸ªworkerï¼ˆTaskManagerï¼‰éƒ½æ˜¯ä¸€ä¸ª<em>JVMè¿›ç¨‹</em>ï¼Œå¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå­ä»»åŠ¡ã€‚ä¸ºäº†æ§åˆ¶workeræ¥å—çš„ä»»åŠ¡æ•°é‡ï¼Œworkerä¸­æœ‰<strong>ä»»åŠ¡æ§½ï¼ˆtask slotsï¼‰</strong>ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ã€‚</p><p>æ¯ä¸ª<em>ä»»åŠ¡æ§½</em>ä»£è¡¨TaskManagerçš„å›ºå®šèµ„æºå­é›†ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰ä¸‰ä¸ªä»»åŠ¡æ§½çš„TaskManagerä¼šå°†å…¶1/3çš„æ‰˜ç®¡å†…å­˜åˆ†é…åˆ°æ¯ä¸ªæ’æ§½ã€‚åˆ‡æ¢èµ„æºæ„å‘³ç€å­ä»»åŠ¡ä¸ä¼šä¸æ¥è‡ªå…¶ä»–ä½œä¸šçš„å­ä»»åŠ¡ç«äº‰æ‰˜ç®¡å†…å­˜ï¼Œè€Œæ˜¯ç«äº‰å…·æœ‰ä¸€å®šé‡çš„ä¿ç•™æ‰˜ç®¡å†…å­˜ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œæ²¡æœ‰CPUéš”ç¦»;å½“å‰ä»»åŠ¡æ§½åªåˆ†ç¦»ä»»åŠ¡çš„æ‰˜ç®¡å†…å­˜ã€‚</p><p>é€šè¿‡è°ƒæ•´ä»»åŠ¡æ§½çš„æ•°é‡ï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰å­ä»»åŠ¡ä¹‹é—´å¦‚ä½•ç›¸äº’éš”ç¦»ã€‚æ¯ä¸ªTaskManageræœ‰ä¸€ä¸ªæ’æ§½æ„å‘³ç€æ¯ä¸ªä»»åŠ¡ç»„åœ¨ä¸€ä¸ªå•ç‹¬çš„JVMä¸­è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­å¯åŠ¨ï¼‰ã€‚æ‹¥æœ‰å¤šä¸ªæ’æ§½æ„å‘³ç€æ›´å¤šå­ä»»åŠ¡å…±äº«åŒä¸€ä¸ªJVMã€‚åŒä¸€JVMä¸­çš„ä»»åŠ¡å…±äº«TCPè¿æ¥ï¼ˆé€šè¿‡å¤šè·¯å¤ç”¨ï¼‰å’Œå¿ƒè·³æ¶ˆæ¯ã€‚å®ƒä»¬è¿˜å¯ä»¥å…±äº«æ•°æ®é›†å’Œæ•°æ®ç»“æ„ï¼Œä»è€Œå‡å°‘æ¯ä»»åŠ¡å¼€é”€ã€‚</p><img src="/2019/03/08/flink-distributed-runtime-environment/tasks_slots.svg"><p>å…·æœ‰ä»»åŠ¡æ§½å’Œä»»åŠ¡çš„TaskManager</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlinkå…è®¸å­ä»»åŠ¡å…±äº«æ’æ§½ï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒä»»åŠ¡çš„å­ä»»åŠ¡ï¼Œåªè¦å®ƒä»¬æ¥è‡ªåŒä¸€ä¸ªä½œä¸šã€‚ç»“æœå°±æ˜¯ï¼Œä¸€ä¸ªæ§½å¯ä»¥ä¿å­˜ä½œä¸šçš„æ•´ä¸ªç®¡é“ã€‚å…è®¸æ­¤æ’æ§½å…±äº«æœ‰ä¸¤ä¸ªä¸»è¦å¥½å¤„ï¼š</p><ul><li>Flinké›†ç¾¤éœ€è¦çš„ä»»åŠ¡æ§½æ•°é‡ä¸ä½œä¸šä¸­ä½¿ç”¨çš„æœ€é«˜å¹¶è¡Œåº¦çš„ä»»åŠ¡æ§½ä¸€æ ·å¤šã€‚æ— éœ€è®¡ç®—ç¨‹åºæ€»å…±åŒ…å«å¤šå°‘ä»»åŠ¡ï¼ˆå…·æœ‰ä¸åŒçš„å¹¶è¡Œæ€§ï¼‰ã€‚</li><li><p>æ›´å®¹æ˜“è·å¾—æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ã€‚æ²¡æœ‰æ’æ§½å…±äº«ï¼Œéå¯†é›†çš„<em>source/ map()</em>å­ä»»åŠ¡å°†å ç”¨ä¸èµ„æºå¯†é›†å‹<em>çª—å£</em>å­ä»»åŠ¡ä¸€æ ·å¤šçš„èµ„æºã€‚é€šè¿‡æ’æ§½å…±äº«ï¼Œå°†ç¤ºä¾‹ä¸­çš„åŸºæœ¬å¹¶è¡Œæ€§ä»2å¢åŠ åˆ°6å¯ä»¥å……åˆ†åˆ©ç”¨æ—¶éš™èµ„æºï¼ŒåŒæ—¶ç¡®ä¿ç¹é‡çš„å­ä»»åŠ¡åœ¨TaskManagersä¹‹é—´å…¬å¹³åˆ†é…ã€‚</p>  <img src="/2019/03/08/flink-distributed-runtime-environment/slot_sharing.svg"><p>  å…·æœ‰å…±äº«ä»»åŠ¡æ§½çš„TaskManagers</p></li></ul><p>APIè¿˜åŒ…æ‹¬<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/stream/operators/#task-chaining-and-resource-groups" target="_blank" rel="noopener">èµ„æºç»„</a>æœºåˆ¶ï¼Œå¯ç”¨äºé˜²æ­¢æ„å¤–çš„æ’æ§½å…±äº«ã€‚</p><p>æ ¹æ®ç»éªŒï¼Œä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤ä»»åŠ¡æ§½æ•°å°±æ˜¯CPUæ ¸å¿ƒæ•°ã€‚ä½¿ç”¨è¶…çº¿ç¨‹ï¼Œæ¯ä¸ªæ’æ§½ç„¶åéœ€è¦2ä¸ªæˆ–æ›´å¤šç¡¬ä»¶çº¿ç¨‹ã€‚</p><h2 id="State-Backends-çŠ¶æ€åç«¯"><a href="#State-Backends-çŠ¶æ€åç«¯" class="headerlink" title="State Backends(çŠ¶æ€åç«¯?)"></a>State Backends(çŠ¶æ€åç«¯?)</h2><p>å­˜å‚¨é”®/å€¼ç´¢å¼•çš„ç¡®åˆ‡æ•°æ®ç»“æ„å–å†³äºæ‰€é€‰çš„<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/ops/state/state_backends.html" target="_blank" rel="noopener">state backend</a>ã€‚ä¸€ä¸ªstate backendå°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å“ˆå¸Œæ˜ å°„ä¸­ï¼Œå¦ä¸€ä¸ªstate backendä½¿ç”¨<a href="http://rocksdb.org/" target="_blank" rel="noopener">RocksDB</a>ä½œä¸ºé”®/å€¼å­˜å‚¨ã€‚é™¤äº†å®šä¹‰ä¿å­˜çŠ¶æ€çš„æ•°æ®ç»“æ„ä¹‹å¤–ï¼Œstate backendè¿˜å®ç°äº†è·å–é”®/å€¼çŠ¶æ€çš„æ—¶é—´ç‚¹å¿«ç…§ï¼Œå¹¶å°†è¯¥å¿«ç…§å­˜å‚¨ä¸ºæ£€æŸ¥ç‚¹çš„ä¸€éƒ¨åˆ†çš„é€»è¾‘ã€‚</p><img src="/2019/03/08/flink-distributed-runtime-environment/checkpoints.svg"><p>æ£€æŸ¥ç‚¹å’Œå¿«ç…§</p><h2 id="ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰"><a href="#ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰" class="headerlink" title="ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰"></a>ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰</h2><p>ç”¨Data Stream APIç¼–å†™çš„ç¨‹åºå¯ä»¥ä»<strong>ä¿å­˜ç‚¹</strong>ä¸­æ¢å¤æ‰§è¡Œã€‚ä¿å­˜ç‚¹å…è®¸æ›´æ–°ç¨‹åºå’ŒFlinkç¾¤é›†ï¼Œè€Œä¸ä¼šä¸¢å¤±ä»»ä½•çŠ¶æ€ã€‚</p><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/ops/state/savepoints.html" target="_blank" rel="noopener">ä¿å­˜ç‚¹</a>æ˜¯<strong>æ‰‹åŠ¨è§¦å‘çš„æ£€æŸ¥ç‚¹</strong>ï¼Œå®ƒå¯ä»¥ç”Ÿæˆä¸€ä¸ªç¨‹åºçš„å¿«ç…§å¹¶æŠŠå®ƒå†™åˆ°state backendã€‚ ä»–ä»¬ä¾é å¸¸è§„çš„æ£€æŸ¥ç‚¹æœºåˆ¶ã€‚ åœ¨æ‰§è¡ŒæœŸé—´ï¼Œç¨‹åºä¼šå®šæœŸåœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šåˆ›å»ºå¿«ç…§å¹¶ç”Ÿæˆæ£€æŸ¥ç‚¹ã€‚ å¯¹äºç¨‹åºæ¢å¤ï¼Œä»…éœ€è¦æœ€åå®Œæˆçš„æ£€æŸ¥ç‚¹ï¼Œå¹¶ä¸”ä¸€æ—¦å®Œæˆæ–°æ£€æŸ¥ç‚¹ï¼Œå°±å¯ä»¥å®‰å…¨åœ°ä¸¢å¼ƒæ—§æ£€æŸ¥ç‚¹ã€‚</p><p>ä¿å­˜ç‚¹ä¸è¿™äº›å®šæœŸæ£€æŸ¥ç‚¹ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬ç”±<strong>ç”¨æˆ·è§¦å‘</strong>ï¼Œå¹¶ä¸”åœ¨è¾ƒæ–°çš„æ£€æŸ¥ç‚¹å®Œæˆæ—¶<strong>ä¸ä¼šè‡ªåŠ¨è¿‡æœŸ</strong>ã€‚ å¯ä»¥ä»<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/ops/cli.html#savepoints" target="_blank" rel="noopener">å‘½ä»¤è¡Œ</a>åˆ›å»ºä¿å­˜ç‚¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<strong><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/monitoring/rest_api.html#cancel-job-with-savepoint" target="_blank" rel="noopener">REST API</a></strong>å–æ¶ˆä½œä¸šã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬ç¯‡æ–‡ç« ä»‹ç» Flink çš„åˆ†å¸ƒå¼è¿è¡Œæ—¶ç¯å¢ƒç›¸å…³çš„æ¦‚å¿µã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Flink" scheme="http://jiezhi.github.io/categories/Flink/"/>
    
    
      <category term="Flink" scheme="http://jiezhi.github.io/tags/Flink/"/>
    
      <category term="Translate" scheme="http://jiezhi.github.io/tags/Translate/"/>
    
  </entry>
  
  <entry>
    <title>è§£å†³ macos systemuiserver æ— å“åº”çš„é—®é¢˜</title>
    <link href="http://jiezhi.github.io/2019/03/07/macos-systemuiserver-not-responding/"/>
    <id>http://jiezhi.github.io/2019/03/07/macos-systemuiserver-not-responding/</id>
    <published>2019-03-07T01:28:50.000Z</published>
    <updated>2019-03-07T01:41:05.651Z</updated>
    
    <content type="html"><![CDATA[<p>æŠŠ MBP å‡çº§åˆ°æœ€æ–°ç³»ç»Ÿï¼ˆ10.14.3ï¼‰åï¼Œå‘ç°ä¼‘çœ åå†æ‰“å¼€ç”µè„‘ï¼Œç‚¹å‡»æ— çº¿ç½‘æˆ–åˆ‡æ¢wifi çš„æ—¶å€™ï¼Œç³»ç»Ÿå¼€å§‹è½¬èŠèŠ±ï¼Œç³»ç»Ÿè®¾ç½®ä¹Ÿæ— å“åº”äº†ï¼Œå»Activity Monitor é‡Œä¼šå‘ç° <strong>systemuiserver not responding</strong>ï¼Œè²Œä¼¼é™¤äº†é‡å¯åˆ«æ— ä»–æ³•ã€‚</p><p>å½“ç„¶é™¤äº†é‡å¯ï¼Œä½ åªéœ€è¦åœ¨å‘½ä»¤è¡Œé‡Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">kill</span> -9 `ps aux | grep -v grep | grep /usr/libexec/airportd | awk <span class="string">'&#123;print $2&#125;'</span>`</span><br></pre></td></tr></table></figure><a id="more"></a><p>è¿™è¡Œå‘½ä»¤çš„æ„æ€æ˜¯å¼ºè¡Œæ€æ­»airportdçš„è¿›ç¨‹ï¼Œç„¶åä¼šå¯¼è‡´ç›¸å…³è¿›ç¨‹é‡å¯ã€‚è™½è¯´æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œä½†æ¯”é‡å¯ç³»ç»Ÿå¥½å¤šäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æŠŠ MBP å‡çº§åˆ°æœ€æ–°ç³»ç»Ÿï¼ˆ10.14.3ï¼‰åï¼Œå‘ç°ä¼‘çœ åå†æ‰“å¼€ç”µè„‘ï¼Œç‚¹å‡»æ— çº¿ç½‘æˆ–åˆ‡æ¢wifi çš„æ—¶å€™ï¼Œç³»ç»Ÿå¼€å§‹è½¬èŠèŠ±ï¼Œç³»ç»Ÿè®¾ç½®ä¹Ÿæ— å“åº”äº†ï¼Œå»Activity Monitor é‡Œä¼šå‘ç° &lt;strong&gt;systemuiserver not responding&lt;/strong&gt;ï¼Œè²Œä¼¼é™¤äº†é‡å¯åˆ«æ— ä»–æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶é™¤äº†é‡å¯ï¼Œä½ åªéœ€è¦åœ¨å‘½ä»¤è¡Œé‡Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9 `ps aux | grep -v grep | grep /usr/libexec/airportd | awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="MacOS" scheme="http://jiezhi.github.io/categories/MacOS/"/>
    
    
      <category term="Macos" scheme="http://jiezhi.github.io/tags/Macos/"/>
    
      <category term="Bug" scheme="http://jiezhi.github.io/tags/Bug/"/>
    
  </entry>
  
  <entry>
    <title>Flinkç¼–ç¨‹æ¨¡å‹</title>
    <link href="http://jiezhi.github.io/2019/03/04/flink-concepts-programming-model/"/>
    <id>http://jiezhi.github.io/2019/03/04/flink-concepts-programming-model/</id>
    <published>2019-03-04T02:16:57.000Z</published>
    <updated>2019-03-08T09:40:58.301Z</updated>
    
    <content type="html"><![CDATA[<p>Flink çš„ç¼–ç¨‹æ¨¡å‹ä¸ºæ•°æ®æµç¼–ç¨‹æ¨¡å‹ï¼ˆDataflow Programming Modelï¼‰ï¼Œè¿™é‡Œä»‹ç»ç¼–ç¨‹æ¨¡å‹é‡Œé¢çš„å‡ ä¸ªæ¦‚å¿µã€‚<br><a id="more"></a></p><p>æœ¬æ–‡è¯‘è‡ªFlinkå®˜ç½‘ï¼š<br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/concepts/programming-model.html" target="_blank" rel="noopener">Apache Flink 1.7 Documentation: Dataflow Programming Model</a></p><p>æ•°æ®æµç¼–ç¨‹æ¨¡å‹ï¼ˆDataflow Programming Modelï¼‰</p><h2 id="æŠ½è±¡å±‚æ¬¡ï¼ˆLevels-of-Abstractionï¼‰"><a href="#æŠ½è±¡å±‚æ¬¡ï¼ˆLevels-of-Abstractionï¼‰" class="headerlink" title="æŠ½è±¡å±‚æ¬¡ï¼ˆLevels of Abstractionï¼‰"></a>æŠ½è±¡å±‚æ¬¡ï¼ˆLevels of Abstractionï¼‰</h2><p><a href="https://www.notion.so/1bd6bd9f543540b7be20ecdd8848cc4e#b8c5801ae50045e0bf336e6ae77542be" target="_blank" rel="noopener"></a><br><img src="/2019/03/04/flink-concepts-programming-model/levels_of_abstraction.svg"><br><em>Flink æä¾›å‡ ç§ä¸åŒå±‚æ¬¡çš„æŠ½è±¡æ¥å¼€å‘ <strong>æµ/æ‰¹ï¼ˆstreaming/batchï¼‰</strong>ç¨‹åº</em></p><ul><li>æœ€ä½çº§çš„æŠ½è±¡ä»…æä¾›<strong>çŠ¶æ€æµï¼ˆstateful streamingï¼‰</strong>ï¼Œå®ƒé€šè¿‡ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/stream/operators/process_function.html" target="_blank" rel="noopener">Process Function</a> ï¼ˆå¤„ç†å‡½æ•°ï¼‰å†…åµŒåœ¨ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/datastream_api.html" target="_blank" rel="noopener">DataStream API</a> ä¸­ã€‚å®ƒå®¹è®¸ç”¨æˆ·è‡ªç”±åœ°å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæµçš„äº‹ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€è‡´çš„å®¹é”™çŠ¶æ€ã€‚æ­¤å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ç»™äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´æ³¨å†Œå›è°ƒï¼Œä½¿å¾—ç¨‹åºå¯ä»¥å®ç°å¤æ‚çš„è®¡ç®—ã€‚</li><li><p>å®è·µä¸­ï¼Œå¤šæ•°çš„åº”ç”¨ç¨‹åºä¸éœ€è¦ä½¿ç”¨ä¸Šè¿°çš„ä½çº§çš„æŠ½è±¡ï¼Œä»…éœ€è¦ä½¿ç”¨<strong>æ ¸å¿ƒæ¥å£ï¼ˆCore APIï¼‰</strong>æ¥ç¼–ç ï¼Œæ¯”å¦‚ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/datastream_api.html" target="_blank" rel="noopener">DataStream API</a> (æ•°æ®æµæ¥å£ï¼Œæœ‰ç•Œ/æ— ç•Œæµ) å’Œ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/batch/index.html" target="_blank" rel="noopener">DataSet API</a> ï¼ˆæ•°æ®é›†æ¥å£ï¼Œæœ‰ç•Œæ•°æ®é›†ï¼‰ã€‚è¿™äº›æµç•…çš„æ¥å£ä¸ºæ•°æ®å¤„ç†æä¾›äº†é€šç”¨æ„å»ºæµç¨‹ï¼Œè¯¸å¦‚ç”¨æˆ·æŒ‡å®šçš„è½¬æ¢ï¼ˆtransformationï¼‰ã€è¿æ¥ï¼ˆjoinï¼‰ã€èšåˆï¼ˆaggregationï¼‰ã€çª—å£ï¼ˆwindowï¼‰ã€çŠ¶æ€ï¼ˆstateï¼‰ç­‰ä¸åŒå½¢å¼ã€‚è¿™äº›æ¥å£å¤„ç†çš„æ•°æ®ç±»å‹åœ¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸­ä»¥ç±»ï¼ˆclassï¼‰çš„å½¢å¼å‘ˆç°ã€‚</p><p>  ä½å±‚æ¬¡çš„<em>å¤„ç†å‡½æ•°ï¼ˆProcess Functionï¼‰</em>ä¸<em>æ•°æ®æµæ¥å£ï¼ˆ</em><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/datastream_api.html" target="_blank" rel="noopener">DataStream API</a><em>ï¼‰</em>çš„äº¤äº’ï¼Œä½¿å¾—æŸäº›ç‰¹å®šçš„æ“ä½œå¯ä»¥æŠ½è±¡ä¸ºæ›´ä½çš„å±‚æ¬¡æˆä¸ºå¯èƒ½ã€‚<em>æ•°æ®é›†æ¥å£ï¼ˆDataSet APIï¼‰</em>åœ¨æœ‰ç•Œçš„æ•°æ®é›†ä¸Šæä¾›é¢å¤–çš„åŸå§‹æ“ä½œï¼Œä¾‹å¦‚å¾ªç¯å’Œè¿­ä»£ï¼ˆloops/iterationsï¼‰ã€‚</p></li><li><p><strong>è¡¨æ¥å£ï¼ˆTable APIï¼‰</strong>ä½¿ä»¥è¡¨ä¸ºä¸­å¿ƒçš„å£°æ˜æ€§ DSLï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜è¡¨ï¼ˆå½“å±•ç¤ºæµçš„æ—¶å€™ï¼‰ã€‚Table APIéµå¾ªï¼ˆæ‰©å±•ï¼‰å…³ç³»å‹æ¨¡å‹ï¼šè¡¨é™„åŠ äº†ä¸€ä¸ªæ¨¡å¼(schema)ï¼ˆç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼‰ï¼Œæ­¤APIæä¾›äº†å¯æ¯”è¾ƒçš„æ“ä½œï¼Œä¾‹å¦‚selectï¼Œprojectï¼Œjoinï¼Œgroup-byï¼Œaggregateç­‰ã€‚Table APIç¨‹åºä»¥å£°æ˜æ–¹å¼å®šä¹‰åº”è¯¥æ‰§è¡Œçš„é€»è¾‘æ“ä½œï¼Œè€Œä¸æ˜¯å‡†ç¡®åœ°æŒ‡å®šæ“ä½œä»£ç ã€‚ å°½ç®¡Table APIå¯ä»¥é€šè¿‡å„ç§ç±»å‹çš„ç”¨æˆ·å®šä¹‰å‡½æ•°è¿›è¡Œæ‰©å±•ï¼Œä½†å®ƒçš„è¡¨ç°åŠ›ä¸å¦‚Core APIï¼Œä½†ä½¿ç”¨èµ·æ¥æ›´ç®€æ´ï¼ˆç¼–å†™çš„ä»£ç æ›´å°‘ï¼‰ã€‚ æ­¤å¤–ï¼ŒTable APIç¨‹åºè¿˜ä¼šé€šè¿‡ä¼˜åŒ–ç¨‹åºï¼Œåœ¨æ‰§è¡Œä¹‹å‰åº”ç”¨ä¼˜åŒ–è§„åˆ™ã€‚</p><p>  å¯ä»¥åœ¨è¡¨å’ŒDataStream/ DataSetä¹‹é—´æ— ç¼è½¬æ¢ï¼Œå…è®¸åœ¨ç¨‹åºä¸­æ··åˆTable APIä»¥åŠDataStreamå’ŒDataSet APIã€‚</p></li><li><p>Flinkæä¾›çš„æœ€é«˜çº§æŠ½è±¡æ˜¯<strong>SQL</strong>ã€‚ è¿™ç§æŠ½è±¡åœ¨è¯­ä¹‰å’Œè¡¨è¾¾æ–¹é¢ç±»ä¼¼äºTable APIï¼Œä½†æ˜¯å°†ç¨‹åºè¡¨ç¤ºä¸ºSQLæŸ¥è¯¢è¡¨è¾¾å¼ã€‚ SQLæŠ½è±¡ä¸Table APIç´§å¯†äº¤äº’ï¼ŒSQLæŸ¥è¯¢å¯ä»¥åœ¨Table APIä¸­å®šä¹‰çš„è¡¨ä¸Šæ‰§è¡Œã€‚</p></li></ul><h2 id="ç¨‹åºå’Œæ•°æ®æµï¼ˆPrograms-and-Dataflowsï¼‰"><a href="#ç¨‹åºå’Œæ•°æ®æµï¼ˆPrograms-and-Dataflowsï¼‰" class="headerlink" title="ç¨‹åºå’Œæ•°æ®æµï¼ˆPrograms and Dataflowsï¼‰"></a>ç¨‹åºå’Œæ•°æ®æµï¼ˆPrograms and Dataflowsï¼‰</h2><p>Flinkç¨‹åºçš„åŸºæœ¬æ„å»ºå—æ˜¯<strong>æµï¼ˆstreamsï¼‰</strong>å’Œ<strong>è½¬æ¢ï¼ˆtransformationsï¼‰</strong>ã€‚ ï¼ˆè¯·æ³¨æ„ï¼ŒFlinkçš„DataSet APIä¸­ä½¿ç”¨çš„DataSetä¹Ÿæ˜¯å†…éƒ¨æµï¼Œç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚ï¼‰ä»æ¦‚å¿µä¸Šè®²ï¼Œ<em>æµ</em>æ˜¯ï¼ˆå¯èƒ½æ°¸æ— æ­¢å¢ƒçš„ï¼‰æ•°æ®è®°å½•æµï¼Œè€Œ<em>è½¬æ¢</em>æ˜¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªæµä½œä¸ºè¾“å…¥ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºæµçš„æ“ä½œã€‚ </p><p>æ‰§è¡Œæ—¶ï¼ŒFlinkç¨‹åºæ˜ å°„åˆ°<strong>æµæ•°æ®æµï¼ˆstreaming dataflowsï¼‰</strong>ï¼Œç”±<strong>æµ(streams)</strong>å’Œè½¬æ¢<strong>è¿ç®—ç¬¦(operators)</strong>ç»„æˆã€‚ æ¯ä¸ªæ•°æ®æµéƒ½ä»¥ä¸€ä¸ªæˆ–å¤šä¸ª<strong>æº(sources)</strong>å¼€å¤´ï¼Œå¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ª<strong>æ¥æ”¶å™¨(sinks)</strong>ç»“æŸã€‚ æ•°æ®æµç±»ä¼¼äºä»»æ„<strong>æœ‰å‘æ— ç¯å›¾ï¼ˆDAGs, Directed acyclic graphsï¼‰</strong>ã€‚ å°½ç®¡é€šè¿‡<em>è¿­ä»£ç»“æ„</em>å…è®¸ç‰¹æ®Šå½¢å¼çš„å¾ªç¯ï¼Œä½†ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œ<del>æ©é¥°</del>ç®€åŒ–ã€‚</p><img src="/2019/03/04/flink-concepts-programming-model/program_dataflow.svg"><p>é€šå¸¸ï¼Œç¨‹åºä¸­çš„è½¬æ¢ä¸æ•°æ®æµä¸­çš„è¿ç®—ç¬¦ä¹‹é—´å­˜åœ¨ä¸€å¯¹ä¸€çš„å¯¹åº”å…³ç³»ã€‚ ä½†æ˜¯ï¼Œæœ‰æ—¶ä¸€ä¸ªè½¬æ¢å¯èƒ½åŒ…å«å¤šä¸ªè½¬æ¢è¿ç®—ç¬¦ã€‚</p><p>æºï¼ˆsorucesï¼‰å’Œæ¥æ”¶å™¨ï¼ˆsinksï¼‰è¢«è®°å½•åœ¨<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/connectors/index.html" target="_blank" rel="noopener">æµè¿æ¥å™¨</a>å’Œ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/batch/connectors.html" target="_blank" rel="noopener">æ‰¹å¤„ç†è¿æ¥å™¨</a>æ–‡æ¡£ä¸­ã€‚ è½¬æ¢ï¼ˆtransformationï¼‰è¢«è®°å½•åœ¨<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/stream/operators/index.html" target="_blank" rel="noopener">DataStreamè¿ç®—ç¬¦</a>å’Œ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/batch/dataset_transformations.html" target="_blank" rel="noopener">DataSetè½¬æ¢</a>ä¸­ã€‚</p><h2 id="å¹¶è¡Œæ•°æ®æµ"><a href="#å¹¶è¡Œæ•°æ®æµ" class="headerlink" title="å¹¶è¡Œæ•°æ®æµ"></a>å¹¶è¡Œæ•°æ®æµ</h2><p>Flinkä¸­çš„ç¨‹åºæœ¬è´¨ä¸Šæ˜¯å¹¶è¡Œï¼ˆparallelï¼‰å’Œåˆ†å¸ƒå¼çš„ï¼ˆdistributedï¼‰ã€‚ åœ¨æ‰§è¡ŒæœŸé—´ï¼Œ<em>æµ</em>å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª<em>æµåˆ†åŒºï¼ˆstream partitionsï¼‰</em>ï¼Œå¹¶ä¸”æ¯ä¸ª<em>è¿ç®—ç¬¦</em>å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª<em>è¿ç®—å­ä»»åŠ¡(operator subtasks)</em>ã€‚ è¿ç®—å­ä»»åŠ¡å½¼æ­¤ç‹¬ç«‹ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½æ˜¯åœ¨ä¸åŒçš„æœºå™¨æˆ–å®¹å™¨ä¸Šæ‰§è¡Œã€‚</p><p>è¿ç®—å­ä»»åŠ¡çš„æ•°é‡å°±æ˜¯æŸä¸ªç‰¹å®šè¿ç®—ç¬¦çš„<strong>å¹¶è¡Œåº¦ï¼ˆparallelismï¼‰</strong>ã€‚ æµçš„å¹¶è¡Œåº¦å§‹ç»ˆæ˜¯å…¶ç”Ÿæˆçš„è¿ç®—ç¬¦çš„å¹¶è¡Œåº¦ã€‚ åŒä¸€ç¨‹åºçš„ä¸åŒè¿ç®—ç¬¦å¯èƒ½å…·æœ‰ä¸åŒçš„å¹¶è¡Œçº§åˆ«ã€‚</p><img src="/2019/03/04/flink-concepts-programming-model/parallel_dataflow.svg"><p>æµå¯ä»¥ä»¥<em>ä¸€å¯¹ä¸€ï¼ˆæˆ–è½¬å‘ï¼‰</em>çš„æ¨¡å¼æˆ–ä»¥<em>é‡æ–°åˆ†å‘</em>çš„æ¨¡å¼åœ¨ä¸¤ä¸ªè¿ç®—ç¬¦ä¹‹é—´ä¼ è¾“æ•°æ®ï¼š</p><ul><li><strong>ä¸€å¯¹ä¸€ï¼ˆOne-to-oneï¼‰</strong>æµï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¸Šå›¾ä¸­çš„<em>Source</em>å’Œ<em>map()</em>è¿ç®—ç¬¦ä¹‹é—´ï¼‰ä¿ç•™å…ƒç´ çš„åˆ†åŒºå’Œæ’åºã€‚è¿™æ„å‘³ç€<em>map()</em>è¿ç®—ç¬¦çš„subtask[1]çœ‹åˆ°çš„å…ƒç´ ä¸<em>Source</em>è¿ç®—ç¬¦çš„subtask[1]ç”Ÿæˆçš„å…ƒç´ é¡ºåºç›¸åŒã€‚</li><li><strong>é‡æ–°åˆ†å‘ï¼ˆRedistributingï¼‰</strong>æµï¼ˆåœ¨ä¸Šé¢çš„<em>map()</em>å’Œ<em>keyBy/window</em>ä¹‹é—´ï¼Œä»¥åŠ<em>keyBy/window</em>å’Œ<em>Sink</em>ä¹‹é—´ï¼‰é‡æ–°åˆ†é…æµçš„åˆ†åŒºã€‚æ¯ä¸ª<em>è¿ç®—å­ä»»åŠ¡</em>å°†æ•°æ®å‘é€åˆ°ä¸åŒçš„ç›®æ ‡å­ä»»åŠ¡ï¼Œå…·ä½“å–å†³äºæ‰€é€‰çš„è½¬æ¢ã€‚ç¤ºä¾‹æ˜¯<em>keyBy()</em>ï¼ˆé€šè¿‡æ•£åˆ—é”®é‡æ–°åˆ†åŒºï¼‰ï¼Œ<em>broadcast()</em>æˆ–<em>rebalance()</em>ï¼ˆéšæœºé‡æ–°åˆ†åŒºï¼‰ã€‚åœ¨<em>é‡æ–°åˆ†å‘</em>çš„äº¤æ¢ä¸­ï¼Œå…ƒç´ ä¹‹é—´çš„æ’åºä»…ä¿ç•™åœ¨æ¯å¯¹å‘é€å’Œæ¥æ”¶å­ä»»åŠ¡ä¸­ï¼ˆä¾‹å¦‚ï¼Œ<em>map()</em>çš„subtask[1]å’ŒkeyBy/windowçš„subtask[2]ï¼‰ã€‚å› æ­¤ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¿ç•™äº†æ¯ä¸ªé”®çš„æ’åºï¼Œä½†å¹¶è¡Œåº¦ç¡®å®å¸¦æ¥äº†ä¸åŒé”®çš„èšåˆç»“æœåˆ°è¾¾sinkçš„é¡ºåºçš„ä¸ç¡®å®šæ€§ã€‚</li></ul><p>æœ‰å…³é…ç½®å’Œæ§åˆ¶å¹¶è¡Œæ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/parallel.html" target="_blank" rel="noopener">å¹¶è¡Œæ‰§è¡Œ</a>çš„æ–‡æ¡£ã€‚</p><h2 id="çª—å£ï¼ˆWindowsï¼‰"><a href="#çª—å£ï¼ˆWindowsï¼‰" class="headerlink" title="çª—å£ï¼ˆWindowsï¼‰"></a>çª—å£ï¼ˆWindowsï¼‰</h2><p>èšåˆäº‹ä»¶ï¼ˆå¦‚ï¼Œcountsï¼Œsumsï¼‰åœ¨æµä¸Šçš„å·¥ä½œæ–¹å¼ä¸æ‰¹å¤„ç†æ–¹å¼ä¸åŒã€‚ ä¾‹å¦‚ï¼Œä¸å¯èƒ½è®¡ç®—æµä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå› ä¸ºæµé€šå¸¸æ˜¯æ— é™çš„ï¼ˆæ— ç•Œï¼‰ã€‚ ç›¸åï¼Œæµä¸Šçš„èšåˆï¼ˆcountsï¼Œsumsç­‰ï¼‰ç”±<strong>çª—å£(windows)</strong>é™å®šï¼Œä¾‹å¦‚â€œåœ¨æœ€å5åˆ†é’Ÿå†…è®¡æ•°â€æˆ–â€œæœ€å100ä¸ªå…ƒç´ çš„æ€»å’Œâ€ã€‚</p><p>Windowså¯ä»¥æ˜¯æ—¶é—´é©±åŠ¨çš„ï¼ˆä¾‹å¦‚ï¼šæ¯30ç§’ï¼‰æˆ–æ•°æ®é©±åŠ¨ï¼ˆä¾‹å¦‚ï¼šæ¯100ä¸ªå…ƒç´ ï¼‰ã€‚ äººä»¬é€šå¸¸åŒºåˆ†ä¸åŒç±»å‹çš„çª—å£ï¼Œä¾‹å¦‚<strong><em>ç¿»æ»šçª—å£(tumbling windows)</em></strong>ï¼ˆæ²¡æœ‰é‡å ï¼‰ï¼Œ<strong><em>æ»‘åŠ¨çª—å£(sliding windows)</em></strong>ï¼ˆå…·æœ‰é‡å ï¼‰å’Œ<strong><em>ä¼šè¯çª—å£(session windows)</em></strong>ï¼ˆç”±ä¸æ´»åŠ¨é—´éš™æ‰“æ–­ï¼‰ã€‚</p><img src="/2019/03/04/flink-concepts-programming-model/windows.svg"><p>å¯ä»¥åœ¨<a href="https://flink.apache.org/news/2015/12/04/Introducing-windows.html" target="_blank" rel="noopener">æ­¤åšå®¢</a>æ–‡ç« ä¸­æ‰¾åˆ°æ›´å¤šçª—å£ç¤ºä¾‹ã€‚ æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯å‚é˜…<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/stream/operators/windows.html" target="_blank" rel="noopener">çª—å£æ–‡æ¡£</a>ã€‚</p><h2 id="æ—¶é—´ï¼ˆTimeï¼‰"><a href="#æ—¶é—´ï¼ˆTimeï¼‰" class="headerlink" title="æ—¶é—´ï¼ˆTimeï¼‰"></a>æ—¶é—´ï¼ˆTimeï¼‰</h2><p>å½“åœ¨æµç¨‹åºä¸­å¼•ç”¨æ—¶é—´ï¼ˆä¾‹å¦‚å®šä¹‰çª—å£ï¼‰æ—¶ï¼Œå¯ä»¥å‚è€ƒä¸åŒçš„æ—¶é—´æ¦‚å¿µï¼š</p><ul><li><strong>äº‹ä»¶æ—¶é—´ï¼ˆEvent Timeï¼‰</strong>æ˜¯åˆ›å»ºäº‹ä»¶çš„æ—¶é—´ã€‚ å®ƒé€šå¸¸ç”±äº‹ä»¶ä¸­çš„æ—¶é—´æˆ³æè¿°ï¼Œä¾‹å¦‚ç”±ç”Ÿäº§ä¼ æ„Ÿå™¨æˆ–ç”Ÿäº§æœåŠ¡ç”Ÿæˆã€‚ Flinké€šè¿‡<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/event_timestamps_watermarks.html" target="_blank" rel="noopener">æ—¶é—´æˆ³åˆ†é…å™¨</a>ï¼ˆtimestamp assignersï¼‰è®¿é—®äº‹ä»¶æ—¶é—´æˆ³ã€‚</li><li><strong>æ¥æ”¶æ—¶é—´(Ingestion Time)</strong>æ˜¯äº‹ä»¶åœ¨æºæ“ä½œç¬¦å¤„è¿›å…¥Flinkæ•°æ®æµçš„æ—¶é—´ã€‚</li><li><strong>å¤„ç†æ—¶é—´ï¼ˆProcessing Timeï¼‰</strong>æ˜¯æ¯ä¸ªæ“ä½œç¬¦æ‰§è¡ŒåŸºäºæ—¶é—´çš„æ“ä½œæ—¶çš„æœ¬åœ°æ—¶é—´ã€‚</li></ul><img src="/2019/03/04/flink-concepts-programming-model/event_ingestion_processing_time.svg"><p>äº‹ä»¶æ—¶é—´ï¼Œæ¥æ”¶æ—¶é—´å’Œå¤„ç†æ—¶é—´</p><p>æœ‰å…³å¦‚ä½•å¤„ç†æ—¶é—´çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/event_time.html" target="_blank" rel="noopener">äº‹ä»¶æ—¶é—´æ–‡æ¡£</a>ã€‚</p><h2 id="çŠ¶æ€è¿ç®—ï¼ˆStateful-Operationsï¼‰"><a href="#çŠ¶æ€è¿ç®—ï¼ˆStateful-Operationsï¼‰" class="headerlink" title="çŠ¶æ€è¿ç®—ï¼ˆStateful Operationsï¼‰"></a>çŠ¶æ€è¿ç®—ï¼ˆStateful Operationsï¼‰</h2><p>è™½ç„¶æ•°æ®æµä¸­çš„è®¸å¤šè¿ç®—åªæ˜¯ä¸€æ¬¡æŸ¥çœ‹ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶ï¼ˆä¾‹å¦‚äº‹ä»¶è§£æå™¨ï¼‰ï¼Œä½†æŸäº›è¿ç®—ä¼šè®°ä½å¤šä¸ªäº‹ä»¶ï¼ˆä¾‹å¦‚çª—å£è¿ç®—ç¬¦ï¼‰çš„ä¿¡æ¯ã€‚è¿™äº›æ“ä½œç§°ä¸º<strong>stateful</strong>ã€‚</p><p>çŠ¶æ€è¿ç®—çš„çŠ¶æ€å¯ä»¥è¢«è®¤ä¸ºæ˜¯ç”±å†…åµŒçš„é”®/å€¼å­˜å‚¨æ¥ç»´æŠ¤ã€‚çŠ¶æ€å’ŒçŠ¶æ€è¿ç®—ç¬¦è¯»å–çš„æµè¢«ä¸¥æ ¼åœ°åˆ†åŒºå’Œåˆ†å‘ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨<em>keyBy()</em>å‡½æ•°ä¹‹åæ‰èƒ½åœ¨keyed streamä¸Šè®¿é—®é”®/å€¼çŠ¶æ€ï¼Œå¹¶ä¸”é™åˆ¶ä¸ºä¸å½“å‰äº‹ä»¶çš„é”®ç›¸å…³è”çš„å€¼ã€‚å¯¹é½æµå’ŒçŠ¶æ€çš„é”®å¯ç¡®ä¿æ‰€æœ‰çŠ¶æ€æ›´æ–°éƒ½æ˜¯æœ¬åœ°æ“ä½œï¼Œä»è€Œä¿è¯ä¸€è‡´æ€§è€Œæ— éœ€äº‹åŠ¡å¼€é”€ã€‚å¯¹é½æ“ä½œè¿˜å…è®¸Flinké‡æ–°åˆ†é…çŠ¶æ€å¹¶é€æ˜åœ°è°ƒæ•´æµåˆ†åŒºã€‚</p><img src="/2019/03/04/flink-concepts-programming-model/state_partitioning.svg"><p>çŠ¶æ€å’Œåˆ†åŒº</p><p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æœ‰å…³<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/stream/state/index.html" target="_blank" rel="noopener">çŠ¶æ€</a>çš„æ–‡æ¡£ã€‚</p><h2 id="å®¹é”™æ£€æŸ¥ç‚¹-Checkpoints-for-Fault-Tolerance"><a href="#å®¹é”™æ£€æŸ¥ç‚¹-Checkpoints-for-Fault-Tolerance" class="headerlink" title="å®¹é”™æ£€æŸ¥ç‚¹(Checkpoints for Fault Tolerance)"></a>å®¹é”™æ£€æŸ¥ç‚¹(Checkpoints for Fault Tolerance)</h2><p>Flinkä½¿ç”¨<strong>stream replay</strong>å’Œ<strong>æ£€æŸ¥ç‚¹(checkpointng)</strong>çš„ç»„åˆæ¥å®ç°å®¹é”™ã€‚æ£€æŸ¥ç‚¹ä¸æ¯ä¸ªè¾“å…¥æµä¸­çš„ç‰¹å®šç‚¹ä»¥åŠæ¯ä¸ªè¿ç®—ç¬¦çš„å¯¹åº”çŠ¶æ€ç›¸å…³ã€‚é€šè¿‡æ¢å¤è¿ç®—ç¬¦çš„çŠ¶æ€å¹¶ä»æ£€æŸ¥ç‚¹é‡æ–°æ‰§è¡Œï¼ˆreplayï¼‰äº‹ä»¶ï¼Œå¯ä»¥ä»æ£€æŸ¥ç‚¹æ¢å¤æµæ•°æ®æµå¹¶ä¿æŒä¸€è‡´æ€§ï¼ˆexactly-once processing semanticsï¼‰ã€‚</p><p>æ£€æŸ¥ç‚¹é—´éš”æ˜¯æ‰§è¡ŒæœŸé—´çš„å®¹é”™å’Œæ¢å¤æ—¶é—´ï¼ˆéœ€è¦é‡æ”¾çš„äº‹ä»¶çš„æ•°é‡ï¼‰ä¹‹é—´çš„æŠ˜è¡·æ–¹æ³•ã€‚</p><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/internals/stream_checkpointing.html" target="_blank" rel="noopener">å®¹é”™çš„å†…éƒ¨æœºåˆ¶</a>ä¸­çš„æè¿°æä¾›äº†æœ‰å…³Flinkå¦‚ä½•ç®¡ç†æ£€æŸ¥ç‚¹å’Œç›¸å…³ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚æœ‰å…³å¯ç”¨å’Œé…ç½®æ£€æŸ¥ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/stream/state/checkpointing.html" target="_blank" rel="noopener">æ£€æŸ¥ç‚¹APIæ–‡æ¡£</a>ã€‚</p><h2 id="æ‰¹å¤„ç†æµ"><a href="#æ‰¹å¤„ç†æµ" class="headerlink" title="æ‰¹å¤„ç†æµ"></a>æ‰¹å¤„ç†æµ</h2><p>Flinkæ‰§è¡Œ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/batch/index.html" target="_blank" rel="noopener">æ‰¹å¤„ç†ç¨‹åº</a>ä½œä¸ºæµç¨‹åºçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå³æµæ˜¯æœ‰ç•Œçš„ï¼ˆæœ‰é™æ•°é‡çš„å…ƒç´ ï¼‰ã€‚ <em>DataSet</em>åœ¨å†…éƒ¨è¢«è§†ä¸ºæ•°æ®æµã€‚å› æ­¤ï¼Œä¸Šè¿°æ¦‚å¿µä»¥ç›¸åŒçš„æ–¹å¼åº”ç”¨äºæ‰¹å¤„ç†ç¨‹åºï¼Œå¹¶ä¸”å®ƒä»¬é€‚ç”¨äºæµç¨‹åºï¼Œé™¤äº†å°‘æ•°ä¾‹å¤–ï¼š</p><ul><li><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/batch/fault_tolerance.html" target="_blank" rel="noopener">æ‰¹å¤„ç†ç¨‹åºçš„å®¹é”™</a>ä¸ä½¿ç”¨æ£€æŸ¥ç‚¹ã€‚é€šè¿‡å®Œå…¨é‡æ–°æ‰§è¡Œæµæ¥è¿›è¡Œæ¢å¤ï¼Œå› ä¸ºè¾“å…¥æ˜¯æœ‰é™çš„ã€‚è¿™ä¼šä½¿èµ„æºæ›´å¤šåœ°ç”¨äºæ¢å¤ï¼Œä¸”ä½¿å¾—å¸¸è§„å¤„ç†èµ„æºæ¶ˆè€—æ›´å°‘ï¼Œå› ä¸ºå®ƒé¿å…äº†æ£€æŸ¥ç‚¹ã€‚</li><li>DataSet APIä¸­çš„æœ‰çŠ¶æ€æ“ä½œï¼ˆstateful operationsï¼‰ä½¿ç”¨ç®€åŒ–çš„å†…å­˜/æ ¸å¤–(in-memory/out-of-core)æ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯é”®/å€¼ç´¢å¼•ã€‚</li><li>DataSet APIå¼•å…¥äº†ç‰¹æ®Šçš„åŒæ­¥ï¼ˆ superstep-basedï¼‰è¿­ä»£ï¼Œè¿™äº›è¿­ä»£åªèƒ½åœ¨æœ‰ç•Œæµä¸Šè¿›è¡Œã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/batch/iterations.html" target="_blank" rel="noopener">è¿­ä»£æ–‡æ¡£</a>ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flink çš„ç¼–ç¨‹æ¨¡å‹ä¸ºæ•°æ®æµç¼–ç¨‹æ¨¡å‹ï¼ˆDataflow Programming Modelï¼‰ï¼Œè¿™é‡Œä»‹ç»ç¼–ç¨‹æ¨¡å‹é‡Œé¢çš„å‡ ä¸ªæ¦‚å¿µã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Flink" scheme="http://jiezhi.github.io/categories/Flink/"/>
    
    
      <category term="Apache" scheme="http://jiezhi.github.io/tags/Apache/"/>
    
      <category term="Flink" scheme="http://jiezhi.github.io/tags/Flink/"/>
    
      <category term="Translate" scheme="http://jiezhi.github.io/tags/Translate/"/>
    
      <category term="Big Data" scheme="http://jiezhi.github.io/tags/Big-Data/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«å­¦ä¹ å¤§æ•°æ®ç›¸å…³ç¬”è®°ï¼Œå¹¶é‚€è¯·æ‚¨åŠ å…¥</title>
    <link href="http://jiezhi.github.io/2019/02/26/join-bigdata-group/"/>
    <id>http://jiezhi.github.io/2019/02/26/join-bigdata-group/</id>
    <published>2019-02-26T06:25:51.000Z</published>
    <updated>2019-02-26T06:41:56.742Z</updated>
    
    <content type="html"><![CDATA[<p>ç”¨ Notion æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¹Ÿç§¯ç´¯äº†ä¸å°‘æŠ€æœ¯çŸ¥è¯†ç‚¹å’Œè¯»ä¹¦ç¬”è®°ã€‚è¿™é‡Œåˆ›å»ºäº†ã€å¤§æ•°æ®ã€ç›¸å…³çš„<br> WORKSPACEï¼Œå¸Œæœ›æœ‰å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·åŠ å…¥ï¼Œäº’ç›¸å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚</p><a id="more"></a><h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><p><a href="http://www.notion.so/data365" target="_blank" rel="noopener">www.notion.so/data365</a> </p><p>é¡¹ç›®é‡Œç›®å‰ä¸»è¦åˆ†ä¸ºä¸¤å—ï¼š</p><ul><li><p><a href="https://www.notion.so/data365/Inbox-ea89df07495547ceb210676e28eca371" target="_blank" rel="noopener">Inbox</a></p><p>  é¡¹ç›®æˆå‘˜å¯ä»¥æ·»åŠ ä»»ä½•å¤§æ•°æ®ç›¸å…³çš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬ä½†ä¸å±€é™äºæ¶æ„ã€è°ƒä¼˜ã€åšå®¢ã€ç¬”è®°ç­‰ï¼‰</p></li><li><p><a href="https://www.notion.so/data365/Big-Data-7a897ed23bad42da89075fd5b7ed2407" target="_blank" rel="noopener">Big Data</a></p><p>  ç»è¿‡åˆ†ç±»ç¼–è¾‘åçš„å†…å®¹ï¼Œç›®æ ‡æ˜¯ä¿è¯å¯è¯»ï¼Œå¹¶ä¸”æœ‰ç”¨</p></li></ul><h2 id="è´¦å·æ³¨å†Œ"><a href="#è´¦å·æ³¨å†Œ" class="headerlink" title="è´¦å·æ³¨å†Œ"></a>è´¦å·æ³¨å†Œ</h2><p>é¦–å…ˆä½ éœ€è¦æœ‰ Notion çš„è´¦å·ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å…ˆ<a href="https://www.notion.so/?r=507f808e5cb544809dfe98d930ee2cae" target="_blank" rel="noopener">æ³¨å†Œ</a> ï¼ˆæœ‰affï¼‰</p><h2 id="Notion-å…¥é—¨"><a href="#Notion-å…¥é—¨" class="headerlink" title="Notion å…¥é—¨"></a>Notion å…¥é—¨</h2><p><a href="https://www.notion.so/e040febf70a94950b8620e6f00005004" target="_blank" rel="noopener">Guides &amp; FAQs</a></p><p>å¼ºçƒˆå»ºè®®é˜…è¯»å®˜æ–¹å…¥é—¨æ–‡æ¡£ã€‚</p><h2 id="åŠ å…¥-Workspace"><a href="#åŠ å…¥-Workspace" class="headerlink" title="åŠ å…¥ Workspace"></a>åŠ å…¥ Workspace</h2><p>æ¬¢è¿å„ä½å¯¹å¤§æ•°æ®æ„Ÿå…´è¶£çš„æœ‹å‹åŠ å…¥ï¼ŒåŠ å…¥æ–¹å¼ï¼š</p><ol><li>å¯ä»¥<a href="mailto:Jiezhi007+notion@gmail.com" target="_blank" rel="noopener">å‘é‚®ä»¶</a>ç»™æˆ‘</li><li><a href="https://telegram.me/Jiezhi" target="_blank" rel="noopener">ç”µæŠ¥æˆ‘</a></li><li>åŠ å…¥<a href="https://join.slack.com/t/bigdata365/shared_invite/enQtNTU5NjI0MDY0MjEyLWQ0MmVkNDZiOGU4Mjk0NjVhNTU3YjhmMmRlYTQxZmRhOTZmMzczNTM0YmUzNmE3YTNjNGQ2NmEwMDBhYmY5ODk" target="_blank" rel="noopener">Slack ç¾¤ç»„</a>ï¼Œ(é€šè¿‡ slack å¯ä»¥åŠæ—¶å¾—åˆ°é¡¹ç›®ç›¸å…³çš„é€šçŸ¥)ï¼š</li><li><a href="https://t.me/joinchat/BbrpxRVra-X8U5VmM92L3Q" target="_blank" rel="noopener">ç”µæŠ¥ç¾¤</a>ï¼ˆæ²¡æ³•ç§ä¿¡æˆ‘çš„ï¼Œå¯ä»¥å…ˆåŠ ç¾¤ï¼Œç„¶åæˆ‘ç§ä¿¡ä½ ï¼‰ </li></ol><h2 id="æƒé™è¯´æ˜"><a href="#æƒé™è¯´æ˜" class="headerlink" title="æƒé™è¯´æ˜"></a>æƒé™è¯´æ˜</h2><p>Notionæ”¯æŒå‡ ç§ä¸åŒçš„æƒé™ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><img src="/2019/02/26/join-bigdata-group/1.png"><ol><li>é»˜è®¤ç¾¤ç»„é‡Œæˆå‘˜åœ¨ <a href="https://www.notion.so/data365/Inbox-ea89df07495547ceb210676e28eca371" target="_blank" rel="noopener">Inbox</a> é‡Œæ‹¥æœ‰æƒé™ä¸ºã€Full Accessã€</li><li>é»˜è®¤ç¾¤ç»„åœ¨ <a href="https://www.notion.so/7a897ed2-3bad-42da-8907-5fd5b7ed2407" target="_blank" rel="noopener">Big Data</a> é‡Œçš„æƒé™ä¸ºã€Can Commentã€ï¼Œä½ å¯ä»¥é˜…è¯»å’Œè¯„è®ºä½†ä¸èƒ½ç¼–è¾‘ã€‚</li></ol><hr><blockquote><p>å¦‚æœ‰æ”¹åŠ¨ï¼Œå¯æŸ¥çœ‹<a href="https://www.notion.so/data365/Readme-1717a7ef97384eacaf3aa040d53dd1df" target="_blank" rel="noopener">æœ€æ–°ä¿¡æ¯</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”¨ Notion æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¹Ÿç§¯ç´¯äº†ä¸å°‘æŠ€æœ¯çŸ¥è¯†ç‚¹å’Œè¯»ä¹¦ç¬”è®°ã€‚è¿™é‡Œåˆ›å»ºäº†ã€å¤§æ•°æ®ã€ç›¸å…³çš„&lt;br&gt; WORKSPACEï¼Œå¸Œæœ›æœ‰å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·åŠ å…¥ï¼Œäº’ç›¸å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="BigData" scheme="http://jiezhi.github.io/categories/BigData/"/>
    
    
      <category term="Note" scheme="http://jiezhi.github.io/tags/Note/"/>
    
  </entry>
  
  <entry>
    <title>CAPå®šç†ä¸BASEç†è®º</title>
    <link href="http://jiezhi.github.io/2019/02/25/cap-with-base/"/>
    <id>http://jiezhi.github.io/2019/02/25/cap-with-base/</id>
    <published>2019-02-25T02:29:25.000Z</published>
    <updated>2019-02-26T06:24:16.621Z</updated>
    
    <content type="html"><![CDATA[<p>CAP: æ˜¯æŒ‡ Consistency(ä¸€è‡´æ€§), Availability(å¯ç”¨æ€§) å’Œ Partition Tolerance(å¯ç”¨æ€§).<br>BASE: <strong>B</strong>asically <strong>A</strong>vailableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰, <strong>S</strong>oft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’Œ <strong>E</strong>ventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰<br><a id="more"></a></p><h2 id="CAP-å®šç†"><a href="#CAP-å®šç†" class="headerlink" title="CAP å®šç†"></a>CAP å®šç†</h2><img src="/2019/02/25/cap-with-base/cap.png" title="cap"><ul><li><p><strong>Consistency</strong> <strong>ä¸€è‡´æ€§</strong>ï¼ˆèŠ‚ç‚¹æˆ–ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨æ•°æ®ï¼‰</p><p>  åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œä¸€è‡´æ€§æ˜¯æŒ‡æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´èƒ½å¦ä¿æŒä¸€è‡´çš„ç‰¹æ€§ã€‚åœ¨ä¸€è‡´æ€§çš„éœ€æ±‚ä¸‹ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿåœ¨æ•°æ®ä¸€è‡´çš„çŠ¶æ€ä¸‹æ‰§è¡Œæ›´æ–°æ“ä½œåï¼Œåº”è¯¥ä¿è¯ç³»ç»Ÿçš„æ•°æ®ä»ç„¶å¤„äºä¸€ç›´çš„çŠ¶æ€ã€‚</p></li><li><p><strong>Availability</strong> <strong>å¯ç”¨æ€§</strong>ï¼ˆæ¯ä¸ªè¯·æ±‚ä¼šå¾—åˆ°ä¸€ä¸ªå›åº”ï¼‰</p><p>  å¯ç”¨æ€§æ˜¯æŒ‡ç³»ç»Ÿæä¾›çš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚è¿™é‡Œçš„é‡ç‚¹æ˜¯â€æœ‰é™æ—¶é—´å†…â€å’Œâ€è¿”å›ç»“æœâ€ã€‚</p></li><li><p><strong>Partition Tolerance åˆ†åŒºå®¹é”™æ€§</strong>ï¼ˆç³»ç»Ÿè¿ä½œå°†ä¸ç®¡å¯ç”¨æ€§ã€åˆ†åŒºã€æ•°æ®æˆ–é€šä¿¡çš„ä¸¢å¤±ï¼‰</p><p>  åˆ†åŒºå®¹é”™æ€§çº¦æŸäº†ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¤Ÿä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚</p></li></ul><h2 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h2><ul><li><p><strong>B</strong>asically <strong>A</strong>vailableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰</p><p>  åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</p></li><li><p><strong>S</strong>oft stateï¼ˆè½¯çŠ¶æ€ï¼‰</p><p>  è½¯çŠ¶æ€ä¹Ÿç§°ä¸ºå¼±çŠ¶æ€ï¼Œå’Œç¡¬çŠ¶æ€ç›¸å¯¹ï¼Œæ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®å¬ä¸çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚</p></li><li><p><strong>E</strong>ventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</p><p>  æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§</p></li></ul><p>CAP ä¸ BASE å…³ç³»ä¸ºï¼š</p><blockquote><p>åœ¨åˆ†å¸ƒå¼çš„æ•°æ®ç³»ç»Ÿä¸­ï¼Œä½ èƒ½ä¿è¯ä¸‹é¢ä¸‰ä¸ªè¦æ±‚ä¸­çš„ä¸¤ä¸ªï¼šä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§ï¼Œä»¥åŠåˆ†åŒºå®¹é”™æ€§ã€‚åœ¨æ­¤æ¨¡å‹ä¸Šæ„å»ºçš„ç³»ç»Ÿå°†ç§°ä½œ BASE(åŸºæœ¬ä¸Šå¯ç”¨è½¯çŠ¶æ€æœ€ç»ˆä¸€è‡´)æ¶æ„ï¼Œä¸æ»¡è¶³ ACID æ€§è´¨ã€‚</p></blockquote><hr><h2 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h2><ul><li><p>Atomicity åŸå­æ€§</p><p>  ä¸€ä¸ªäº‹åŠ¡å¿…é¡»è¢«è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æœ€å°å·¥ä½œå•å…ƒã€‚</p></li><li><p>Consistency ä¸€è‡´æ€§</p><p>  æ•°æ®åº“æ€»æ˜¯ä»ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€è½¬æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€ã€‚</p></li><li><p>Isolation éš”ç¦»æ€§</p><p>  é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä¹‹å‰ï¼Œå¯¹å…¶ä»–äº‹ç‰©æ˜¯ä¸å¯è§çš„ã€‚</p></li><li><p>Durability æŒä¹…æ€§</p><p>  ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°±ä¼šæ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p></li></ul><hr><h2 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h2><ul><li><a href="https://hbase.apache.org/" target="_blank" rel="noopener">HBase</a>ã€<a href="http://www.hypertable.org/" target="_blank" rel="noopener">HyperTable</a> å’Œ <a href="https://www.wikiwand.com/en/Bigtable" target="_blank" rel="noopener">BigTable</a>ï¼Œæ»¡è¶³ CP æ€§è´¨ã€‚</li><li><a href="http://cassandra.apache.org/" target="_blank" rel="noopener">Cassandra</a>ã€<a href="https://aws.amazon.com/dynamodb/" target="_blank" rel="noopener">Dynamo</a> å’Œ <a href="https://www.project-voldemort.com/voldemort/" target="_blank" rel="noopener">Voldemort</a>ï¼Œæ»¡è¶³ APæ€§è´¨ã€‚</li></ul><hr><p>Referenceï¼š</p><p>ã€Šé«˜æ€§èƒ½MySQLã€‹</p><p>ã€Šå¤§æ•°æ®ä¸æ•°æ®ä»“åº“ã€‹</p><p><a href="https://www.cnblogs.com/duanxz/p/5229352.html" target="_blank" rel="noopener">CAPåŸåˆ™(CAPå®šç†)ã€BASEç†è®º - duanxz - åšå®¢å›­</a></p><p><a href="https://my.oschina.net/u/1175305/blog/1998062" target="_blank" rel="noopener">CAPå’ŒBASEç†è®ºçš„å…³ç³» - leoooooçš„ä¸ªäººç©ºé—´ - å¼€æºä¸­å›½</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CAP: æ˜¯æŒ‡ Consistency(ä¸€è‡´æ€§), Availability(å¯ç”¨æ€§) å’Œ Partition Tolerance(å¯ç”¨æ€§).&lt;br&gt;BASE: &lt;strong&gt;B&lt;/strong&gt;asically &lt;strong&gt;A&lt;/strong&gt;vailableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰, &lt;strong&gt;S&lt;/strong&gt;oft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’Œ &lt;strong&gt;E&lt;/strong&gt;ventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰&lt;br&gt;
    
    </summary>
    
      <category term="NoSQL" scheme="http://jiezhi.github.io/categories/NoSQL/"/>
    
    
      <category term="NoSQL" scheme="http://jiezhi.github.io/tags/NoSQL/"/>
    
      <category term="CAP" scheme="http://jiezhi.github.io/tags/CAP/"/>
    
      <category term="BASE" scheme="http://jiezhi.github.io/tags/BASE/"/>
    
      <category term="ACID" scheme="http://jiezhi.github.io/tags/ACID/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠApache Hive Cookbookã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="http://jiezhi.github.io/2019/02/19/note-hive-cookbook/"/>
    <id>http://jiezhi.github.io/2019/02/19/note-hive-cookbook/</id>
    <published>2019-02-19T09:26:42.000Z</published>
    <updated>2019-03-08T10:00:09.997Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰ SQL åŸºç¡€çš„è¯ï¼Œå·®ä¸å¤šä¸€å¤©å¯ä»¥çœ‹å®Œã€‚<br>è¿™é‡ŒæŠŠæˆ‘çœ‹è¿™æœ¬ä¹¦åšçš„ç¬”è®°åˆ†äº«ä¸€ä¸‹ï¼ˆä» <a href="https://www.notion.so/?r=507f808e5cb544809dfe98d930ee2cae" target="_blank" rel="noopener">Notion</a> é‡Œè¿ç§»å‡ºæ¥ï¼‰</p><a id="more"></a><img src="/2019/02/19/note-hive-cookbook/cover.jpg" title="cover"><h1 id="Developing-Hive"><a href="#Developing-Hive" class="headerlink" title="Developing Hive"></a>Developing Hive</h1><h2 id="Deploying-Hive-Metastore"><a href="#Deploying-Hive-Metastore" class="headerlink" title="Deploying Hive Metastore"></a>Deploying Hive Metastore</h2><ul><li>The Hive table and database definitions and mapping to the data in HDFS is stored in a metastore.</li><li>A metastore is a central repository for Hive metadata. Consists two main components:<ul><li>Services to which the client connects and queries the metastore</li><li>A backing database to store the metadata</li></ul></li><li><p>Configure:</p><ul><li>An <strong>embedded</strong> metastore</li><li>A <strong>local</strong> metastore</li><li><p>A <strong>remote</strong> metastore</p><img src="/2019/02/19/note-hive-cookbook/1.png" title="hive-service"><!-- ![](/hive-cookbook-hive-service.png) --><p>HIVE Service JVM</p></li></ul></li></ul><h1 id="Services-in-Hive"><a href="#Services-in-Hive" class="headerlink" title="Services in Hive"></a>Services in Hive</h1><h2 id="HiveServer2"><a href="#HiveServer2" class="headerlink" title="HiveServer2"></a>HiveServer2</h2><blockquote><p>HiveServer2 is an enhancement of HiveServer provided in earlier versions of Hive.HiveServerâ€™s limitations of <strong>concurrency</strong> and <strong>authentication</strong> is resolved in HiveServer2. HiveServer2 is based on <strong>Thrift RPC</strong>.It supports multiple types of clients, including JDBC and ODBC.</p></blockquote><h2 id="HiveServer2-High-Availability"><a href="#HiveServer2-High-Availability" class="headerlink" title="HiveServer2 High Availability"></a>HiveServer2 High Availability</h2><ul><li><strong>ZooKeeper</strong></li></ul><h2 id="Hive-metastore-service"><a href="#Hive-metastore-service" class="headerlink" title="Hive metastore service"></a>Hive metastore service</h2><ul><li>In Hive, the data is stored in <strong>HDFS</strong> and the table, database, schema, and the HQL definitions are stored in a <strong>metastore</strong>.</li><li>The metastore could be any RDBMS database, such as MYSQL or Oracle.</li><li>Hive creates a database and a set of tables in metastore to store HiveQL definitions.</li></ul><h2 id="Hue"><a href="#Hue" class="headerlink" title="Hue"></a>Hue</h2><h1 id="Understanding-the-Hive-Data-Model"><a href="#Understanding-the-Hive-Data-Model" class="headerlink" title="Understanding the Hive Data Model"></a>Understanding the Hive Data Model</h1><h2 id="Intruduction"><a href="#Intruduction" class="headerlink" title="Intruduction"></a>Intruduction</h2><ul><li>Data types<ul><li>Primitive data types<ul><li>Numeric data types</li><li>String data types</li><li>Date/Time data type</li><li>Miscellaneous data types<ul><li>Boolean</li><li>Binary</li></ul></li></ul></li><li>Complex data types<ul><li>STRUCT</li><li>MAP</li><li>ARRAY</li></ul></li></ul></li></ul><h2 id="Partitioning"><a href="#Partitioning" class="headerlink" title="Partitioning"></a>Partitioning</h2><blockquote><p>Partitioning in Hive is used to increase query performance.</p></blockquote><ul><li><p><strong>Mnaged</strong> table</p><blockquote><p>In a managed table, if you delete a talbe, then the data of that table will also get deleted. Similarly, if you delete a partition, then the data of that partition will also get deleted.</p></blockquote><pre><code>CREATE TABLE customer(id STRING, name STRING, gender STRING) PARTITIONED BY (country STRING, state STRING);</code></pre><ul><li>By setting the value of <code>hive.mapred.mode</code> to strict, it will prevent running risky queries.</li><li>Loading data in a managed partitioned table<ul><li>Static Partitioning</li><li>Dynamic Partitioning</li></ul></li></ul></li><li><p><strong>External</strong> table</p><blockquote><p>Patitioning external tables works in the same way as in managed tables. Except this in the external table, when you delete a partition, the data file doesnâ€™t get deleted.</p></blockquote></li></ul><h2 id="Bucketing"><a href="#Bucketing" class="headerlink" title="Bucketing"></a>Bucketing</h2><blockquote><p>Bucketing is a technique that allows you to decompose your data into more manageable parts, that is, fix the number of buckets.</p></blockquote><ul><li>Usually, partitioning provides a way of segregating the data of a Hive table into multiple files or directories.</li><li>Partitioning doesnâ€™t perform well if there is a large number of partitions.</li><li><p>Bucketing concept is based on the hashing principle, where same type of keys are always sent to the same bucket.</p><p>  <code>Bucket number = hash_function(bucketing_column) mod num_buckets</code></p><p>  <code>set hive.enforce.bucketing=true;</code></p></li><li><p>Two bullet points:</p><ul><li>In partitioning, a column defined as a partitioned column is not included in a schema columns of a Hive table. But in bucketing, a column defined as a bucketed column is included in the schema columns of the Hive table.</li><li><p>We cannot use the <code>LOAD DATA</code> statement to load the data into the bucketed table as we do in partitioned table. Rather, we have to use the <code>INSERT</code> statements to insert data by selecting data from some other table.</p><h1 id="Hive-Data-Definition-Language-DDL"><a href="#Hive-Data-Definition-Language-DDL" class="headerlink" title="Hive Data Definition Language(DDL)"></a>Hive Data Definition Language(DDL)</h1><h2 id="Creating-tables"><a href="#Creating-tables" class="headerlink" title="Creating tables"></a>Creating tables</h2></li><li><p>The <code>LIKE</code> clause in a create table command creates a copy of an existing table with a different name and without the data. It just creates a structure like that of an existing table without copying its data.</p></li><li><p>Parameters:</p><ul><li>[TEMPORARY]</li><li>[EXTERNAL]</li><li>[IF NOT EXISTS]</li><li>[PARTITIONED BY]</li><li>[CLUSTERED BY]</li><li>[SKEWED BY]: è§£å†³æ•°æ®å€¾æ–œé—®é¢˜ï¼Œè¾ƒå¤šçš„å€¼è¢«åˆ†éš”æˆå¤šä¸ªæ–‡ä»¶ï¼Œå…¶ä½™çš„å€¼åˆ†åˆ°å…¶ä»–æ–‡ä»¶ä¸­ã€‚</li><li>â€¦</li></ul><h2 id="Creating-views"><a href="#Creating-views" class="headerlink" title="Creating views"></a>Creating views</h2><blockquote><p>A <code>view</code> is a virtual table that acts as a window to the dat for the underlying table commonly known as the <code>base</code> table. It consists of rows and columns but no physical data. So when a <code>view</code> is accessed, the underlying <code>base</code> table is queried for the output.</p></blockquote></li></ul></li></ul><h2 id="HCatalog"><a href="#HCatalog" class="headerlink" title="HCatalog"></a>HCatalog</h2><blockquote><p><code>HCatalog</code> is a storage management tool that enables framworks other than Hive to leverage a data model to read and write data. HCatalog tables provide an abstraction on the data format in HDFS and allow frameworks such as <code>PIG</code> and <code>MapReduce</code> to use the data without being concerned about the data format, such as <code>RC</code>, <code>ORC</code>, and text files.</p></blockquote><ul><li><code>HCatInputFormat</code> and <code>HCatOutputFormat</code>, which are the implementations of Hadoop <code>InputFormat</code> and <code>OutputFormat</code>, are the interfaces provided to <code>PIG</code> and <code>MapReduce</code>.</li></ul><h2 id="WebHCat"><a href="#WebHCat" class="headerlink" title="WebHCat"></a>WebHCat</h2><blockquote><p>WebHCat, formerly called Templeton, allow access to the HCatalog service using REST APIs.</p></blockquote><h1 id="Hive-Data-Manipulation-Language-DML"><a href="#Hive-Data-Manipulation-Language-DML" class="headerlink" title="Hive Data Manipulation Language(DML)"></a>Hive Data Manipulation Language(DML)</h1><h1 id="Hive-Extensibility-Features"><a href="#Hive-Extensibility-Features" class="headerlink" title="Hive Extensibility Features"></a>Hive Extensibility Features</h1><h2 id="Serialization-and-deserialization-formats-and-data-types"><a href="#Serialization-and-deserialization-formats-and-data-types" class="headerlink" title="Serialization and deserialization formats and data types"></a>Serialization and deserialization formats and data types</h2><ul><li>LazySimpleSerDe, the default SerDes format of Hive.</li><li>RegexSerDe</li><li>AvroSerDe</li><li>OrcSerDe</li><li>ParquetHiveSerDe</li><li>JSONSerDe</li><li>CSVSerDe</li></ul><h2 id="Exploring-views"><a href="#Exploring-views" class="headerlink" title="Exploring views"></a>Exploring views</h2><ul><li>A view is treated as a table in Hive</li></ul><h2 id="Exploring-indexes"><a href="#Exploring-indexes" class="headerlink" title="Exploring indexes"></a>Exploring indexes</h2><ul><li>Indexes are useful for increasing the performance of frequent queries based on certain columns.</li></ul><h2 id="Hive-partitioning"><a href="#Hive-partitioning" class="headerlink" title="Hive partitioning"></a>Hive partitioning</h2><ul><li>Static partitioning</li><li>Dynamic partitioning</li></ul><h2 id="Creating-buckets-in-Hive"><a href="#Creating-buckets-in-Hive" class="headerlink" title="Creating buckets in Hive"></a>Creating buckets in Hive</h2><pre><code>CREATE table sales_buck (id int, fname string, ...) clustered by (id) into 50 buckets row format delimited fieldsterminated by &apos;\t&apos;;set hive.enforce.bucketing=true;insert into table sales_buck select * from sales;</code></pre><h2 id="Analytics-functions-in-Hive"><a href="#Analytics-functions-in-Hive" class="headerlink" title="Analytics functions in Hive"></a>Analytics functions in Hive</h2><p><em>see page 122</em></p><ul><li><p>RANK</p><blockquote><p>It is similar to ROW_NUMBER, but the equal rows are ranked with the same number.</p></blockquote></li><li><p>DENSE_RANK</p><blockquote><p>In a normal RANK function, we see a gap between the numbers in rows. DENSE_RANK is a function with no gap.</p></blockquote></li><li><p>ROW_NUMBER</p><blockquote><p>This function will provide a unique number to each row in resultset based on the ORDER BY clause within the PARTITION.</p></blockquote></li><li><p>PERCENT_RANK</p><blockquote><p>It is very similar to the CUME_DIST function. It returns a value from 0 to 1 inclusive.</p></blockquote></li><li><p>CUME_DIST(Cumulative distribution)</p><blockquote><p>It computes the relative postion of a column value in a group.</p></blockquote></li><li><p>NTILE</p><blockquote><p>NTILE distributes the number of rows in a partition into a certain number of groups.</p></blockquote></li></ul><h2 id="Windowing-in-Hive"><a href="#Windowing-in-Hive" class="headerlink" title="Windowing in Hive"></a>Windowing in Hive</h2><p><em>see page 126</em></p><blockquote><p>Windowing in Hive allows an analyst to creagte a window of data to operate aggregation and other analytical functions, such as LEAD and LAG.</p></blockquote><ul><li><p>Partition specification</p><p>  It includes a column reference from the table. It could not be any aggregation or other window specification.</p></li><li><p>Order specification</p><p>  It comprises a combination of one or more columns.</p><ul><li><p>Handling NULLs</p><p>  There is no support for Nulls first or last specification. In Hive, Nulls are returned first.</p></li></ul></li><li><p>Window frame</p><p>  A frame has a start boundary and an optional end boundary:</p><ul><li>Frame Type<ul><li>ROW</li><li>RANGE</li></ul></li></ul></li><li>Frame boundary</li><li>Effective window frames</li><li>Source name for window definition</li><li><p>LEAD</p><blockquote><p>The LEAD function is used to return the data from the next set of rows.</p></blockquote></li><li><p>LAG</p><blockquote><p>The LAG function is used to return the data from the previous set of rows.</p></blockquote></li><li><p>FIRST_VALUE</p></li><li>LAST_VALUE</li></ul><h2 id="File-formats"><a href="#File-formats" class="headerlink" title="File formats"></a>File formats</h2><ul><li>TEXTFILE, default format</li><li><p>SEQUENCEFILE</p><p>  If you want to save disk storage while keeping large datasets</p></li><li><p>RCFILE</p><p>  Also known as <strong>Record Columnar File</strong>, stores data in a compressed format on the disk. It provides the following features of storage and processing optimization:</p><ul><li>Fast storage of data</li><li>Optimized storage utilization</li><li><p>Better query processing</p><p>The RCFILE format flattens the data in terms of both rows and columns. If you need a certain column for analytics, it would not scan the complete data; instead, it would return the required columns.</p></li></ul></li><li><p>ORC</p><p>  <strong>Optimized Row Columnar</strong></p><p>  This is a highly efficient way of storing and processing data in Hive. Data stored in the ORC format improves performance in reading, writing, and processing data with Hive.</p></li><li><p>PARQUET</p><p>  This is a column-oriented storage format that is efficient at querying particular columns in the table.</p></li><li><p>AVRO</p></li></ul><h1 id="Joins-and-Join-Optimization"><a href="#Joins-and-Join-Optimization" class="headerlink" title="Joins and Join Optimization"></a>Joins and Join Optimization</h1><h2 id="Using-a-skew-join"><a href="#Using-a-skew-join" class="headerlink" title="Using a skew join"></a>Using a skew join</h2><p>A skew join is used when there is a table with skew data in the joining column. A skew table is a table that is having values that are present in large numbers in the table compared to other data. Skew data is stored in a separate file while the rest of the data is stored in a separate file. </p><p>If there is a need to perform a join on a column of a table that is appearing quite often in the table, the data for that particular column will go to a single reducer, which will become a bottleneck while performing the join. To reduce this, a skew join is used.</p><h1 id="Statics-in-Hive"><a href="#Statics-in-Hive" class="headerlink" title="Statics in Hive"></a>Statics in Hive</h1><h2 id="Analyze"><a href="#Analyze" class="headerlink" title="Analyze"></a>Analyze</h2><pre><code>ANALYZE TABLE sales COMPUTE STATISTICS;</code></pre><h1 id="Functions-in-Hive"><a href="#Functions-in-Hive" class="headerlink" title="Functions in Hive"></a>Functions in Hive</h1><h1 id="Hive-Tuning"><a href="#Hive-Tuning" class="headerlink" title="Hive Tuning"></a>Hive Tuning</h1><h2 id="Enabling-predicate-pushdown-optimiztions-in-Hive"><a href="#Enabling-predicate-pushdown-optimiztions-in-Hive" class="headerlink" title="Enabling predicate pushdown optimiztions in Hive"></a>Enabling predicate pushdown optimiztions in Hive</h2><p>Predicate pushdown is a traditional RDBMS term, whereas in Hive, it works as predicate pushup.</p><p><code>hvie.optimize.ppd=true;</code></p><h2 id="Optimizations-to-reduce-the-number-of-map"><a href="#Optimizations-to-reduce-the-number-of-map" class="headerlink" title="Optimizations to reduce the number of map"></a>Optimizations to reduce the number of map</h2><h2 id="Sampling"><a href="#Sampling" class="headerlink" title="Sampling"></a>Sampling</h2><blockquote><p>Sampling in Hive is a way to wirte queries on a small chunk of data instead of the entire table.</p></blockquote><h1 id="Hive-Security"><a href="#Hive-Security" class="headerlink" title="Hive Security"></a>Hive Security</h1><h1 id="Hive-Integration-with-Other-Frameworks"><a href="#Hive-Integration-with-Other-Frameworks" class="headerlink" title="Hive Integration with Other Frameworks"></a>Hive Integration with Other Frameworks</h1><h2 id="Working-with-Apache-Spark"><a href="#Working-with-Apache-Spark" class="headerlink" title="Working with Apache Spark"></a>Working with Apache Spark</h2><h2 id="Working-with-Accumulo"><a href="#Working-with-Accumulo" class="headerlink" title="Working with Accumulo"></a>Working with Accumulo</h2><h2 id="Working-with-HBase-Google-Drill"><a href="#Working-with-HBase-Google-Drill" class="headerlink" title="Working with HBase (Google Drill)"></a>Working with HBase (Google Drill)</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ‰ SQL åŸºç¡€çš„è¯ï¼Œå·®ä¸å¤šä¸€å¤©å¯ä»¥çœ‹å®Œã€‚&lt;br&gt;è¿™é‡ŒæŠŠæˆ‘çœ‹è¿™æœ¬ä¹¦åšçš„ç¬”è®°åˆ†äº«ä¸€ä¸‹ï¼ˆä» &lt;a href=&quot;https://www.notion.so/?r=507f808e5cb544809dfe98d930ee2cae&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Notion&lt;/a&gt; é‡Œè¿ç§»å‡ºæ¥ï¼‰&lt;/p&gt;
    
    </summary>
    
      <category term="Hive" scheme="http://jiezhi.github.io/categories/Hive/"/>
    
    
      <category term="Note" scheme="http://jiezhi.github.io/tags/Note/"/>
    
      <category term="Hive" scheme="http://jiezhi.github.io/tags/Hive/"/>
    
      <category term="Big Data" scheme="http://jiezhi.github.io/tags/Big-Data/"/>
    
  </entry>
  
  <entry>
    <title>GraphQLç®€ä»‹</title>
    <link href="http://jiezhi.github.io/2018/06/10/graphql/"/>
    <id>http://jiezhi.github.io/2018/06/10/graphql/</id>
    <published>2018-06-10T07:02:51.000Z</published>
    <updated>2019-03-08T09:40:44.801Z</updated>
    
    <content type="html"><![CDATA[<p>GraphQLä¼šæ˜¯å–ä»£REST APIçš„ä¸‹ä¸€ä»£æ ‡å‡†ä¹ˆï¼Ÿ</p><a id="more"></a><h1 id="ä»€ä¹ˆæ˜¯GraphQL"><a href="#ä»€ä¹ˆæ˜¯GraphQL" class="headerlink" title="ä»€ä¹ˆæ˜¯GraphQL"></a>ä»€ä¹ˆæ˜¯GraphQL</h1><p><img src="http://qn-cdn.nospider.net/2018-06-10-graphql.png" alt="graphql"></p><blockquote><p>GraphQLæ˜¯æ¯”RESTæ›´é«˜æ•ˆã€å¼ºå¤§å’Œçµæ´»çš„æ–°ä¸€ä»£APIæ ‡å‡†ã€‚Facebookå¼€å‘äº†GraphQLå¹¶ä¸”å°†å…¶å¼€æºï¼Œç›®å‰å…¶ç”±ä¸€å¤§ç¾¤æ¥è‡ªå…¨çƒå„åœ°çš„å…¬å¸å’Œä¸ªäººç»´æŠ¤ã€‚</p></blockquote><p>æ³¨æ„åˆ°GraphQLæ˜¯APIæ ‡å‡†ï¼Œä¸è¦çœ‹åˆ°QLç»“å°¾å°±ä»¥ä¸ºå…¶æ˜¯ä¸€ç§æ•°æ®åº“æŠ€æœ¯ã€‚</p><h2 id="æ¯”RESTæ›´çµæ´»çš„ä¸€ç§é€‰æ‹©"><a href="#æ¯”RESTæ›´çµæ´»çš„ä¸€ç§é€‰æ‹©" class="headerlink" title="æ¯”RESTæ›´çµæ´»çš„ä¸€ç§é€‰æ‹©"></a>æ¯”RESTæ›´çµæ´»çš„ä¸€ç§é€‰æ‹©</h2><p>RESTæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¸€ç§æš´éœ²æœåŠ¡ç«¯æ•°æ®çš„å¸¸è§æ–¹å¼ï¼Œå…¶ç®€åŒ–äº†å®¢æˆ·ç«¯å°¤å…¶æ˜¯ç§»åŠ¨ç«¯å’ŒæœåŠ¡å™¨äº¤äº’çš„æµç¨‹ã€‚ä½†æ˜¯éšç€ä¸šåŠ¡å˜å¾—å¤æ‚ï¼Œæœ‰äº›æƒ…å†µå˜å¾—æ£˜æ‰‹ï¼š</p><ol><li><p>ç§»åŠ¨ç«¯æ•°é‡çš„å¢å¤šï¼Œå¯¹æ•°æ®çš„æ•ˆç‡è¦æ±‚å˜é«˜<br>ç§»åŠ¨ç«¯å’ŒPCç«¯ç›¸æ¯”ï¼Œæ˜¯éœ€è¦æé«˜å¯¹æ•°æ®è·å–çš„æ•ˆç‡çš„ï¼Œè¿™ä¸ªæ•ˆç‡å°±æ˜¯è¯´è¦å‡å°‘ç½‘ç»œè¯·æ±‚ã€è¦å‡å°‘æ— ç”¨æ•°æ®çš„ä¼ è¾“ã€‚</p></li><li><p>åº”å¯¹å¤æ‚çš„å‰ç«¯æ¡†æ¶å’Œå¹³å°<br>ç°åœ¨çš„æƒ…å†µæ˜¯ä»…ç»´æŠ¤ä¸€å¥—APIæ¥åº”å¯¹ä¸åŒæ¡†æ¶å’Œå¹³å°çš„è¯·æ±‚ã€‚PCç«¯ä¸€ä¸ªé¡µé¢æ¯”ç§»åŠ¨ç«¯ä¸€ä¸ªé¡µé¢å±•ç¤ºçš„å†…å®¹è¦å¤šå¾ˆå¤šï¼Œä¹‹å‰åç«¯æä¾›ç»™PCç«¯çš„APIå¦‚æœç›´æ¥æä¾›ç»™ç§»åŠ¨ç«¯æ¥ä½¿ç”¨åŠ¿å¿…é€ æˆèµ„æºæµªè´¹ã€‚æ‰€ä»¥ç§»åŠ¨ç«¯çš„äººä¼šå»æ‰¾åç«¯çš„äººå¹²ä¸€æ¶ï¼Œç»“æœè¦ä¹ˆæ˜¯åç«¯å†ç»™ç§»åŠ¨ç«¯å•ç‹¬å†™ä¸€å¥—APIï¼Œè¦ä¹ˆå°±æ˜¯ç§»åŠ¨ç«¯å¿å—ç€APIè¯·æ±‚è¿”å›æ•°æ®ä¸­å­˜åœ¨å¤§é‡å†—ä½™çš„æ•°æ®ã€‚</p></li><li><p>éœ€è¦æ›´å¿«é€Ÿåœ°è¿­ä»£æ›´æ–°<br>äº’è”ç½‘æ—¶ä»£æœ€å¤§çš„ç‰¹è‰²é™¤äº†åŠ ç­ä¹Ÿè®¸å°±æ˜¯å¿«äº†ã€‚å¥½å¤šå…¬å¸åœ¨å–Šç€å°æ­¥å¿«è·‘ã€å¿«é€Ÿè¯•é”™ï¼Œæ¯•ç«Ÿå¸‚åœºä¸ç­‰äººã€‚ç„¶è€ŒRESTæ ‡å‡†çš„APIä¼¼ä¹å¾ˆéš¾å¿«é€Ÿåœ°è·Ÿä¸Šè¿™å¿«è·‘çš„èŠ‚å¥ã€‚ä¹Ÿè®¸ä¸€ä¸ªAPIåˆšå‡ºæ¥ï¼Œäº§å“é‚£è¾¹å·²ç»æ”¹äº†åŸå‹ï¼Œç•Œé¢é‡æ–°è®¾è®¡äº†ã€‚è¿™æ—¶å€™å°±è¦éº»çƒ¦åç«¯åŒå­¦åŠ ä¸ªç­æŠŠæ¥å£æ”¹ä¸€ä¸‹å§ã€‚</p></li></ol><h2 id="è°åœ¨ç”¨GraphQL"><a href="#è°åœ¨ç”¨GraphQL" class="headerlink" title="è°åœ¨ç”¨GraphQL"></a>è°åœ¨ç”¨GraphQL</h2><p>ä¸€ä¸ªäº§å“çš„æµè¡Œï¼Œè‚¯å®šæ˜¯è§£å†³äº†ç›®å‰çš„æŸäº›ç—›ç‚¹ã€‚è™½ç„¶GraqhQLç›®å‰åœ¨å›½å†…è¿˜ä¸ç®—æµè¡Œï¼Œå¯æ˜¯åœ¨ç¾åˆ©åšå·²ç»æœ‰ä¸å°‘å·¨å¤´åœ¨ä½¿ç”¨äº†ï¼š</p><h2 id><a href="#" class="headerlink" title></a><img src="http://qn-cdn.nospider.net/2018-06-10-15286168671382.jpg" alt></h2><h1 id="GraphQL-vs-REST"><a href="#GraphQL-vs-REST" class="headerlink" title="GraphQL vs REST"></a>GraphQL vs REST</h1><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¯¹äºä¸åŒAPIæ ‡å‡†ä¸‹ï¼Œä»æœåŠ¡ç«¯è·å–æ•°æ®çš„åŒºåˆ«ã€‚æ¯”å¦‚åœ¨REST APIæ ‡å‡†ä¸‹ï¼Œæœ‰ä¸‰ä¸ªæ¥å£ï¼š</p><ul><li><p>/users/<id><br>è¯¥æ¥å£è¿”å›æŸç”¨æˆ·åŸºæœ¬ä¿¡æ¯</id></p></li><li><p>/users/<id>/posts<br>è¯¥æ¥å£è¿”å›æŸç”¨æˆ·æ‰€æœ‰çš„æ–‡ç« </id></p></li><li><p>/users/<id>/followers<br>è¯¥æ¥å£è¿”å›æŸç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨è€…</id></p></li></ul><p><img src="http://qn-cdn.nospider.net/2018-06-10-15286174419940.jpg" alt></p><p><em>å¦‚å›¾æ‰€ç¤ºï¼Œè¦é€šè¿‡ä¸‰ä¸ªä¸åŒçš„è¯·æ±‚æ‰èƒ½è·å¾—æŸç”¨æˆ·åŠå…¶æ–‡ç« å’Œå…³æ³¨è€…çš„ä¿¡æ¯ï¼Œå…¶ä¸­è¿˜å­˜åœ¨å¾ˆå¤šä¸éœ€è¦çš„ä¿¡æ¯ã€‚ </em></p><p>å†çœ‹ä¸€ä¸‹GraphQL APIçš„å®ç°ï¼š<br><img src="http://qn-cdn.nospider.net/2018-06-10-15286175800503.jpg" alt><br><em>å®¢æˆ·ç«¯å£°æ˜è‡ªå·±æƒ³è¦çš„ä¿¡æ¯ï¼Œç„¶åæœåŠ¡ç«¯æ ¹æ®è¯·æ±‚è¿”å›ç›¸åº”çš„æ•°æ®</em></p><p>ç›®å‰å¯è§çš„ä¼˜ç‚¹ï¼š</p><ol><li>é¿å…äº†REST APIä¸­å¸¸è§çš„ä¿¡æ¯è¿‡å¤šæˆ–è¿‡å°‘çš„é—®é¢˜<br>ä¿¡æ¯è¿‡å¤šæ˜¯æŒ‡ï¼Œæ¥å£ä¸­æ€»ä¼šå­˜åœ¨å®¢æˆ·ç«¯ä¸éœ€è¦çš„ä¿¡æ¯ï¼Œä¿¡æ¯è¿‡å°‘æ˜¯æŒ‡å•æ¡æ¥å£æ— æ³•æ»¡è¶³å®¢æˆ·ç«¯éœ€æ±‚ï¼Œéœ€è¦è¯·æ±‚å¤šä¸ªæ¥å£æ‰èƒ½æ»¡è¶³éœ€è¦</li><li><p>å‰ç«¯å¯ä»¥å¿«é€Ÿè¿­ä»£<br>åœ¨REST APIä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯åç«¯å®šä¹‰å¥½äº†APIï¼Œè¿”å›å›ºå®šçš„æ•°æ®æ ¼å¼ã€‚å½“å‰ç«¯ä¸šåŠ¡æˆ–éœ€æ±‚å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåç«¯å¾ˆéš¾è·Ÿä¸Šå˜åŠ¨çš„èŠ‚å¥ã€‚å¦‚ä»Šï¼Œä¸šåŠ¡å˜åŒ–å·²ç»éš¾ä»¥é¿å…ï¼Œæ‰€ä»¥å½“å‰ç«¯å’Œåç«¯éƒ½è¦ç›¸åº”åœ°ä½œå‡ºæ”¹åŠ¨ï¼Œè¿™æ ·æ•ˆç‡åŠ¿å¿…é™ä½ã€‚å°±æˆ‘ä»¬å…¬å¸ä¸šåŠ¡æ¥è®²ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œå‰ç«¯ä¸€ä¸¤å¤©çš„æ”¹åŠ¨å¦‚æœå†æ‹‰ä¸Šåç«¯ï¼Œäººå¤šè‚¯å®šè¦å¼€ä¼šå†åŠ ä¸Šæ²Ÿé€šæˆæœ¬çš„é—®é¢˜ï¼Œè¿™ä¸ªéœ€æ±‚æ²¡ä¸ªä¸€å‘¨ä¸¤å‘¨å¾ˆéš¾æå®šã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåœ¨GraphQLæ ‡å‡†ä¸‹ï¼Œé™¤éå¤§çš„æ”¹ç‰ˆï¼Œåç«¯åŸºæœ¬ä¸ç”¨å‡ºäººåŠ›æ¥è·Ÿç€ä¸€èµ·éœ€æ±‚è¯„å®¡ï¼Œå‰ç«¯è‡ªå·±å®šä¹‰æŸ¥è¯¢çš„å†…å®¹å°±æå®šäº†ã€‚</p></li><li><p>æ›´æ·±å±‚æ¬¡åœ°è¿›è¡Œåˆ†æ<br>å½“å®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©è‡ªå·±æƒ³è¯·æ±‚æ•°æ®çš„å†…å®¹æ—¶ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åˆ†æå‡ºå“ªäº›ä¿¡æ¯æ˜¯ç”¨æˆ·æ„Ÿå…´è¶£çš„ï¼Œä¹Ÿå¯ä»¥æ›´æ·±å±‚æ¬¡åœ°åˆ†æç°æœ‰æ•°æ®æ˜¯å¦‚ä½•è¢«åº”ç”¨çš„ã€‚<br>æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥åˆ†æå‡ºå“ªäº›ä¿¡æ¯ç”¨æˆ·ä¸å†æ„Ÿå…´è¶£äº†ã€‚</p></li><li><p>Schema &amp; Typeç³»ç»Ÿçš„ä¼˜ç‚¹<br>GraphQLä½¿ç”¨ä¸€ç§å¼ºç±»å‹ç³»ç»Ÿæ¥å®šä¹‰APIï¼Œæ‰€æœ‰çš„APIéƒ½é€šè¿‡GraphQLæ¨¡å¼å®šä¹‰è¯­è¨€ï¼ˆSchema Definition Languageï¼ŒSDLï¼‰æ¥æš´éœ²ç±»å‹æ•°æ®ã€‚è€Œè¿™ä¸ªæ¨¡å¼å°±æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„åè®®ï¼Œé€šè¿‡æ­¤æ¨¡å¼æˆ‘ä»¬å¯ä»¥çŸ¥é“æœåŠ¡ç«¯å¯ä»¥æä¾›å“ªäº›æ•°æ®ï¼Œè€Œå®¢æˆ·ç«¯åˆå¯ä»¥è·å–å“ªäº›æ•°æ®ã€‚</p></li></ol><p>ä¸€æ—¦æ¨¡å¼å®šä¹‰å¥½äº†ï¼Œå‰åç«¯å°±å¯ä»¥æ®æ­¤ç‹¬ç«‹è¿›è¡Œå¼€å‘äº†ã€‚</p><h1 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h1><h2 id="æ¨¡å¼å®šä¹‰è¯­è¨€ï¼ˆThe-Schema-Definition-Languageï¼ŒSDLï¼‰"><a href="#æ¨¡å¼å®šä¹‰è¯­è¨€ï¼ˆThe-Schema-Definition-Languageï¼ŒSDLï¼‰" class="headerlink" title="æ¨¡å¼å®šä¹‰è¯­è¨€ï¼ˆThe Schema Definition Languageï¼ŒSDLï¼‰"></a>æ¨¡å¼å®šä¹‰è¯­è¨€ï¼ˆThe Schema Definition Languageï¼ŒSDLï¼‰</h2><p>æ¯”å¦‚è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª<code>Person</code>ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type Person &#123;</span><br><span class="line">  name: String!</span><br><span class="line">  age: Int!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Personç±»å‹åˆä¸¤ä¸ªå­—æ®µï¼Œ<code>name</code>å’Œ<code>age</code>ï¼Œåˆ†åˆ«ä¸º<code>String</code>å’Œ<code>Int</code>ç±»å‹ã€‚<code>!</code>è¡¨ç¤ºè¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚</p><p>åŒæ—¶ï¼Œä¸¤ç§ç±»å‹ä¹‹é—´å¯ä»¥æœ‰å…³è”ï¼Œæ¯”å¦‚<code>Person</code>å¯ä»¥å’Œ<code>Post</code>å…³è”ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type Post &#123;</span><br><span class="line">title: String!</span><br><span class="line">author: Person!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸åº”çš„ï¼Œ<code>Person</code>ä¸­ä¹Ÿå¯ä»¥å…³è”<code>Post</code>ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type Person &#123;</span><br><span class="line">name: String!</span><br><span class="line">age: Int!</span><br><span class="line">posts: [Post!]!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>Person</code>å’Œ<code>Post</code>æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»</p><h2 id="é€šè¿‡Queriesè·å–æ•°æ®"><a href="#é€šè¿‡Queriesè·å–æ•°æ®" class="headerlink" title="é€šè¿‡Queriesè·å–æ•°æ®"></a>é€šè¿‡Queriesè·å–æ•°æ®</h2><p>åœ¨è¯·æ±‚æ•°æ®ä¹‹å‰ï¼Œä½ éœ€è¦GraphQL-IDEæ¥æ¨¡æ‹Ÿä¸‹é¢çš„è¯·æ±‚ï¼Œæœ‰<a href="https://api.graph.cool/simple/v1/cjhvs1vtt4ahm012322aexl4n/?query=%7B%0A%20%20allPersons%20%7B%0A%20%20%20%20name%0A%20%20%7D%0A%7D" target="_blank" rel="noopener">Webç‰ˆ</a> ä¹Ÿæœ‰<br><a href="https://github.com/graphcool/graphql-playground" target="_blank" rel="noopener">å®¢æˆ·ç«¯</a> </p><p>å¦‚æœä½ é€‰æ‹©äº†å®¢æˆ·ç«¯ï¼Œåœ¨å¯åŠ¨é¡µé¢æ‰“å¼€è¿™ä¸ªåœ°å€ï¼š <a href="https://api.graph.cool/simple/v1/cjhvs1vtt4ahm012322aexl4n/" target="_blank" rel="noopener">https://api.graph.cool/simple/v1/cjhvs1vtt4ahm012322aexl4n/</a></p><p><img src="http://qn-cdn.nospider.net/2018-06-10-15286229140756.jpg" alt></p><p>è®©æˆ‘ä»¬æ¥ä¸€ä¸ªæœ€ç®€å•çš„è¯·æ±‚ï¼š</p><p><img src="http://qn-cdn.nospider.net/2018-06-10-15286230297031.jpg" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  allPersons &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;allPersons&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Johnny&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Sarah&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Alice&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Bob&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Alice&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨ç»“æœé‡Œå¸¦ä¸Šageçš„è¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  allPersons &#123;</span><br><span class="line">    name</span><br><span class="line">    age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://qn-cdn.nospider.net/2018-06-10-15286232389082.jpg" alt></p><h3 id="å¸¦å‚è¯·æ±‚"><a href="#å¸¦å‚è¯·æ±‚" class="headerlink" title="å¸¦å‚è¯·æ±‚"></a>å¸¦å‚è¯·æ±‚</h3><p>åŒæ ·æ²¡é—®é¢˜ï¼Œå¯ä»¥çœ‹åˆ°åªè¿”å›äº†æœ€åä¸¤æ¡æ•°æ®ï¼š<br><img src="http://qn-cdn.nospider.net/2018-06-10-15286233483934.jpg" alt></p><h2 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h2><p>è¿™é‡Œè¯´çš„ä¿®æ”¹åŒ…å«ä¸‰ç§æ“ä½œï¼š</p><ul><li>åˆ›å»ºæ•°æ®</li><li>æ›´æ–°æ•°æ®</li><li>åˆ é™¤æ•°æ®</li></ul><p>è¿™é‡Œä»¥åˆ›å»ºæ•°æ®ä¸ºä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">  createPerson(name: &quot;Bob&quot;, age: 36) &#123;</span><br><span class="line">    name</span><br><span class="line">    age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://qn-cdn.nospider.net/2018-06-10-15286234981761.jpg" alt></p><h2 id="è®¢é˜…å®æ—¶æ›´æ–°"><a href="#è®¢é˜…å®æ—¶æ›´æ–°" class="headerlink" title="è®¢é˜…å®æ—¶æ›´æ–°"></a>è®¢é˜…å®æ—¶æ›´æ–°</h2><p>GraphQLæä¾›äº†<code>subscriptions</code>çš„æ¦‚å¿µæ¥æä¾›ç»™å®¢æˆ·ç«¯è®¢é˜…äº‹ä»¶ã€‚å½“å®¢æˆ·ç«¯è®¢é˜…æŸäº‹ä»¶åï¼Œå…¶å°†ä¼šå’ŒæœåŠ¡ç«¯ä¿æŒä¸€ä¸ªç¨³å®šçš„é“¾æ¥ã€‚å½“ç‰¹å®šäº‹ä»¶è§¦å‘æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šæ¨é€å¯¹åº”çš„æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è®¢é˜…æ–°å»º<code>Person</code>ç±»å‹äº‹ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">subscription &#123;</span><br><span class="line">  newPerson &#123;</span><br><span class="line">    name</span><br><span class="line">    age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æœ‰æ–°çš„Personç±»å‹è¢«åˆ›å»ºæ—¶ï¼Œå®¢æˆ·ç«¯å°±èƒ½æ¥æ”¶åˆ°æ›´æ–°çš„æ•°æ®äº†ã€‚</p><h2 id="å®šä¹‰æ¨¡å¼"><a href="#å®šä¹‰æ¨¡å¼" class="headerlink" title="å®šä¹‰æ¨¡å¼"></a>å®šä¹‰æ¨¡å¼</h2><p>æ¨¡å¼æ˜¯GraphQL APIä¸­æœ€é‡è¦æ¦‚å¿µä¹‹ä¸€ï¼Œå…¶å®šä¹‰äº†APIèƒ½æä¾›å“ªäº›æ•°æ®ï¼Œä»¥åŠå®¢æˆ·ç«¯å¦‚ä½•è·å–è¿™äº›æ•°æ®ã€‚</p><p>æœ‰å‡ ä¸ªç‰¹æ®Šçš„ç±»å‹è¢«ç§°ä¹‹ä¸º<code>root</code>ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123; ... &#125;</span><br><span class="line">type Mutation &#123; ... &#125;</span><br><span class="line">type Subscription &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ–‡ä¸­ç”¨åˆ°çš„å®Œæ•´æ¨¡å¼å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">  allPersons(last: Int): [Person!]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Mutation &#123;</span><br><span class="line">  createPerson(name: String!, age: Int!): Person!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Subscription &#123;</span><br><span class="line">  newPerson: Person!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Person &#123;</span><br><span class="line">  name: String!</span><br><span class="line">  age: Int!</span><br><span class="line">  posts: [Post!]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Post &#123;</span><br><span class="line">  title: String!</span><br><span class="line">  author: Person!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>è‡³æ­¤ï¼Œå¤§å®¶åº”è¯¥å¯¹GraphQLæœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†äº†å§ã€‚å¦‚æœä¸æƒ³ä»…åœç•™åœ¨æ¦‚å¿µå±‚é¢ï¼Œä½ å¯ä»¥åˆ°<a href="https://graphql.org/code/gg" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°ç›®å‰å·²ç»å®ç°çš„æ¡†æ¶ã€‚ï¼ˆåæ­£æˆ‘å·²ç»ç”¨èµ·æ¥äº†:Pï¼‰<br><img src="http://qn-cdn.nospider.net/2018-06-10-15286245421358.jpg" alt></p><p>æ›´å¤šå†…å®¹å¯è®¿é—®ä»¥ä¸‹ç½‘ç«™ï¼š</p><p><a href="https://www.graphql.org/" target="_blank" rel="noopener">https://www.graphql.org/</a><br><a href="https://www.howtographql.com/" target="_blank" rel="noopener">https://www.howtographql.com/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;GraphQLä¼šæ˜¯å–ä»£REST APIçš„ä¸‹ä¸€ä»£æ ‡å‡†ä¹ˆï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="GraphQL" scheme="http://jiezhi.github.io/categories/GraphQL/"/>
    
    
      <category term="Translate" scheme="http://jiezhi.github.io/tags/Translate/"/>
    
      <category term="GraphQL" scheme="http://jiezhi.github.io/tags/GraphQL/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘ä¸é˜…è¯»</title>
    <link href="http://jiezhi.github.io/2018/03/25/book-app/"/>
    <id>http://jiezhi.github.io/2018/03/25/book-app/</id>
    <published>2018-03-25T14:03:38.000Z</published>
    <updated>2019-02-19T08:37:22.846Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹è‡ªå·±è¯»ä¹¦å†ç¨‹ï¼Œå¹¶æ¨èä¸€ä¸‹è‡ªå·±ç”¨å¾—æ¯”è¾ƒå¤šçš„é˜…è¯»ç›¸å…³çš„APPã€‚</p><a id="more"></a><p>ä»å°åˆ°å¤§å°±è‡ªè¯©è‡ªå·±æ˜¯ä¸ªå–œæ¬¢é˜…è¯»çš„äººï¼Œä¸€æ–¹é¢å¯èƒ½æ˜¯æˆ‘ä»¬å®¶æ—åœ¨æ‘å­é‡Œç®—æ˜¯æœ‰æ–‡åŒ–çš„äººå§ï¼Œé—ä¼ äº†ä¸€ç‚¹ï¼ˆå¬è¯´æˆ‘çˆ·çˆ·çš„çˆ·çˆ·æ˜¯ç§å¡¾è€å¸ˆï¼Œç°åœ¨å¤§å®¶å­é‡Œå½“è€å¸ˆçš„ä¹ŸæŒºå¤šçš„ï¼‰ï¼Œå¦ä¸€æ–¹é¢å¯èƒ½å› ä¸ºå°æ—¶å€™åå†…å‘ï¼Œæ‰€ä»¥è¾ƒå¤šçš„æ—¶å€™éƒ½æ˜¯ä¸ªå®‰é™çš„ç”·å­©å­ï¼Œå°±å–œæ¬¢ç¿»ç¿»ä¹¦ä»€ä¹ˆçš„ã€‚</p><p>è®°å¾—å°å­¦çš„æ—¶å€™å°±å–œæ¬¢æ‰¾é‚£äº›åˆä¸­ç”Ÿçš„é‚£äº›é˜…è¯»è¯¾æœ¬çœ‹ï¼Œå®åœ¨æ²¡å¾—çœ‹å°±ç¿»æˆè¯­è¯å…¸æˆ–æ–°åå­—å…¸äº†ã€‚åˆ°äº†ä¸­å­¦ï¼Œå› ä¸ºé•‡ä¸Šæ²¡æœ‰ä¹¦åº—ï¼Œå°±ç»å¸¸åå…¬äº¤å»å¿åŸä¹°ä¹¦çœ‹ã€‚é‚£æ—¶å€™å…¬äº¤è½¦å•ç¨‹è¦3å—é’±ï¼Œå¯¹äºä¸€å‘¨ä¹Ÿæ‰å‡ å—é’±é›¶èŠ±é’±çš„æˆ‘å‹åŠ›å®åœ¨ä¸å°ï¼Œç„¶åå°±ä¼šé¡ºè·¯å¸®åŒå­¦ä»¬ä¹°ç‚¹èµ„æ–™ä»€ä¹ˆçš„ï¼Œé¡ºä¾¿æŠŠè·¯è´¹ç»™å¹³æ‘Šäº†ã€‚é‚£æ—¶å€™æœ‰ä¸ªã€é¾™é—¨ä¹¦å±€ã€çš„å‡ºç‰ˆç¤¾ï¼Œæ„Ÿè§‰æŒºé…·çš„ï¼Œå°±ç»™è‡ªå·±èµ·äº†ä¸ªã€æ˜Ÿæ˜Ÿä¹¦å±€ã€ï¼Œå¹¶ç”¨æ©¡çš®åˆ»äº†ç« ï¼Œç„¶åå°åœ¨äº†æ¯ä¸€æœ¬ä¹¦ä¸Šã€‚</p><p>é«˜ä¸­è¿›äº†å¿åŸå»äº†ï¼Œé«˜ä¸€æ—¶è¯­æ–‡è€å¸ˆç»™æˆ‘ä»¬è§£é‡Šäº†ä»€ä¹ˆæ˜¯ã€è¯­æ–‡ã€ï¼š</p><blockquote><p>è¯­ä¸ºå¿ƒå£°ï¼Œæ–‡ä»¥è½½é“</p></blockquote><p>æ­£å¥½é‚£æ—¶å€™å­¦æ ¡ç»™æ¯ä¸ªå¹´çº§é…å¤‡äº†é˜…è§ˆå®¤ï¼Œé‡Œé¢æœ‰ä¸å°‘çš„æ‚å¿—å’Œæ–‡å­¦ä¹¦ç±å¯ä»¥åœ¨é‡Œé¢çœ‹ã€‚é‚£æ—¶å€™æˆ‘ä¸‹è¯¾å°±ä¼šè·‘è¿‡å»ï¼Œé˜…è§ˆå®¤çš„è€å¸ˆå¯¹æˆ‘è¿™ä¸ªä¸ºæ•°ä¸å¤šçš„è¯»è€…å°è±¡å¾ˆå¥½ï¼Œå°±ç‰¹æ‰¹æˆ‘å¯ä»¥æŠŠä¹¦å¸¦å›å»çœ‹ï¼Œæ—¶é—´é•¿äº†ç”šè‡³è®©æˆ‘å¸®å¥¹çœ‹ç€é˜…è§ˆå®¤ã€‚è¿™ç§æœ‰ç‰¹æƒçš„æ„Ÿè§‰è®©æˆ‘è¿™ä¸ªå¤§ç”·å­©æœ‰ç‚¹å°éª„å‚²ï¼Œæ‰€ä»¥æ›´æ˜¯ç»å¸¸è·‘å»å€Ÿä¹¦çœ‹äº†ã€‚ç”±äºæ–°æ ¡åŒºæ‰å»ºç«‹ä¸ä¹…ï¼Œæ‰€ä»¥æ²¡æœ‰å›¾ä¹¦é¦†ã€‚é‚£æ—¶å€™æœ€å¤§çš„æ„¿æœ›å°±æ˜¯èƒ½å¤©å¤©æ³¡å›¾ä¹¦é¦†ï¼Œå¬è¯´å¤§å­¦é‡Œå›¾ä¹¦é¦†ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒæœŸå¾…ä¸Šå¤§å­¦çš„ã€‚</p><p>å—¯ï¼Œä¸Šäº†å¤§å­¦ï¼Œè¿˜æ²¡æ‹¿åˆ°å­¦ç”Ÿå¡å°±å¼€å§‹å¾€å›¾ä¹¦é¦†è·‘äº†ï¼Œæƒ³ç€å¤§å­¦4å¹´ä¸€å®šè¦çœ‹å¤šå°‘å¤šå°‘çš„ä¹¦æ¥ç€ã€‚å¤©æœ‰ä¸æµ‹é£äº‘ï¼Œè°èƒ½æƒ³åˆ°ï¼Œæˆ‘çœ‹çš„ä¹¦åŸºæœ¬éƒ½æ˜¯è®¡ç®—æœºç±»çš„ä¹¦äº†ã€‚ç”±äºå­¦æ ¡æ˜¯åŒ»è¯ç±»å­¦æ ¡ï¼Œè™½ç„¶æœ‰ä¿¡æ¯å­¦é™¢ï¼Œä½†å¯ä»¥è‚¯å®šçš„æ˜¯ï¼ŒçœŸæ­£å¯¹è®¡ç®—æœºæ„Ÿå…´è¶£çš„å®åœ¨ä¸å¤šã€‚æ‰€ä»¥æ®æˆ‘ä¸å®Œå…¨è§‚å¯Ÿï¼ŒTPç±»ä¹¦æ¶å¤§éƒ¨åˆ†æ—¶é—´åªæœ‰æˆ‘ä¸€ä¸ªäººåœ¨é‚£é‡Œçœ‹ä¹¦ã€‚å¶å°”æœ‰å‡ ä¸ªå¦¹å­èµ°é‚£é‡Œåœç•™ï¼Œä¸ç”¨æƒ³æ˜¯åœ¨æ‰¾è®¡ç®—æœºç­‰çº§è€ƒè¯•çš„å‚è€ƒèµ„æ–™ã€‚å°±è¿™æ ·ï¼Œåœ¨æ¯•ä¸šçš„æ—¶å€™ï¼Œå­¦æ ¡ç¬¬ä¸€æ¬¡è¯„é€‰ä¹¦è™«å¥–ï¼Œå¿˜äº†è‡ªå·±è¯»äº†å¤šå°‘ä¹¦äº†ï¼Œåæ­£æ’åœ¨é‚£ä¸€å±Šç¬¬9åï¼Œå¹³å‡ä¸€å‘¨ä¸€æœ¬ä¹¦çš„è¿›åº¦å§ï¼ˆå…·ä½“æ•°æ®è¦ç­‰æˆ‘æ‰¾åˆ°å½“æ—¶çš„è¯ä¹¦å†ä¿®æ­£ï¼‰ã€‚</p><p>æ€»ä½“çœ‹æ¥ï¼Œå¯¹æˆ‘å½±å“æ¯”è¾ƒå¤§çš„è€å¸ˆåŸºæœ¬éƒ½æ˜¯è¯­æ–‡è€å¸ˆï¼Œå°å­¦æ—¶è¢«è¯­æ–‡è€å¸ˆå¤¸çŸ¥é“çš„æˆè¯­å¤šï¼Œç„¶åæˆ‘å°±ä½¿åŠ²å¾—ç¿»æˆè¯­è¯å…¸ï¼›åˆä¸­æ—¶è¢«è¯­æ–‡è€å¸ˆå¤¸è¯»çš„è¯¾å¤–ä¹¦å¤šï¼Œæˆ‘å°±ä½¿åŠ²åœ°æ‰¾è¯¾å¤–ä¹¦è¯»ï¼›é«˜ä¸­æ—¶è¢«è¯­æ–‡è€å¸ˆå¤¸â€¦æƒ³ä¸èµ·æ¥äº†ï¼Œä½†æ˜¯æˆ‘ä½¿åŠ²åœ°èƒŒå¤è¯—è¯äº†ï¼Œç„¶åä¹Ÿå†™äº†å‡ ç¯‡è¯—è¯ï¼Œä¹Ÿæ¨¡ä»¿è¿‡æ±ªæ›¾ç¥ºå…ˆç”Ÿå†™è¿‡å‡ ç¯‡æ–‡ç« ã€‚è‡³äºå¤§å­¦æ—¶å˜›ï¼Œç”±äºæ²¡æœ‰è¯­æ–‡è€å¸ˆï¼Œç„¶åæˆ‘å°±åŸºæœ¬ä¸Šæ³¡å›¾ä¹¦é¦†çœ‹è®¡ç®—æœºçš„ä¹¦äº†ã€‚</p><p>å¯¹äºç”¨APPçœ‹ä¹¦ï¼Œä¸€å¼€å§‹æˆ‘æ˜¯æ’æ–¥çš„ï¼Œè§‰å¾—æ²¡æœ‰çº¸è´¨ä¹¦æœ‰æ„Ÿè§‰ï¼Œä¹Ÿå°‘äº†åšé‡æ„Ÿã€‚é‚£æ—¶å€™è¢«äººæ¨èå…³æ³¨äº†å†¯å¤§è¾‰ï¼Œå¯èƒ½ç”±äºä»–ä¹Ÿæ˜¯åŒ»è¯ç±»ä¸“ä¸šç„¶åè½¬è¡ŒæITçš„åŸå› å§ã€‚ç„¶åç”¨ä¸Šäº†ä»–æ¨èäº†å½¼æ—¶è¿˜æ²¡è¢«å°ç±³æ”¶è´­çš„ã€<strong>å¤šçœ‹é˜…è¯»</strong>ã€ï¼Œåœ¨ç„¶åä¹°äº†äººç”Ÿä¸­ç¬¬ä¸€æœ¬ç”µå­ä¹¦<strong>ã€Šæµ·åº•æä½ å­¦ä¸ä¼šã€‹</strong>ï¼š<br><img src="http://qn-cdn.nospider.net/2018-03-25-15219897449337.jpg" alt><br>ç„¶åè¿™æ˜¯å½“å¹´çš„è¯„ä»·ï¼š<br><img src="http://qn-cdn.nospider.net/2018-03-25-15219898153947.jpg" alt><br>é‚£æ—¶å€™æ‰çŸ¥é“ç”µå­ä¹¦é™¤äº†txtè¿˜æœ‰epubæ ¼å¼çš„ï¼Œè¿˜å¯ä»¥æœ‰åƒçº¸è´¨ä¹¦ä¸€æ ·çš„æ’ç‰ˆï¼Œé‡Œé¢é™¤äº†æœ‰æ–‡å­—è¿˜å¯ä»¥æœ‰å›¾ç‰‡ç”šè‡³æ˜¯è§†é¢‘ã€‚æ­¤åå°±èµ°ä¸Šäº†ä¹°ç”µå­ä¹¦çš„ä¸å½’è·¯ã€‚</p><p>çœŸæ­£ä½“ä¼šåˆ°ç”µå­ä¹¦çš„å¥½å¤„ï¼Œå½“ç„¶è¿˜æ˜¯æ¯•ä¸šåæ¬å®¶äº†ï¼Œæœ‰è¿‡å‡ æ¬¡æ¬å®¶ï¼Œæ²¡å•¥å®¶å½“å›¾ä¹¦è¦å ä¸€å¤§åŠï¼Œå…³é”®æ˜¯çœ‹èµ·æ¥è¿˜ä¸æ–¹ä¾¿ã€‚åæ¥æˆ‘å°±é€¢äººå°±æ¨èçœ‹ç”µå­ä¹¦äº†ï¼Œå¼€å§‹å¤§éƒ¨åˆ†äººéƒ½å’Œæˆ‘å½“å¹´ä¸€æ ·è§‰å¾—çœ‹çº¸è´¨ä¹¦æœ‰æ„Ÿè§‰ï¼Œä¹Ÿä»¥ä¸ºç”µå­ä¹¦å°±æ˜¯txtï¼Œä¹Ÿéƒ½ä¸çŸ¥é“ç”µå­ä¹¦æ˜¯è¦ä¹°çš„ã€‚å½“ç„¶ç°åœ¨è¿˜æ˜¯æœ‰ä¸å°‘äººï¼Œå³ä½¿å·¥èµ„å·²ç»å¾ˆé«˜äº†ï¼Œè¯´åˆ°ç”µå­ä¹¦ç«‹é©¬å»æ‰¾ç›—ç‰ˆèµ„æºã€‚ã€‚ã€‚</p><p>åºŸè¯ä¸å¤šè¯´äº†ï¼Œåˆ—ä¸¾ä¸€äº›ç›®å‰æˆ‘åœ¨ç”¨çš„ä¸€äº›APPï¼š</p><ul><li><p><a href="http://www.duokan.com/" target="_blank" rel="noopener">å¤šçœ‹</a><br>è¯´å®è¯å¯¹å¤šçœ‹æ˜¯æœ‰ç‰¹æ®Šæ„Ÿæƒ…çš„ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†ä¹¦å°±æ˜¯åœ¨å¤šçœ‹ä¹°çš„ï¼Œé‚£æ—¶å€™å¤šçœ‹è¿˜ä¸æ˜¯å°ç±³ç³»çš„ï¼Œé‚£æ—¶å€™æ’ç‰ˆæ˜¯æœ€å¥½çš„ï¼Œé‚£æ—¶å€™æ ¹æœ¬æ²¡æœ‰ç½‘æ–‡ï¼Œé‚£æ—¶å€™kindleè¿˜å¯ä»¥åˆ·å¤šçœ‹çš„ã€‚ç›®å‰é™¤äº†çœ‹ã€ŠçŸ¥ä¹å‘¨åˆŠã€‹å’Œä¸€äº›ç†è´¢ç±»çš„æ‚å¿—ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯çœ‹ä»¥å‰ä¹°çš„ä¹¦äº†ã€‚</p></li><li><p><a href="https://du.163.com/invite?user=daa4ce39a9314eeca7e3ec58a28c9675&amp;bg=5&amp;from=singlemessage&amp;isappinstalled=0" target="_blank" rel="noopener">èœ—ç‰›è¯»ä¹¦</a></p></li></ul><blockquote><p>æ¯å¤©å…è´¹è¯»ä¹¦ä¸€å°æ—¶</p></blockquote><p>åèµ·ä¹‹ç§€ï¼Œé€šè¿‡æ¯å¤©å…è´¹1å°æ—¶çš„åˆ›æ–°å¸å¼•äº†ä¸å°‘äººï¼Œé‡Œé¢ä¹Ÿæœ‰ä¸å°‘çš„å¥½ä¹¦ï¼Œæ¯”å¦‚ä¸­ä¿¡å‡ºç‰ˆç¤¾çš„ã€‚å¦‚æœæˆ‘æƒ³çœ‹çš„ä¹¦åœ¨è¿™é‡Œæœ‰çš„è¯å°±åœ¨è¿™é‡Œçœ‹äº†ï¼Œè€Œä¸”è™½ç„¶æ¯å¤©åªèƒ½å…è´¹1å°æ—¶ï¼Œä½†æˆ‘ç›¸ä¿¡èƒ½æ»¡è¶³90%çš„äººäº†ã€‚</p><ul><li><a href="https://weread.qq.com/" target="_blank" rel="noopener">å¾®ä¿¡é˜…è¯»</a>  </li></ul><blockquote><p>å¾®ä¿¡è¯»ä¹¦è®©é˜…è¯»ä¸å†å­¤ç‹¬.</p></blockquote><p>å¾®ä¿¡å‡ºä»€ä¹ˆä¼°è®¡éƒ½èƒ½å¼•èµ·å¾ˆå¤§çš„è½°åŠ¨ï¼Œè…¾è®¯åˆ©ç”¨ç†Ÿäººç¤¾äº¤å°åˆ°äº†å¤ªå¤šçš„ç”œå¤´ï¼Œå¾®ä¿¡é˜…è¯»ä¹Ÿä¸ä¾‹å¤–ã€‚ä¹‹å‰å¤šçœ‹ä¹Ÿæƒ³åŸºäºé˜…è¯»åšå…³äºè¯»ä¹¦çš„åœˆå­ï¼Œä½†æ²¡å¤šä¹…å°±åšä¸ä¸‹å»äº†ã€‚å¯¹äºå¾®ä¿¡é˜…è¯»ï¼Œåˆšæ¨å‡ºçš„æ—¶å€™æ’ç‰ˆå·®ã€å¤§é‡é‡å¤çš„æ®µè½ç­‰è®©æˆ‘ç”¨äº†å‡ å¤©å°±æŠ›ä¹‹è„‘åäº†ã€‚ä½†æ˜¯ç­‰è¿‡ä¸€é˜¶æ®µå†å»çœ‹çœ‹ï¼Œå‘ç°æƒ…å†µå·²ç»æœ‰äº†å¾ˆå¤§çš„æ”¹å–„ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯æ¯å‘¨å¯ä»¥ç”¨é˜…è¯»æ—¶é—´æ¥æ¢å–ä¹¦å¸ï¼Œæ¯å‘¨æœ€å¤š10ä¸ªå§ã€‚</p><p>ä¸Šé¢è¿™å‡ ä¸ªæ˜¯ç›®å‰ç”¨çš„æ¯”è¾ƒå¤šçš„ï¼Œæ­¤å¤–è¿˜æœ‰ã€äº¬ä¸œé˜…è¯»ã€ã€ã€ç™¾åº¦é˜…è¯»ã€ç­‰ã€‚</p><p>å¯¹äºçº¸è´¨ä¹¦çš„è¯ï¼Œä¹Ÿæœ‰ä¸å°‘APPå¯ä»¥è®°å½•é˜…è¯»çŠ¶æ€çš„ï¼Œç›¸å½“äºåœ¨çº¿ä¹¦ç­¾äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½•ä¸€ä¸‹è‡ªå·±è¯»ä¹¦å†ç¨‹ï¼Œå¹¶æ¨èä¸€ä¸‹è‡ªå·±ç”¨å¾—æ¯”è¾ƒå¤šçš„é˜…è¯»ç›¸å…³çš„APPã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Dockerä¸­Djangoå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—é‡åˆ°çš„å‘</title>
    <link href="http://jiezhi.github.io/2018/01/05/django-with-mq-in-docker/"/>
    <id>http://jiezhi.github.io/2018/01/05/django-with-mq-in-docker/</id>
    <published>2018-01-05T01:35:47.000Z</published>
    <updated>2019-02-19T08:38:14.143Z</updated>
    
    <content type="html"><![CDATA[<p>æ—©ä¸Šè¿‡æ¥å‘ç°æ˜¨å¤©ä¸Šçº¿çš„ä»£ç è¿˜æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå¥½åœ¨å¾ˆå¿«è§£å†³äº†ï¼Œè§‰å¾—æœ‰å¿…è¦åšä¸ªå°æ€»ç»“äº†ã€‚</p><a id="more"></a><h4 id="pythonå®ç°mqæ¶ˆæ¯æ¥æ”¶å¤„ç†"><a href="#pythonå®ç°mqæ¶ˆæ¯æ¥æ”¶å¤„ç†" class="headerlink" title="pythonå®ç°mqæ¶ˆæ¯æ¥æ”¶å¤„ç†"></a>pythonå®ç°mqæ¶ˆæ¯æ¥æ”¶å¤„ç†</h4><h5 id="æ¡†æ¶é€‰æ‹©"><a href="#æ¡†æ¶é€‰æ‹©" class="headerlink" title="æ¡†æ¶é€‰æ‹©"></a>æ¡†æ¶é€‰æ‹©</h5><p>å› ä¸ºæƒ³ä¸åˆ°æ€ä¹ˆåœ¨Djangoé‡ŒåŠ ä¸Šmqæ¶ˆæ¯å¤„ç†ï¼Œæ‰€ä»¥å°±æš´éœ²å‡ºä¸€ä¸ªæ¥å£ç›´æ¥æ¥è°ƒç”¨ã€‚å…¬å¸ä½¿ç”¨çš„æ˜¯<a href="http://activemq.apache.org/" target="_blank" rel="noopener">activemq</a>ï¼Œå…¶æ”¯æŒ4ç§åè®®ï¼š</p><blockquote><ul><li><a href="http://activemq.apache.org/openwire.html" target="_blank" rel="noopener">OpenWire</a> for high performance clients in Java, C, C++, C#</li><li><a href="http://activemq.apache.org/stomp.html" target="_blank" rel="noopener">Stomp</a> support so that clients can be written easily in C, Ruby, Perl, Python, PHP, ActionScript/Flash, Smalltalk to talk to ActiveMQ as well as any other popular Message Broker</li><li><a href="http://activemq.apache.org/amqp.html" target="_blank" rel="noopener">AMQP</a> v1.0 support</li><li><a href="http://activemq.apache.org/mqtt.html" target="_blank" rel="noopener">MQTT</a> v3.1 support allowing for connections in an IoT environment.</li></ul></blockquote><p>ä»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€é€‚åˆpythonçš„å°±æ˜¯<a href="http://stomp.github.io/index.html" target="_blank" rel="noopener">Stomp</a>åè®®äº†ã€‚åœ¨<a href="http://stomp.github.io/implementations.html" target="_blank" rel="noopener">å®¢æˆ·ç«¯åˆ—è¡¨</a>ä¸­å¯ä»¥æ‰¾åˆ°ä¸åŒå®ç°è¯­è¨€å¯¹åº”çš„å®¢æˆ·ç«¯ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†<a href="https://github.com/jasonrbriggs/stomp.py" target="_blank" rel="noopener">stomp.py</a>ï¼Œè°è®©ä»–æ’åœ¨æœç´¢é¡µé¢å‰é¢å‘¢ï¼ˆå…¶åç§°å°±æ˜¯ä¸€ç§å¾ˆå¥½çš„SEOæ–¹å¼ï¼‰ã€‚</p><h6 id="mqå®¢æˆ·ç«¯çš„å®ç°"><a href="#mqå®¢æˆ·ç«¯çš„å®ç°" class="headerlink" title="mqå®¢æˆ·ç«¯çš„å®ç°"></a>mqå®¢æˆ·ç«¯çš„å®ç°</h6><p>è¿™é‡Œæ›¾ç»é‡åˆ°å›°æ‰°å¥½å‡ å¤©çš„å‘ï¼š</p><ul><li><p><strong>åè®®çš„é€‰æ‹©</strong></p><p>ä¹‹å‰æ²¡æ¥è§¦è¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿™å—ï¼Œå¤©çœŸåœ°ä»¥ä¸ºactivemqå°±æ˜¯mqçš„ä¸€ç§åè®®ã€‚è±†æ²¹ç»™æˆ‘ä¸€ä¸ªmqæœåŠ¡å™¨åœ°å€å’Œç«¯å£å·ï¼ˆ61616ï¼‰åï¼Œä½¿ç”¨stomp.pyè¿æ¥æ€»æ˜¯å‡ºé”™ï¼Œè¿æ¥æ—¶å¯ä»¥æ”¶åˆ°mqæœåŠ¡å™¨è¿”å›çš„æ¶ˆæ¯ï¼Œè§£æå´æ€»æ˜¯å‡ºé”™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread StompReceiverThread<span class="number">-1</span>:</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/local/Cellar/python3/3.6.1/Frameworks/Python.framework/Versions/3.6/lib/python3.6/threading.py"</span>, line <span class="number">916</span>, <span class="keyword">in</span> _bootstrap_inner</span><br><span class="line">    self.run()</span><br><span class="line">  File <span class="string">"/usr/local/Cellar/python3/3.6.1/Frameworks/Python.framework/Versions/3.6/lib/python3.6/threading.py"</span>, line <span class="number">864</span>, <span class="keyword">in</span> run</span><br><span class="line">    self._target(*self._args, **self._kwargs)</span><br><span class="line">  File <span class="string">"path/of/project/lib/python3.6/site-packages/stomp.py-4.1.19-py3.6.egg/stomp/transport.py"</span>, line <span class="number">332</span>, <span class="keyword">in</span> __receiver_loop</span><br><span class="line">    f = utils.parse_frame(frame)</span><br><span class="line">  File <span class="string">"path/of/project/lib/python3.6/site-packages/stomp.py-4.1.19-py3.6.egg/stomp/utils.py"</span>, line <span class="number">138</span>, <span class="keyword">in</span> parse_frame</span><br><span class="line">    preamble = decode(frame[<span class="number">0</span>:preamble_end])</span><br><span class="line">  File <span class="string">"path/of/project/lib/python3.6/site-packages/stomp.py-4.1.19-py3.6.egg/stomp/backward3.py"</span>, line <span class="number">29</span>, <span class="keyword">in</span> decode</span><br><span class="line">    <span class="keyword">return</span> byte_data.decode()</span><br><span class="line">UnicodeDecodeError: <span class="string">'utf-8'</span> codec can<span class="string">'t decode byte 0xf0 in position 0: invalid continuation byte</span></span><br></pre></td></tr></table></figure><p>â€‹</p><p>è°ƒè¯•å‡ å¤©éƒ½æ˜¯ä¸è¡Œï¼Œå°±å»æäº†ä¸ª<a href="https://github.com/jasonrbriggs/stomp.py/issues/177" target="_blank" rel="noopener">issue</a>ã€‚</p><p>åæ¥æ‰å‘ç°æ˜¯activemqå®ç°äº†å››ç§åè®®çš„æœåŠ¡ï¼Œè€Œä¸åŒåè®®å¼€æ”¾çš„ç«¯å£å·ä¸ä¸€æ ·ã€‚stompé»˜è®¤ç«¯å£å·ä¸º<strong>61613</strong>ï¼Œç«¯å£å·ä¸€æ¢ç«‹é©¬å¯ä»¥æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚è¿æ¥é—®é¢˜è§£å†³ã€‚</p><p>â€‹</p></li><li><p><strong>å¦‚ä½•åŠ å…¥åˆ°Djangoé‡Œ</strong></p><p>è¢«è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å›°æ‰°äº†å¥½ä¹…ï¼Œå•ç‹¬çš„ä¸€ä¸ªè„šæœ¬åˆ°åº•å¦‚ä½•åŠ å…¥åˆ°djangoé‡Œã€‚æ›¾ç»æƒ³è¿‡åœ¨å¯åŠ¨djangoé‡Œéšå³è¿è¡Œè¯¥è„šæœ¬ï¼Œå´ä¸€ç›´æ‰¾ä¸åˆ°æ–¹æ³•ã€‚å› ä¸ºæˆ‘æƒ³æŠŠæ›´å¤šçš„ç²¾åŠ›æ”¾åˆ°å¯¹å®¢æˆ·åˆ†æ•°çš„å¤„ç†ä¸Šï¼Œè€Œä¸æ˜¯èŠ±å¤ªå¤šçš„æ—¶é—´æ¥å¤„ç†åç«¯çš„é—®é¢˜ã€‚æ‰€ä»¥æ¯”è¾ƒæ€¥ç€æƒ³æŠŠè¿™ä¸ªé—®é¢˜è§£å†³ï¼Œç„¶è€Œè¶Šæ€¥è¶Šæ— æ³•æ‰¾åˆ°å®ç°çš„åŠæ³•ï¼Œä¹Ÿèˆä¸å¾—èŠ±æ—¶é—´æ¥æ€è€ƒæ˜¯ä¸æ˜¯è¿™æ¡è·¯æ˜¯ä¸æ˜¯å¯¹çš„è·¯ã€‚æ­£æ‰€è°“<strong>æˆ‘ä»¬éƒ½åœ¨ä¸æ–­èµ¶è·¯å¿˜è®°äº†å‡ºè·¯</strong>ã€‚</p><p>ä¹…ä¹…æ— æœåï¼Œç´¢æ€§ç¬¬ä¸€ä¸ªç‰ˆæœ¬å°±æ²¡åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„å¤„ç†ï¼Œå›å¤´å¤„ç†æ•°æ®å»ï¼</p><p>è¿™ä¸¤å¤©å¿½ç„¶æƒ³åˆ°è¦ä¸å°±æŠŠæ¥æ”¶æ¶ˆæ¯çš„ä»£ç å•ç‹¬æ‹å‡ºæ¥è¿è¡Œï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯å°±ç›´æ¥è°ƒç”¨æœ¬åœ°æ¥å£å°±å¯ä»¥äº†ã€‚ç„¶åç›´æ¥ç”¨pythonå¯åŠ¨å°±å¥½äº†ï¼Œè°ƒç”¨æœ¬åœ°æ¥å£ä¹ŸOKã€‚</p><p><strong>æœ‰æ—¶å€™ï¼Œè¢«ä¸€ä¸ªé—®é¢˜å›°æ‰°å¤ªä¹…å°±å®¹æ˜“é™·è¿›å»ï¼Œä¸å¯è‡ªæ‹”ã€‚</strong></p></li><li><p><strong>åˆå‡ºé—®é¢˜äº†</strong></p><p>ç„¶åæŠŠè¿™ä¸ªæ¥æ”¶æ¶ˆæ¯çš„è„šæœ¬scpåˆ°æœåŠ¡å™¨å†è¿è¡Œåˆå‡ºç°äº†2ä¸ªé—®é¢˜ï¼š</p><ol><li>æœåŠ¡å™¨æ²¡æœ‰python3</li><li>è¿˜è¦å®‰è£…å„ç§ä¾èµ–åº“ï¼ˆä¼šå‡ºç°å„ç§é—®é¢˜ï¼‰</li></ol><p>æ²¡åŠæ³•è¦ä¸ºè¿™ä¸ªå•ç‹¬çš„è„šæœ¬åˆ¶ä½œä¸€ä¸ªdockeré•œåƒäº†ï¼Œæœ‰ç‚¹é«˜å°„ç‚®æ‰“èšŠå­çš„æ„Ÿè§‰ã€‚ä½†æ˜¯å¥½åœ¨å¯ä»¥åšåˆ°å¹³å°æ— å…³æ€§ï¼Œä¸ç”¨å»è§£å†³å„ç§ä¾èµ–çš„é—®é¢˜ã€‚</p><p>æŠ˜è…¾ä¸€é€šåï¼Œå¯ä»¥æ­£å¸¸å¯åŠ¨è¿è¡Œäº†ã€‚ç„¶è€Œå¤©æœ‰ä¸æµ‹é£äº‘ï¼Œåœ¨æœ¬åœ°å¯ä»¥æ­£å¸¸è¿è¡Œçš„è„šæœ¬ï¼Œåˆ°äº†è¿™é‡Œå´å‡ºé”™äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; r = requests.delete(<span class="string">'http://0.0.0.0:8000/credit/apply-del/ED201******53'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.6/site-packages/urllib3/connection.py"</span>, line <span class="number">141</span>, <span class="keyword">in</span> _new_conn</span><br><span class="line">    (self.host, self.port), self.timeout, **extra_kw)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.6/site-packages/urllib3/util/connection.py"</span>, line <span class="number">83</span>, <span class="keyword">in</span> create_connection</span><br><span class="line">    <span class="keyword">raise</span> err</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.6/site-packages/urllib3/util/connection.py"</span>, line <span class="number">73</span>, <span class="keyword">in</span> create_connection</span><br><span class="line">    sock.connect(sa)</span><br><span class="line">ConnectionRefusedError: [Errno <span class="number">111</span>] Connection refused</span><br></pre></td></tr></table></figure><p>æ‚²å‰§ï¼ˆè¢«æ‹’ï¼‰äº†ã€‚</p><p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ä¸æ˜¯iptablesé…ç½®çš„é—®é¢˜ï¼Œå¯æ˜¯æ²¡å¬è¯´è¿‡iptablesç”¨æ¥é˜²æœ¬åœ°è®¿é—®çš„å‘€ï¼Œåœ¨ç»ˆç«¯é‡Œç”¨curlæ‰§è¡Œäº†ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X <span class="string">"DELETE"</span> <span class="string">"http://0.0.0.0:8000/credit/apply-del/ED201******53"</span></span><br><span class="line">&#123;<span class="string">"detail"</span>:<span class="string">"Not found."</span>,<span class="string">"status_code"</span>:404&#125;</span><br></pre></td></tr></table></figure><p>æ²¡é—®é¢˜ï¼ˆå¿½ç•¥404ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸æ˜¯é˜²ç«å¢™çš„é—®é¢˜ä¹‹ç±»çš„ã€‚åˆæ€€ç–‘æ˜¯requestsåº“çš„é—®é¢˜ï¼Œåˆè¿›è¿™ä¸ªé•œåƒé‡Œç”¨python3è‡ªå¸¦çš„urllib.requestæ‰§è¡Œä¹Ÿæ˜¯è¢«æ‹’ã€‚æ­£æƒ³ç€éš¾é“éè¦æ‰§è¡Œcurlå‘½ä»¤æ‰è¡Œï¼Ÿä¸åˆå¸¸ç†å‘€ã€‚</p><p>è¿™æ—¶å€™æœºæ™ºçš„æˆ‘çµå…‰ä¸€ç°ï¼Œéš¾ä¸æˆæ˜¯åœ¨dockeré‡Œè¿è¡Œçš„é—®é¢˜ï¼Ÿdockerå°±ç®—æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è™šæ‹Ÿæœºäº†ï¼Œç½‘ç»œåº”è¯¥é»˜è®¤æ˜¯<strong>bridge</strong>å½¢å¼çš„ã€‚</p><p>å—¯ï¼Œæ”¹ä¸º<strong>â€“net=host</strong>ï¼Œæå®šï¼</p></li></ul><h3 id="æœ€åé™„ä¸Šå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—çš„è„šæœ¬-å…³é”®åœ°æ–¹å·²ç»æ‰“ç -ï¼š"><a href="#æœ€åé™„ä¸Šå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—çš„è„šæœ¬-å…³é”®åœ°æ–¹å·²ç»æ‰“ç -ï¼š" class="headerlink" title="æœ€åé™„ä¸Šå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—çš„è„šæœ¬(å…³é”®åœ°æ–¹å·²ç»æ‰“ç )ï¼š"></a>æœ€åé™„ä¸Šå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—çš„è„šæœ¬(å…³é”®åœ°æ–¹å·²ç»æ‰“ç )ï¼š</h3>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on 04/12/2017</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: 'Jiezhi.G@gmail.com'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reference:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> JSONDecodeError</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> stomp</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=<span class="string">'credit_message.log'</span>, level=logging.DEBUG, format=<span class="string">'%(asctime)s %(message)s'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyListener</span><span class="params">(stomp.ConnectionListener)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_error</span><span class="params">(self, headers, body)</span>:</span></span><br><span class="line">        logging.error(<span class="string">'received an error "%s"'</span> % body)</span><br><span class="line">        print(<span class="string">'received an error "%s"'</span> % body)</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_message</span><span class="params">(self, headers, body)</span>:</span></span><br><span class="line">        logging.info(<span class="string">'\n'</span>)</span><br><span class="line">        logging.info(<span class="string">'received a message "%s"'</span> % body)</span><br><span class="line">        print(<span class="string">'received a message "%s"'</span> % body)</span><br><span class="line">        <span class="comment"># print(body['apply_id'])</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(body)</span><br><span class="line">            <span class="keyword">if</span> data[<span class="string">'applyId'</span>]:</span><br><span class="line">                delete_url = <span class="string">'http://0.0.0.0:8000/credit/apply-del/'</span> + data[<span class="string">'applyId'</span>]</span><br><span class="line">                r = requests.delete(delete_url)</span><br><span class="line">                print(r.status_code)</span><br><span class="line">                print(r.content)</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            logging.error(<span class="string">'KeyError process error: %s'</span> % body)</span><br><span class="line">        <span class="keyword">except</span> JSONDecodeError:</span><br><span class="line">            logging.error(<span class="string">'JSONDecodeError process error: %s'</span> % body)</span><br><span class="line">            print(<span class="string">'error:'</span>, body)</span><br><span class="line">  </span><br><span class="line">        logging.info(<span class="string">'-'</span> * <span class="number">80</span>)</span><br><span class="line">        logging.info(<span class="string">'\n'</span>)</span><br><span class="line">        print(<span class="string">'-'</span> * <span class="number">80</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_connected</span><span class="params">(self, headers, body)</span>:</span></span><br><span class="line">        logging.info(<span class="string">'Connected'</span>)</span><br><span class="line">        print(<span class="string">'Connected'</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_connecting</span><span class="params">(self, host_and_port)</span>:</span></span><br><span class="line">        logging.info(<span class="string">'Connecting'</span>)</span><br><span class="line">        print(<span class="string">'connecting'</span>, host_and_port)</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_disconnected</span><span class="params">(self)</span>:</span></span><br><span class="line">        logging.info(<span class="string">'disconnected'</span>)</span><br><span class="line">        print(<span class="string">'disconnected'</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_heartbeat</span><span class="params">(self)</span>:</span></span><br><span class="line">        logging.info(<span class="string">'heartbeat'</span>)</span><br><span class="line">        print(<span class="string">'heartbeat'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_mq_server</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># conn = stomp.Connection([('127.0.0.1', 61616)])</span></span><br><span class="line">    <span class="comment"># conn = stomp.Connection11([('192.168.*.*', 61613)])</span></span><br><span class="line">    conn = stomp.Connection11([(<span class="string">'*.1.*.2'</span>, <span class="number">61613</span>)])</span><br><span class="line">    conn.set_listener(<span class="string">''</span>, MyListener())</span><br><span class="line">    conn.start()</span><br><span class="line">  </span><br><span class="line">    conn.connect(<span class="string">'admin'</span>, <span class="string">'password'</span>, wait=<span class="keyword">True</span>)</span><br><span class="line">    conn.subscribe(destination=<span class="string">'queue.bc.rgb.cs.commit.risk'</span>,</span><br><span class="line">                   id=<span class="string">'1'</span>,</span><br><span class="line">                   ack=<span class="string">'auto'</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># conn.send(body='Hello world', destination='/queue/test')</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="comment"># conn.disconnect()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    connect_mq_server()</span><br></pre></td></tr></table></figure><p>  ä»¥åŠå¯åŠ¨è„šæœ¬ï¼š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">           -d \</span><br><span class="line">           --name credit_mq \</span><br><span class="line">           --net=host \</span><br><span class="line">           -v /home/docker/credit_message.log:/app/credit_message.log \</span><br><span class="line">           credit_mq:v1 \</span><br><span class="line">           python handle_message_queue.py</span><br></pre></td></tr></table></figure><p>  ç®—äº†Dockerfileä¹Ÿæ”¾å‡ºæ¥å§ï¼š</p>  <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /app</span></span><br><span class="line"><span class="bash">WORKDIR /app</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">COPY requirements.txt /app/requirements.txt</span></span><br><span class="line"><span class="bash">RUN pip install -r requirements.txt --trusted-host pypi.douban.com -i http://pypi.douban.com/simple</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">COPY . /app</span></span><br><span class="line"><span class="bash">CMD python handle_message_queue.py</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ—©ä¸Šè¿‡æ¥å‘ç°æ˜¨å¤©ä¸Šçº¿çš„ä»£ç è¿˜æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå¥½åœ¨å¾ˆå¿«è§£å†³äº†ï¼Œè§‰å¾—æœ‰å¿…è¦åšä¸ªå°æ€»ç»“äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="http://jiezhi.github.io/categories/python/"/>
    
    
      <category term="python" scheme="http://jiezhi.github.io/tags/python/"/>
    
      <category term="Docker" scheme="http://jiezhi.github.io/tags/Docker/"/>
    
      <category term="Django" scheme="http://jiezhi.github.io/tags/Django/"/>
    
      <category term="mq" scheme="http://jiezhi.github.io/tags/mq/"/>
    
      <category term="stomp" scheme="http://jiezhi.github.io/tags/stomp/"/>
    
  </entry>
  
</feed>
